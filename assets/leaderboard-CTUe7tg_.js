import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-VRnKZrOj.js";import{$t as r,Gt as i,Ht as a,Kt as o,Qt as s,Ut as c,Xt as l,Y as u,Z as d,_t as f,ct as p,ft as m,gt as h,ht as g,lt as _,mt as v,ot as y,pt as b,qt as x,rt as S,t as C}from"./vendor-ui-Cr2U62n1.js";import{a as w,g as T,i as E,n as D,o as O,v as k}from"./index-BVspMta1.js";import{t as A}from"./AdaptiveTooltip-C1LRKoTG.js";import{t as j}from"./Footer-DRRxk7U9.js";var M=e(t(),1),N=e(n(),1),P=({mapName:e,setMapName:t})=>{let{t:n}=k(),{seasons:r,artifactCounts:o,fetchArtifactCounts:s,loadingArtifactCounts:l,serverMatchings:u,loadingMatchings:d,fetchServerMatchings:y,region:S,setRegion:C}=w(),T={trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},E={itemClasses:{base:`rounded-none`}},D=(0,M.useMemo)(()=>{if(r.length===0)return null;let e=Math.max(...r.map(e=>e.number));return r.find(t=>t.serverRegion.toLowerCase()===S.toLowerCase()&&t.number===e)?.id||null},[r,S]);(0,M.useEffect)(()=>{D&&s(D,e)},[D,e,s]),(0,M.useEffect)(()=>{D&&y(D)},[D,y]);let A=(0,M.useMemo)(()=>{let e=[...o].sort((e,t)=>t.artifactCount-e.artifactCount||e.serverId-t.serverId),t=[],n=-1,r=0;for(let i=0;i<e.length;i++){let a=e[i];a.artifactCount!==n&&(r=i+1,n=a.artifactCount),t.push({...a,rank:r})}return t},[o]),j=e=>{let t=u.find(t=>t.server1.serverId===e||t.server2.serverId===e);if(t){let r=t.server1.serverId===e?t.server1:t.server2,i=r.raceId===1?n(`common:server.lightAbbr`):n(`common:server.darkAbbr`),a=r.serverId%1e3;return`${r.serverName}（${i}${a}）`}let r=n(e<2e3?`common:server.lightAbbr`:`common:server.darkAbbr`),i=e%1e3;return`${n(`common:server.server`)}（${r}${i}）`};return(0,N.jsxs)(a,{className:`bg-transparent shadow-none`,children:[(0,N.jsx)(c,{className:`flex flex-col items-start gap-3 px-0`,children:(0,N.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,N.jsx)(`p`,{className:`text-[22px] text-default-800`,children:n(`common:leaderboard.artifactRegionRanking`)}),(0,N.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,N.jsxs)(p,{size:`sm`,selectedKeys:[S],onSelectionChange:e=>C(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:T,popoverProps:{radius:`none`},listboxProps:E,children:[(0,N.jsx)(_,{children:n(`common:server.tw`)},`tw`),(0,N.jsx)(_,{children:n(`common:server.kr`)},`kr`)]}),(0,N.jsxs)(p,{size:`sm`,selectedKeys:[e],onSelectionChange:e=>t(Array.from(e)[0]),className:`min-w-[150px] flex-[2] sm:flex-none sm:w-[200px]`,disallowEmptySelection:!0,classNames:T,popoverProps:{radius:`none`},listboxProps:E,children:[(0,N.jsx)(_,{children:n(`common:leaderboard.allMaps`,`全部地图`)},`ALL`),(0,N.jsx)(_,{children:n(`maps:${O.ABYSS_A}.description`)},O.ABYSS_A),(0,N.jsx)(_,{children:n(`maps:${O.ABYSS_B}.description`)},O.ABYSS_B)]})]})]})}),(0,N.jsx)(i,{className:`px-0`,children:l||d||u.length===0?(0,N.jsx)(`div`,{className:`flex justify-center items-center py-10`,children:(0,N.jsx)(x,{})}):(0,N.jsxs)(f,{"aria-label":`Artifact Region Ranking`,removeWrapper:!0,className:`min-w-full`,classNames:{table:`border-separate border-spacing-y-[10px] -mt-[10px]`,thead:`[&>tr]:first:shadow-none`,th:`bg-transparent text-foreground font-bold text-[16px] h-auto py-0`,td:`bg-character-equipment h-[44px] text-[16px] font-normal text-default-800 border-y-1 border-crafting-border first:border-l-1 last:border-r-1 first:rounded-l-md last:rounded-r-md`},children:[(0,N.jsxs)(g,{children:[(0,N.jsx)(h,{children:n(`common:leaderboard.rank`)}),(0,N.jsx)(h,{children:n(`common:server.server`)}),(0,N.jsx)(h,{align:`center`,children:n(`common:leaderboard.artifactCount`)})]}),(0,N.jsx)(b,{emptyContent:n(`common:leaderboard.inContention`),items:A,children:e=>(0,N.jsxs)(v,{children:[(0,N.jsx)(m,{children:(0,N.jsx)(`div`,{className:`flex items-center justify-center w-6 h-6`,children:e.rank})}),(0,N.jsx)(m,{children:(0,N.jsx)(`span`,{children:j(e.serverId)})}),(0,N.jsx)(m,{align:`center`,children:(0,N.jsx)(`span`,{children:e.artifactCount})})]},e.serverId)})]})})]})},F=()=>{let e=[O.ABYSS_A,O.ABYSS_B],t=`starred_artifact_servers`,{t:n,i18n:f}=k([...e.map(e=>`markers/${e}`),`common`]),{seasons:m,serverMatchings:h,loadingMatchings:g,artifacts:v,loadingArtifacts:b,artifactStates:x,fetchServerMatchings:E,fetchArtifactStates:j,region:P,setRegion:F}=w(),{maps:I}=D(),[L,R]=(0,M.useState)(s(`Asia/Taipei`)),[z,B]=(0,M.useState)(!0),[V,H]=(0,M.useState)(new Date),[U,ee]=(0,M.useState)(()=>{let e=localStorage.getItem(t);return e?JSON.parse(e):[]}),W=(0,M.useCallback)(e=>{ee(n=>{let r=n.includes(e)?n.filter(t=>t!==e):[...n,e];return localStorage.setItem(t,JSON.stringify(r)),r})},[]),te=(0,M.useMemo)(()=>[...h].sort((e,t)=>{let n=U.includes(e.server1.serverId)||U.includes(e.server2.serverId),r=U.includes(t.server1.serverId)||U.includes(t.server2.serverId);return n&&!r?-1:!n&&r?1:0}),[h,U]);(0,M.useEffect)(()=>{let e=setInterval(()=>{H(new Date)},1e3);return()=>clearInterval(e)},[]),(0,M.useEffect)(()=>{if(!z)return;let e=setInterval(()=>{R(s(`Asia/Taipei`))},1e3);return()=>clearInterval(e)},[z]);let G=T(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Neutral.webp`),K=T(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Light.webp`),q=T(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Dark.webp`),ne=T(`images/Leaderboards/VS.webp`),J=(0,M.useMemo)(()=>m.length===0?null:Math.max(...m.map(e=>e.number)),[m]),Y=(0,M.useMemo)(()=>J&&m.find(e=>e.serverRegion===P&&e.number===J)?.id||null,[P,J,m]),re=(0,M.useMemo)(()=>{let e,t=!0;return n=>{if(e&&clearTimeout(e),t){j(n),t=!1;return}e=setTimeout(()=>{j(n)},5e3)}},[j]);(0,M.useEffect)(()=>{Y&&E(Y)},[Y,E]),(0,M.useEffect)(()=>{Y&&(z?re(Y):j(Y,L.toDate()))},[Y,z,z?null:L]);let X=(0,M.useMemo)(()=>{let e={};return x.forEach(t=>{e[t.serverMatchingId]||(e[t.serverMatchingId]={}),e[t.serverMatchingId][t.abyssArtifactId]={state:t.state,recordTime:t.recordTime}}),e},[x]),Z=e=>{if(!e)return`--:--:--`;let t=new Date(e).getTime(),r=z?V.getTime():L.toDate().getTime(),i=t+1728e5-r;if(i<=0)return n(`common:leaderboard.inContention`,`数据待上传`);let a=Math.floor(i/(1e3*60*60)),o=Math.floor(i%(1e3*60*60)/(1e3*60)),s=Math.floor(i%(1e3*60)/1e3);return`${String(a).padStart(2,`0`)}:${String(o).padStart(2,`0`)}:${String(s).padStart(2,`0`)}`},{artifactsA:Q,artifactsB:$}=(0,M.useMemo)(()=>{let e=I.find(e=>e.name===O.ABYSS_A),t=I.find(e=>e.name===O.ABYSS_B);return{artifactsA:v.filter(t=>t.marker.mapId===e?.id).sort((e,t)=>e.order-t.order),artifactsB:v.filter(e=>e.marker.mapId===t?.id).sort((e,t)=>e.order-t.order)}},[v,I]);return(0,N.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[(0,N.jsx)(a,{className:`bg-transparent shadow-none`,children:(0,N.jsx)(c,{className:`flex flex-col items-start gap-3 px-0`,children:(0,N.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,N.jsx)(`p`,{className:`text-[22px] text-default-800`,children:n(`common:leaderboard.realtimeArtifactRatio`)}),(0,N.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,N.jsxs)(p,{size:`sm`,selectedKeys:[P],onSelectionChange:e=>F(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:{trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},popoverProps:{radius:`none`},listboxProps:{itemClasses:{base:`rounded-none`}},children:[(0,N.jsx)(_,{children:n(`common:server.tw`)},`tw`),(0,N.jsx)(_,{children:n(`common:server.kr`)},`kr`)]}),(0,N.jsx)(r,{locale:f.language,children:(0,N.jsxs)(`div`,{className:`relative flex-[2] sm:flex-none sm:w-[280px]`,children:[(0,N.jsx)(y,{className:`w-full`,hideTimeZone:!0,showMonthAndYearPickers:!0,value:L,onChange:e=>{e&&(R(e),B(!1))},classNames:{inputWrapper:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,popoverContent:`rounded-none p-0`,segment:`text-foreground`},granularity:`second`}),!z&&(0,N.jsx)(A,{content:n(`common:leaderboard.resetToNow`,`重置到当前时间`),children:(0,N.jsx)(o,{size:`sm`,variant:`flat`,isIconOnly:!0,className:`absolute right-10 top-1/2 -translate-y-1/2 z-20 h-6 w-6 min-w-0 bg-transparent`,onClick:()=>{B(!0),R(s(`Asia/Taipei`))},children:(0,N.jsx)(S,{icon:u,className:`text-[12px]`})})})]})})]})]})})}),g||b?(0,N.jsx)(`p`,{className:`text-center py-4`,children:n(`common:ui.loading`)}):te.map(e=>(0,N.jsx)(a,{className:`bg-character-equipment shadow-none border-1 border-crafting-border p-4 relative group`,children:(0,N.jsx)(i,{className:`p-0`,children:(0,N.jsxs)(`div`,{className:`flex items-stretch justify-between`,children:[(0,N.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,N.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:`linear-gradient(135deg, #DBEDFF 0%, #F3FBFF 100%)`},children:[(0,N.jsx)(o,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute left-1 z-10 text-default-400 hover:text-star data-[starred=true]:text-star`,"data-starred":U.includes(e.server1.serverId),onClick:()=>W(e.server1.serverId),children:(0,N.jsx)(S,{icon:U.includes(e.server1.serverId)?d:C,className:`text-[16px]`})}),(0,N.jsx)(`span`,{className:`text-lg font-bold text-[#1D3557]`,children:e.server1.serverName}),(0,N.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（天`,e.server1.serverId%1e3,`）`]})]}),(0,N.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,N.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,N.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:n(`maps:${O.ABYSS_A}.description`)}),(0,N.jsx)(`div`,{className:`flex gap-1`,children:Q.map(t=>{let r=n(`markers/${O.ABYSS_A}:${t.markerId}.name`,t.marker.name),i=X[e.id]?.[t.id],a=i?.state,o=!1;if(i?.recordTime){let e=new Date(i.recordTime).getTime(),t=z?V.getTime():L.toDate().getTime();e+1728e5-t<=0&&(o=!0)}let s=G;return o||(a===1?s=K:a===2&&(s=q)),(0,N.jsx)(A,{content:r,children:(0,N.jsx)(`img`,{src:s,alt:r,className:`w-7 h-7 sm:w-12 sm:h-12`})},t.id)})})]}),(0,N.jsx)(`div`,{className:`text-[20px] text-default-800 font-mono`,children:Z(Q.length>0?X[e.id]?.[Q[0].id]?.recordTime:void 0)})]})]}),(0,N.jsxs)(`div`,{className:`flex flex-col items-center px-2 h-full`,children:[(0,N.jsx)(`div`,{className:`h-[38px] flex items-center`,children:(0,N.jsx)(`img`,{src:ne,alt:`VS`,className:`w-10 h-10 object-contain`})}),(0,N.jsx)(`div`,{className:`flex-1 flex items-center mt-2`,children:(0,N.jsx)(l,{orientation:`vertical`,className:`h-[60px] sm:h-[80px] bg-default-500`})})]}),(0,N.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,N.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:`linear-gradient(225deg, #EFE5FF 0%, #F3FBFF 100%)`},children:[(0,N.jsx)(`span`,{className:`text-lg font-bold text-[#4B0082]`,children:e.server2.serverName}),(0,N.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（魔`,e.server2.serverId%1e3,`）`]}),(0,N.jsx)(o,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute right-1 z-10 text-default-400 hover:text-star data-[starred=true]:text-star`,"data-starred":U.includes(e.server2.serverId),onClick:()=>W(e.server2.serverId),children:(0,N.jsx)(S,{icon:U.includes(e.server2.serverId)?d:C,className:`text-[16px]`})})]}),(0,N.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,N.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,N.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:n(`maps:${O.ABYSS_B}.description`)}),(0,N.jsx)(`div`,{className:`flex gap-1`,children:$.map(t=>{let r=n(`markers/${O.ABYSS_B}:${t.markerId}.name`,t.marker.name),i=X[e.id]?.[t.id],a=i?.state,o=!1;if(i?.recordTime){let e=new Date(i.recordTime).getTime(),t=z?V.getTime():L.toDate().getTime();e+1728e5-t<=0&&(o=!0)}let s=G;return o||(a===1?s=K:a===2&&(s=q)),(0,N.jsx)(A,{content:r,children:(0,N.jsx)(`img`,{src:s,alt:r,className:`w-7 h-7 sm:w-12 sm:h-12`})},t.id)})})]}),(0,N.jsx)(`div`,{className:`text-[20px] text-default-800 font-mono`,children:Z($.length>0?X[e.id]?.[$[0].id]?.recordTime:void 0)})]})]})]})})},e.id))]})};function I(){let[e,t]=(0,M.useState)(`ALL`);return(0,N.jsxs)(`div`,{className:`h-full overflow-y-auto flex flex-col bg-leaderboard-page`,children:[(0,N.jsx)(`div`,{className:`flex-1 flex flex-col items-center p-4`,children:(0,N.jsx)(`div`,{className:`w-full max-w-[1074px] flex flex-col gap-4`,children:(0,N.jsxs)(`div`,{className:`flex flex-col-reverse lg:flex-row justify-center gap-4 lg:gap-8`,children:[(0,N.jsx)(`div`,{className:`w-full lg:w-[428px] flex flex-col gap-4`,children:(0,N.jsx)(P,{mapName:e,setMapName:t})}),(0,N.jsx)(`div`,{className:`w-full lg:w-[632px] flex flex-col gap-4`,children:(0,N.jsx)(F,{})})]})})}),(0,N.jsx)(j,{})]})}export{I as component};