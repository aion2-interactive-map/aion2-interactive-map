import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-Byz6-gS2.js";import{t as r}from"./Trans-DHf3x0aR.js";import{$ as i,Jt as a,Qt as o,Xt as s,Z as c,Zt as l,_t as u,an as d,bt as f,ft as p,gt as m,in as h,nt as g,on as _,pt as v,qt as y,rt as b,st as x,t as S,tn as C,ut as w,vt as T,xt as E,yt as D}from"./vendor-ui-C-FJ7-0S.js";import{a as O,d as k,f as A,o as j,p as M,s as N,x as P,y as F}from"./index-BrHMOM_c.js";import{t as I}from"./AdaptiveTooltip-zQu5_RVr.js";import{t as L}from"./Footer-DlDmVCG3.js";var R=e(t(),1),z=e(n(),1),B=({mapName:e,setMapName:t})=>{let{t:n}=P(),{seasons:r,artifactCounts:i,fetchArtifactCounts:c,loadingArtifactCounts:l,serverMatchings:d,loadingMatchings:h,region:g,setRegion:_}=j(),b={trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},x={itemClasses:{base:`rounded-none`}},S=(0,R.useMemo)(()=>{let e=r.filter(e=>e.serverRegion.toLowerCase()===g.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[r,g]);(0,R.useEffect)(()=>{S&&c(S,e)},[S,e,c]);let C=(0,R.useMemo)(()=>{let e=[...i].sort((e,t)=>t.artifactCount-e.artifactCount||e.serverId-t.serverId),t=[],n=-1,r=0;for(let i=0;i<e.length;i++){let a=e[i];a.artifactCount!==n&&(r=i+1,n=a.artifactCount),t.push({...a,rank:r})}return t},[i]),w=e=>{let t=d.find(t=>t.server1.serverId===e||t.server2.serverId===e);if(t){let r=t.server1.serverId===e?t.server1:t.server2,i=r.raceId===1?n(`common:server.lightAbbr`):n(`common:server.darkAbbr`),a=r.serverId%1e3;return`${r.serverName}（${i}${a}）`}let r=n(e<2e3?`common:server.lightAbbr`:`common:server.darkAbbr`),i=e%1e3;return`${n(`common:server.server`)}（${r}${i}）`};return(0,z.jsxs)(y,{className:`bg-transparent shadow-none`,children:[(0,z.jsx)(a,{className:`flex flex-col items-start gap-3 px-0`,children:(0,z.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,z.jsx)(`p`,{className:`text-[22px] text-default-800`,children:n(`common:leaderboard.artifactRegionRanking`)}),(0,z.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,z.jsxs)(p,{size:`sm`,selectedKeys:[g],onSelectionChange:e=>_(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:b,popoverProps:{radius:`none`},listboxProps:x,children:[(0,z.jsx)(v,{children:n(`common:server.tw`)},`tw`),(0,z.jsx)(v,{children:n(`common:server.kr`)},`kr`)]}),(0,z.jsxs)(p,{size:`sm`,selectedKeys:[e],onSelectionChange:e=>t(Array.from(e)[0]),className:`min-w-[150px] flex-[2] sm:flex-none sm:w-[200px]`,disallowEmptySelection:!0,classNames:b,popoverProps:{radius:`none`},listboxProps:x,children:[(0,z.jsx)(v,{children:n(`common:leaderboard.allMaps`,`全部地图`)},`ALL`),(0,z.jsx)(v,{children:n(`maps:${N.ABYSS_A}.description`)},N.ABYSS_A),(0,z.jsx)(v,{children:n(`maps:${N.ABYSS_B}.description`)},N.ABYSS_B)]})]})]})}),(0,z.jsx)(s,{className:`px-0`,children:l||h||d.length===0?(0,z.jsx)(`div`,{className:`flex justify-center items-center py-10`,children:(0,z.jsx)(o,{})}):(0,z.jsxs)(E,{"aria-label":`Artifact Region Ranking`,removeWrapper:!0,className:`min-w-full`,classNames:{table:`border-separate border-spacing-y-[10px] -mt-[10px]`,thead:`[&>tr]:first:shadow-none`,th:`bg-transparent text-foreground font-bold text-[16px] h-auto py-0`,td:`bg-character-equipment h-[44px] text-[16px] font-normal text-default-800 border-y-1 border-crafting-border first:border-l-1 last:border-r-1 first:rounded-l-md last:rounded-r-md`},children:[(0,z.jsxs)(D,{children:[(0,z.jsx)(f,{children:n(`common:leaderboard.rank`)}),(0,z.jsx)(f,{children:n(`common:server.server`)}),(0,z.jsx)(f,{align:`center`,children:n(`common:leaderboard.artifactCount`)})]}),(0,z.jsx)(u,{emptyContent:n(`common:leaderboard.inContention`),items:C,children:e=>(0,z.jsxs)(T,{children:[(0,z.jsx)(m,{children:(0,z.jsx)(`div`,{className:`flex items-center justify-center w-6 h-6`,children:e.rank})}),(0,z.jsx)(m,{children:(0,z.jsx)(`span`,{children:w(e.serverId)})}),(0,z.jsx)(m,{align:`center`,children:(0,z.jsx)(`span`,{children:e.artifactCount})})]},e.serverId)})]})})]})},V=({matching:e,server:t,isServer1:n,artifacts:a,mapName:o,artifactStateMap:s,isAutoUpdate:c,selectedDate:u,starredServerIds:d,toggleStar:f,formatCountdown:p,t:m,icons:h})=>{let _=d.includes(t.serverId),v=m(n?`common:server.lightAbbr`:`common:server.darkAbbr`),y=n?`linear-gradient(135deg, #DBEDFF 0%, #F3FBFF 100%)`:`linear-gradient(225deg, #EFE5FF 0%, #F3FBFF 100%)`,C=n?`#1D3557`:`#4B0082`;return(0,z.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,z.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:y},children:[(0,z.jsx)(l,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute ${n?`left-1`:`right-1`} z-10 text-default-400 hover:text-star data-[starred=true]:text-star`,"data-starred":_,onClick:e=>{e.stopPropagation(),f(t.serverId)},children:(0,z.jsx)(x,{icon:_?i:S,className:`text-[16px]`})}),(0,z.jsx)(`span`,{className:`text-lg font-bold`,style:{color:C},children:t.serverName}),(0,z.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（`,v,t.serverId%1e3,`）`]})]}),(0,z.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,z.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:m(`maps:${o}.description`)}),(0,z.jsx)(`div`,{className:`flex gap-1`,children:a.map(t=>{let n=m(`markers/${o}:${t.markerId}.name`,t.marker.name),r=s[e.id]?.[t.id],i=r?.state,a=!1;if(r?.recordTime){let e=new Date(r.recordTime).getTime(),t=c?Date.now():u.toDate().getTime();e+1728e5-t<=0&&(a=!0)}let l=h.neutral;return a||(i===1?l=h.light:i===2&&(l=h.dark)),(0,z.jsx)(I,{content:n,children:(0,z.jsx)(`img`,{src:l,alt:n,className:`w-7 h-7 sm:w-12 sm:h-12`})},t.id)})})]}),(0,z.jsx)(`div`,{className:`text-[20px] text-default-800 font-mono`,onClick:e=>{e.stopPropagation()},children:p(a.length>0?s[e.id]?.[a[0].id]?.recordTime:void 0)}),a.length>0&&s[e.id]?.[a[0].id]?.contributors?.[0]&&(0,z.jsxs)(`div`,{className:`flex items-center justify-between w-full  mt-1`,onClick:e=>e.stopPropagation(),children:[(0,z.jsx)(`span`,{className:`text-[12px] text-default-800`,children:(0,z.jsx)(r,{t:m,i18nKey:`common:leaderboard.providedBy`,values:{username:s[e.id][a[0].id].contributors[0].user.name},components:{emph:(0,z.jsx)(`span`,{className:`text-primary font-medium`})}})}),(0,z.jsxs)(`div`,{className:`flex gap-2 text-default-400`,children:[(0,z.jsx)(x,{icon:b,className:`cursor-pointer hover:text-primary transition-colors`}),(0,z.jsx)(x,{icon:g,className:`cursor-pointer hover:text-danger transition-colors`})]})]})]})]})},H=()=>{let e=M(),t=[N.ABYSS_A,N.ABYSS_B],n=`starred_artifact_servers`,{t:r,i18n:i}=P([...t.map(e=>`markers/${e}`),`common`]),{seasons:o,serverMatchings:u,loadingMatchings:f,artifactsByMap:m,loadingArtifacts:g,artifactStates:b,fetchServerMatchings:S,fetchArtifactStates:T,region:E,setRegion:D}=j(),[O,k]=(0,R.useState)(h(d())),[A,L]=(0,R.useState)(!0),[B,H]=(0,R.useState)(()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]}),U=(0,R.useCallback)(e=>{H(t=>{let r=t.includes(e)?t.filter(t=>t!==e):[...t,e];return localStorage.setItem(n,JSON.stringify(r)),r})},[]),W=(0,R.useMemo)(()=>[...u].sort((e,t)=>{let n=B.includes(e.server1.serverId)||B.includes(e.server2.serverId),r=B.includes(t.server1.serverId)||B.includes(t.server2.serverId);return n&&!r?-1:!n&&r?1:0}),[u,B]);(0,R.useEffect)(()=>{if(!A)return;let e=setInterval(()=>{k(h(d()))},1e3);return()=>clearInterval(e)},[A]);let G=F(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Neutral.webp`),K=F(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Light.webp`),q=F(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Dark.webp`),J=F(`images/Leaderboards/VS.webp`),Y=(0,R.useMemo)(()=>{let e=o.filter(e=>e.serverRegion.toLowerCase()===E.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[E,o]),X=(0,R.useMemo)(()=>{let e,t=!0;return n=>{if(e&&clearTimeout(e),t){T(n),t=!1;return}e=setTimeout(()=>{T(n)},5e3)}},[T]);(0,R.useEffect)(()=>{Y&&(S(Y),A?X(Y):T(Y,O.toDate()))},[Y,A,A?null:O,S,X,T]);let Z=(0,R.useMemo)(()=>{let e={};return b.forEach(t=>{e[t.serverMatchingId]||(e[t.serverMatchingId]={}),t.states.forEach(n=>{e[t.serverMatchingId][n.abyssArtifactId]={state:n.state,recordTime:t.recordTime,contributors:t.contributors||[]}})}),e},[b]),Q=e=>{if(!e)return`--:--:--`;let t=new Date(e).getTime(),n=A?Date.now():O.toDate().getTime(),i=t+1728e5-n;if(i<=0)return r(`common:leaderboard.inContention`,`数据待上传`);let a=Math.floor(i/(1e3*60*60)),o=Math.floor(i%(1e3*60*60)/(1e3*60)),s=Math.floor(i%(1e3*60)/1e3);return`${String(a).padStart(2,`0`)}:${String(o).padStart(2,`0`)}:${String(s).padStart(2,`0`)}`},{artifactsA:$,artifactsB:ee}=(0,R.useMemo)(()=>({artifactsA:(m[N.ABYSS_A]||[]).sort((e,t)=>e.order-t.order),artifactsB:(m[N.ABYSS_B]||[]).sort((e,t)=>e.order-t.order)}),[m]);return(0,z.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[(0,z.jsx)(y,{className:`bg-transparent shadow-none`,children:(0,z.jsx)(a,{className:`flex flex-col items-start gap-3 px-0`,children:(0,z.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,z.jsx)(`p`,{className:`text-[22px] text-default-800`,children:r(`common:leaderboard.realtimeArtifactRatio`)}),(0,z.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,z.jsxs)(p,{size:`sm`,selectedKeys:[E],onSelectionChange:e=>D(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:{trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},popoverProps:{radius:`none`},listboxProps:{itemClasses:{base:`rounded-none`}},children:[(0,z.jsx)(v,{children:r(`common:server.tw`)},`tw`),(0,z.jsx)(v,{children:r(`common:server.kr`)},`kr`)]}),(0,z.jsx)(_,{locale:i.language,children:(0,z.jsxs)(`div`,{className:`relative flex-[2] sm:flex-none sm:w-[280px]`,children:[(0,z.jsx)(w,{className:`w-full`,hideTimeZone:!0,showMonthAndYearPickers:!0,value:O,onChange:e=>{e&&(k(e),L(!1))},classNames:{inputWrapper:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,popoverContent:`rounded-none p-0`,segment:`text-foreground`},granularity:`second`}),!A&&(0,z.jsx)(I,{content:r(`common:leaderboard.resetToNow`,`重置到当前时间`),children:(0,z.jsx)(l,{size:`sm`,variant:`flat`,isIconOnly:!0,className:`absolute right-10 top-1/2 -translate-y-1/2 z-20 h-6 w-6 min-w-0 bg-transparent`,onClick:()=>{L(!0),k(h(d()))},children:(0,z.jsx)(x,{icon:c,className:`text-[12px]`})})})]})})]})]})})}),f||g?(0,z.jsx)(`p`,{className:`text-center py-4`,children:r(`common:ui.loading`)}):W.map(t=>(0,z.jsx)(y,{isPressable:!0,onClick:()=>e({to:`/leaderboard/artifacts/${t.id}`}),className:`bg-character-equipment shadow-none border-1 border-crafting-border p-4 relative group`,children:(0,z.jsx)(s,{className:`p-0`,children:(0,z.jsxs)(`div`,{className:`flex items-stretch justify-between`,children:[(0,z.jsx)(V,{matching:t,server:t.server1,isServer1:!0,artifacts:$,mapName:N.ABYSS_A,artifactStateMap:Z,isAutoUpdate:A,selectedDate:O,starredServerIds:B,toggleStar:U,formatCountdown:Q,t:r,icons:{neutral:G,light:K,dark:q}}),(0,z.jsxs)(`div`,{className:`flex flex-col items-center px-2 h-full`,children:[(0,z.jsx)(`div`,{className:`h-[38px] flex items-center`,children:(0,z.jsx)(`img`,{src:J,alt:`VS`,className:`w-10 h-10 object-contain`})}),(0,z.jsx)(`div`,{className:`flex-1 flex items-center mt-2`,children:(0,z.jsx)(C,{orientation:`vertical`,className:`h-[60px] sm:h-[80px] bg-default-500`})})]}),(0,z.jsx)(V,{matching:t,server:t.server2,isServer1:!1,artifacts:ee,mapName:N.ABYSS_B,artifactStateMap:Z,isAutoUpdate:A,selectedDate:O,starredServerIds:B,toggleStar:U,formatCountdown:Q,t:r,icons:{neutral:G,light:K,dark:q}})]})})},t.id))]})};function U(){let[e,t]=(0,R.useState)(`ALL`);return(0,z.jsx)(`div`,{className:`h-full overflow-y-auto flex flex-col bg-leaderboard-page`,children:k().pathname.includes(`/artifacts/`)?(0,z.jsx)(A,{}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(`div`,{className:`flex-1 flex flex-col items-center p-4`,children:(0,z.jsx)(`div`,{className:`w-full max-w-[1074px] flex flex-col gap-4`,children:(0,z.jsxs)(`div`,{className:`flex flex-col-reverse lg:flex-row justify-center gap-4 lg:gap-8`,children:[(0,z.jsx)(`div`,{className:`w-full lg:w-[428px] flex flex-col gap-4`,children:(0,z.jsx)(B,{mapName:e,setMapName:t})}),(0,z.jsx)(`div`,{className:`w-full lg:w-[632px] flex flex-col gap-4`,children:(0,z.jsx)(H,{})})]})})}),(0,z.jsx)(L,{})]})})}export{U as component};