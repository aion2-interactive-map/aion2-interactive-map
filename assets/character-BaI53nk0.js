import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-C735XewB.js";import{Ct as r,Dt as i,Et as a,Ot as o,et as s,nt as c,tt as l,wt as u}from"./vendor-ui-CoN_S3CW.js";import{c as d,g as f,i as p,l as m,p as h,s as g,t as _}from"./index-sjNJbz6q.js";import{t as v}from"./useYamlLoader-BaE80gnd.js";import{t as y}from"./lodash-_UMXHexr.js";import{n as b,t as x}from"./ItemDataContext-qOOkkKFR.js";var S=e(t(),1),C=e(n(),1),w=(0,S.createContext)(null);const T=({children:e})=>{let[t,n]=(0,S.useState)([]),[r,i]=(0,S.useState)(!0),a=v();return(0,S.useEffect)(()=>{let e=!1;async function t(){try{let t=await a(`data/servers.yaml`);if(e)return;n(t.servers??[])}catch(e){console.error(e)}finally{e||i(!1)}}return t(),()=>{e=!0}},[a]),(0,C.jsx)(w.Provider,{value:{servers:t,loading:r},children:e})};function E(){let e=(0,S.useContext)(w);if(!e)throw Error(`useServerData must be used inside <ServerDataProvider>`);return e}var D=(0,S.createContext)(null);async function O(e){let t=m()+`/characters/info?server=${e.serverId}&character=${encodeURIComponent(e.characterId)}`,n=await fetch(t,{method:`GET`});if(!n.ok)throw Error(`Search failed: ${n.status}`);return(await n.json())?.data}const k=({children:e})=>{let t=g({from:_.fullPath}),n=d({from:_.fullPath}),[r,i]=(0,S.useState)(n.serverId??null),[a,o]=(0,S.useState)(n.characterId??null),[s,c]=(0,S.useState)(null),[l,u]=(0,S.useState)(null),[f,p]=(0,S.useState)([]),[m,h]=(0,S.useState)(!1),[y,b]=(0,S.useState)(null),x=v();(0,S.useEffect)(()=>{let e=!1;async function t(){try{let t=await x(`data/stats.yaml`);if(e)return;u(t)}catch{e||b(`Failed to load stats data`)}}return t(),()=>{e=!0}},[x]),(0,S.useEffect)(()=>{let e=!1;async function t(){try{let t=await x(`data/skills.yaml`);if(e)return;p(t.skills??[])}catch{e||b(`Failed to load skills data`)}}return t(),()=>{e=!0}},[x]);let w=(0,S.useMemo)(()=>{let e=new Map;for(let t of f)e.set(t.id,t);return e},[f]);(0,S.useEffect)(()=>{i(n.serverId??null),o(n.characterId??null)},[n.serverId,n.characterId]);let T=e=>{i(e.serverId),o(e.characterId),t({replace:!0,search:t=>({...t,serverId:e.serverId,characterId:e.characterId})})},E=()=>{i(null),o(null),c(null),b(null),h(!1),t({replace:!0,search:e=>({...e,serverId:void 0,characterId:void 0})})};(0,S.useEffect)(()=>{let e=!1;async function t(){if(!r||!a){c(null),h(!1),b(null);return}try{h(!0),b(null);let t=await O({serverId:r,characterId:a});if(e)return;c(t)}catch(t){if(e)return;c(null),b(t instanceof Error?t.message:String(t))}finally{e||h(!1)}}return t(),()=>{e=!0}},[r,a]);let k=(0,S.useMemo)(()=>({serverId:r,characterId:a,info:s,stats:l,skills:f,skillsById:w,loading:m,error:y,selectCharacter:T,clearSelection:E}),[r,a,s,l,f,w,m,y]);return(0,C.jsx)(D.Provider,{value:k,children:e})};function A(){let e=(0,S.useContext)(D);if(!e)throw Error(`useCharacter must be used inside <CharacterProvider>`);return e}function j(){let{servers:e,loading:t}=E(),{selectCharacter:n}=A(),{t:r}=f(),[i,a]=(0,S.useState)(`1`),[o,u]=(0,S.useState)(`all`),[d,p]=(0,S.useState)(``),[h,g]=(0,S.useState)(!1),[_,v]=(0,S.useState)([]),y=(0,S.useRef)(0),b=(0,S.useMemo)(()=>{let t=Number(i);return e.filter(e=>e.raceId===t)},[e,i]);(0,S.useEffect)(()=>{o!==`all`&&(b.some(e=>String(e.serverId)===o)||u(`all`))},[b,o]),(0,S.useEffect)(()=>{let e=d.trim(),t=Number(i),n=o===`all`?void 0:Number(o);if(v([]),!e||!t)return;let r=++y.current,a=window.setTimeout(async()=>{try{g(!0);let i=await x({keyword:e,raceId:t,serverId:n});if(y.current!==r)return;v(i)}catch(e){console.error(e),y.current===r&&v([])}finally{y.current===r&&g(!1)}},300);return()=>window.clearTimeout(a)},[d,i,o]);async function x(e){let t=m()+`/characters/search?race=${e.raceId}&keyword=${encodeURIComponent(e.keyword)}`,n=e.serverId?`${t}&server=${e.serverId}`:t,r=await fetch(n,{method:`GET`});if(!r.ok)throw Error(`Search failed: ${r.status}`);return(await r.json()).data?.results??[]}let w=(0,S.useCallback)((e,t,n)=>{let i=n%1e3;return`${e} (${t===1?r(`common:server.lightAbbr`,`Light `):r(`common:server.darkAbbr`,`Dark `)}${i})`},[r]),T=(0,S.useMemo)(()=>{let e=[{key:`all`,label:r(`common:server.allServers`,`All servers`)}];for(let t of b)e.push({key:String(t.serverId),label:w(t.serverName,t.raceId,t.serverId)});return e},[b,r,w]),D=`
    !bg-character-input hover:!bg-character-input focus:!bg-character-input !transition-none 
    border-1 border-crafting-border shadow-none
    group-data-[hover=true]:!bg-character-input
    group-data-[focus=true]:!bg-character-input
    group-data-[focus-visible=true]:!bg-character-input
    group-data-[invalid=true]:!bg-character-input
  `,O={inputWrapper:D,innerWrapper:`h-10 py-0`},k={trigger:D+`border-r-0`,innerWrapper:`h-10 py-0`};return(0,C.jsxs)(`div`,{className:`flex flex-row gap-0 items-end w-full justify-end`,children:[(0,C.jsxs)(l,{placeholder:r(`common:server.race`,`Race`),isRequired:!0,selectedKeys:new Set([i]),onSelectionChange:e=>{let t=e.currentKey;(t===`1`||t===`2`)&&a(t)},className:`w-[100px] flex-none`,radius:`none`,classNames:k,children:[(0,C.jsx)(c,{children:r(`common:server.light`,`Light`)},`1`),(0,C.jsx)(c,{children:r(`common:server.dark`,`Dark`)},`2`)]}),(0,C.jsx)(l,{placeholder:r(`common:server.server`,`Server`),isRequired:!1,isDisabled:t||b.length===0,items:T,selectedKeys:new Set([o]),onSelectionChange:e=>{let t=e.currentKey;u(t?String(t):`all`)},className:`w-[130px] flex-none`,renderValue:e=>e[0]?.textValue??``,radius:`none`,classNames:k,children:e=>(0,C.jsx)(c,{textValue:e.label,children:e.label},e.key)}),(0,C.jsx)(s,{placeholder:r(`common:server.search`,`Type to search...`),inputValue:d,onInputChange:p,onSelectionChange:e=>{let t=_.find(t=>t.id===e);t&&n({serverId:t.serverId,characterId:t.id})},isDisabled:t,isLoading:h,items:_,className:`w-[160px] flex-none`,radius:`none`,inputProps:{classNames:O},children:e=>(0,C.jsx)(c,{textValue:e.name,children:(0,C.jsxs)(`div`,{className:`flex items-center gap-2 w-full`,children:[(0,C.jsx)(`img`,{src:`https://profileimg.plaync.com${e.profileImageUrl}`,alt:e.name,className:`w-[40px] h-[40px] object-cover rounded-md shrink-0`,draggable:!1}),(0,C.jsxs)(`div`,{className:`min-w-0 flex-1`,children:[(0,C.jsxs)(`div`,{className:`flex justify-between text-sm font-medium`,children:[(0,C.jsx)(`span`,{className:`truncate text-default-800`,children:e.name}),(0,C.jsxs)(`span`,{className:`shrink-0 text-default-600`,children:[`Lv.`,e.level]})]}),(0,C.jsx)(`div`,{className:`truncate text-xs text-default-700`,children:e.serverName})]})]})},e.id)})]})}var M=e(y(),1);function N(){let{info:e,loading:t,error:n,characterId:s,stats:c,skillsById:l}=A(),{itemsById:d}=b(),{t:m,i18n:g}=f();if(n)return(0,C.jsx)(`div`,{className:`grid place-items-center py-20 text-default-500`,children:(0,C.jsxs)(`div`,{className:`rounded-lg border border-default-200 bg-content2 px-6 py-3 text-sm`,children:[`Error loading character: `,n]})});if(t)return(0,C.jsx)(`div`,{className:`flex justify-center items-center py-20`,children:(0,C.jsx)(a,{})});if(!e||!c)return null;let _={base:`!bg-transparent !shadow-none !backdrop-filter-none !backdrop-blur-none pb-2 `,trigger:`py-4 min-h-0 px-2`,title:`text-[16px] leading-[16px] font-bold`,content:`py-0`,indicator:`text-default-700`},v=(0,M.keyBy)(e.stats,`type`),y=e=>{let t=c[e];return(0,C.jsx)(`div`,{className:`grid grid-cols-6 gap-4`,children:t?.map((t,n)=>(0,C.jsxs)(`div`,{className:`text-center bg-character-input rounded-md border-1 border-crafting-border p-2`,children:[(0,C.jsx)(`div`,{className:`h-[60px] w-[60px] mx-auto rounded-lg`,children:(0,C.jsx)(`img`,{src:h(t.icon),alt:t.type,className:`w-full h-full object-cover`,draggable:!1})}),(0,C.jsx)(`div`,{className:`text-[18px] text-default-800`,children:m(`stats:${e}.${t.type}.name`)}),(0,C.jsx)(`div`,{className:`text-[18px] text-default-800`,children:v[t.type]?.value??`-`})]},n))})},x=t=>{let n=(e.skills??[]).filter(e=>l.get(e.id)?.category===t)??[];return(0,C.jsxs)(`div`,{className:`flex gap-0 border-1 border-crafting-border rounded-lg`,children:[(0,C.jsx)(`div`,{className:`w-[38px] shrink-0 flex items-center justify-center bg-character-input border-r-1 border-crafting-border`,children:(0,C.jsx)(`div`,{className:`w-[18px] text-center text-[18px] font-semibold text-default-700 break-words`,children:m(`common:skills.category.${t.toLowerCase()}`,t)})}),(0,C.jsx)(`div`,{className:`flex flex-wrap gap-3 p-3`,children:n.map(e=>{let t=l.get(e.id),n=t?.icon?h(`UI/Resource/Texture/Skill/${t.icon}`):void 0;return(0,C.jsxs)(`div`,{className:`relative h-[48px] w-[48px] overflow-hidden rounded-md`,children:[n?(0,C.jsx)(`img`,{src:n,alt:String(e.id),className:`h-full w-full object-cover`,draggable:!1}):(0,C.jsx)(`div`,{className:`h-full w-full bg-default-200`}),(0,C.jsxs)(`div`,{className:`absolute bottom-0 right-0 bg-black/60 text-white text-[14px] px-1 rounded-tl-md`,children:[`LV`,e.skillLevel]})]},String(e.id))})})]})},S=()=>{let t=[`Attack`,`Defense`,`Etc`],n=[`UT_Stat_GrowthSummary_Title_First.webp`,`UT_Stat_GrowthSummary_Title_Second.webp`,`UT_Stat_GrowthSummary_Title_Third.webp`];return(0,C.jsx)(`div`,{className:`grid grid-cols-3 gap-4`,children:t.map((t,r)=>{let i=e.titles?.find(e=>e.equipCategory===t),a=h(`UI/Resource/Texture/ETC/UT_SlotGrade_${i?.grade??`Common`}.webp`),o=h(`UI/Resource/Texture/ETC/${n[r]}`);return(0,C.jsxs)(`div`,{className:`relative overflow-hidden rounded-md border-1 border-crafting-border bg-character-input p-3`,children:[(0,C.jsx)(`div`,{className:`absolute inset-0 bg-center bg-no-repeat bg-contain`,style:{backgroundImage:`url(${a})`,backgroundSize:`100% 100%`}}),(0,C.jsxs)(`div`,{className:`relative flex flex-col items-center gap-2`,children:[(0,C.jsx)(`div`,{className:`h-[80px] w-[80px] overflow-hidden rounded-md`,children:(0,C.jsx)(`img`,{src:o,alt:t,className:`h-full w-full object-cover`,draggable:!1})}),(0,C.jsx)(`div`,{className:`text-sm font-semibold text-white`,children:i?.name??``})]})]},t)})})},w=(0,M.keyBy)(e.equipments??[],`slotPos`),T=[1,2,3,4,5,17,6,7,8,19],E=[11,12,10,22,13,14,15,16,23,24],D=e=>{let t=w[e],n=t?d.get(t.id):null,r=h(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${n?.grade??`Common`}.webp`),i=h(n?.icon||``),a=m(`items/items:${t.id}.name`,String(t.id));return(0,C.jsx)(`div`,{className:`relative h-[56px] bg-contain bg-center bg-no-repeat rounded-[4px] shadow-none`,style:{backgroundImage:`url(${r})`,backgroundSize:`100% 100%`},title:a,children:(0,C.jsxs)(`div`,{className:`flex h-full w-full items-center rounded-[4px] px-2`,children:[(0,C.jsx)(`img`,{src:i,alt:a,className:`h-12 w-12 shrink-0 object-contain`,draggable:!1}),(0,C.jsxs)(`div`,{className:`ml-2 flex h-[48px] min-w-0 flex-1 flex-col justify-center`,children:[(0,C.jsx)(`div`,{className:`truncate text-left text-[13px] font-bold leading-[13px] text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.35)]`,children:`${a} +${t.enchantLevel}`}),(0,C.jsxs)(`div`,{className:`mt-2 flex items-center justify-start gap-0`,children:[t?.exceedLevel?Array.from({length:t.exceedLevel}).map((e,t)=>(0,C.jsx)(`div`,{className:`h-[16px] w-[16px] overflow-hidden rounded-sm flex justify-center items-center`,children:(0,C.jsx)(`img`,{src:h(`UI/Resource/Texture/Icon/UT_NP_QuestMonolith_Acquired.webp`),alt:`exceed-level`,className:`h-full w-full object-contain`,style:{objectFit:`contain`,objectPosition:`0% 50%`,transform:`scale(3)`},draggable:!1})},t)):null,(!t?.exceedLevel||t.exceedLevel===0)&&(0,C.jsx)(`div`,{className:`h-[16px] w-[16px] shrink-0`})]})]})]})},e)};return(0,C.jsxs)(`div`,{className:`w-full space-y-4`,children:[(0,C.jsx)(r,{className:`shadow-none border-default-200 bg-character-input border-1 border-crafting-border rounded-lg`,children:(0,C.jsxs)(u,{className:`flex flex-col items-center gap-2`,children:[(0,C.jsx)(`div`,{className:`w-[72px] h-[72px] rounded-full overflow-hidden bg-default-100 flex justify-center items-center`,children:(0,C.jsx)(`img`,{src:e.profile.profileImage,alt:`avatar`,className:`w-full h-full object-cover`,draggable:!1})}),(0,C.jsxs)(`div`,{className:`w-full text-center text-default-800`,children:[(0,C.jsxs)(`div`,{className:`text-[18px]`,children:[e.profile.characterName,` [`,(0,C.jsx)(`span`,{className:`text-grade-${(0,M.lowerCase)(e.profile.titleGrade)}`,children:e.profile.titleName}),`]`]}),(0,C.jsxs)(`div`,{className:`mt-2 text-[14px]`,children:[e.profile.raceName,` | `,e.profile.serverName,` | `,e.profile.className,` |`,` `,e.profile.regionName,` | `,(0,C.jsxs)(`span`,{className:`font-semibold`,children:[`战力值`,v.ItemLevel.value]}),` | 更新于 `,p(e.updatedAt).locale(g.language.toLowerCase().split(`-`)[0]).fromNow()]})]})]})}),(0,C.jsxs)(`div`,{className:`grid grid-cols-2 gap-4`,children:[(0,C.jsx)(`div`,{children:(0,C.jsxs)(o,{variant:`light`,selectionMode:`multiple`,defaultExpandedKeys:[`stats`,`skills`],itemClasses:_,showDivider:!1,children:[(0,C.jsxs)(i,{title:`主要能力值`,children:[(0,C.jsx)(`div`,{className:`mb-4`,children:y(`mainStats`)}),(0,C.jsx)(`div`,{children:y(`lordStats`)})]},`stats`),(0,C.jsx)(i,{title:`技能`,children:(0,C.jsxs)(`div`,{className:`space-y-4`,children:[x(`Active`),x(`Passive`),x(`Dp`)]})},`skills`)]})}),(0,C.jsx)(`div`,{children:(0,C.jsxs)(o,{variant:`light`,selectionMode:`multiple`,defaultExpandedKeys:[`equipments`,`titles`,`cards`],itemClasses:_,showDivider:!1,children:[(0,C.jsx)(i,{title:`装备`,children:(()=>(0,C.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,C.jsx)(`div`,{className:`flex flex-col gap-3`,children:T.map(e=>D(e))}),(0,C.jsx)(`div`,{className:`flex flex-col gap-3`,children:E.map(e=>D(e))})]}))()},`equipments`),(0,C.jsx)(i,{title:`阿尔卡那`,children:(()=>{let t=(0,M.keyBy)(e.equipments??[],`slotPos`);return(0,C.jsx)(`div`,{className:`flex w-full justify-between gap-4`,children:[41,42,43,44,45].map(e=>{let n=t[e],r=h((n?d.get(n.id):null)?.icon||``),i=m(`items/items:${n?.id}.name`,String(n?.id??``));return(0,C.jsxs)(`div`,{className:`relative flex justify-center items-start`,style:{height:`80px`,width:`80px`},title:i,children:[r?(0,C.jsx)(`img`,{src:r,alt:i,className:`object-contain rounded-lg`,style:{width:`80px`,height:`80px`},draggable:!1}):(0,C.jsx)(`div`,{className:`bg-default-200 rounded-lg w-full h-full`}),(0,C.jsxs)(`div`,{className:`absolute left-1/2 -translate-x-1/2 bottom-[4px] text-white bg-black/60 px-2 rounded-lg text-[14px] font-bold pointer-events-none`,children:[`+`,n?.enchantLevel??0]})]},e)})})})()},`cards`),(0,C.jsx)(i,{title:`称号`,children:S()},`titles`)]})})]}),!s&&(0,C.jsx)(`div`,{className:`grid place-items-center py-10 text-default-400 text-sm`,children:`No character selected.`})]})}function P(){return(0,C.jsx)(`div`,{className:`h-full overflow-y-auto bg-chacracter-page`,children:(0,C.jsxs)(`div`,{className:`max-w-6xl mx-auto px-4 py-6 space-y-4`,children:[(0,C.jsx)(j,{}),(0,C.jsx)(N,{})]})})}var F=()=>(0,C.jsx)(x,{children:(0,C.jsx)(k,{children:(0,C.jsx)(T,{children:(0,C.jsx)(P,{})})})});export{F as component};