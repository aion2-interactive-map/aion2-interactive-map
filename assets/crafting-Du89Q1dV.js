import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-B79ZDZsn.js";import{$ as r,Ct as i,F as a,H as o,M as s,Q as c,Tt as l,W as u,Y as d,dt as f,ft as p,it as m,lt as h,pt as g,q as _,rt as v,ut as y,wt as b}from"./vendor-ui-C67xEdjT.js";import{a as x,f as S,l as C}from"./index-m7FRz4l2.js";import{t as w}from"./useYamlLoader-Zk8pcv7j.js";var T=e(t(),1),E=e(n(),1),D=(0,T.createContext)(null);const O=({children:e})=>{let[t,n]=(0,T.useState)([]),[r,i]=(0,T.useState)([]),[a,o]=(0,T.useState)([]),[s,c]=(0,T.useState)([]),[l,u]=(0,T.useState)([]),[d,f]=(0,T.useState)([]),[p,m]=(0,T.useState)([]),[h,g]=(0,T.useState)(!0),_=w();(0,T.useEffect)(()=>{let e=!1;async function t(){try{let[t,r,a,s,l,d,p]=await Promise.all([_(`data/classes.yaml`),_(`data/items/items.yaml`),_(`data/items/types.yaml`),_(`data/items/grades.yaml`),_(`data/items/crafting.yaml`),_(`data/items/slots.yaml`),_(`data/items/tiers.yaml`)]);if(e)return;n(t.classes??[]),i(r.items??[]),o(a.categories??[]),c(s.grades??[]),u(l.crafting??[]),f(d.slots??[]),m(p.tiers??[])}catch(e){console.error(e)}finally{e||g(!1)}}return t(),()=>{e=!0}},[_]);let v=(0,T.useMemo)(()=>{let e=new Map;for(let t of r)e.set(t.id,t);return e},[r]),y=(0,T.useMemo)(()=>{let e=new Map;for(let t of l)e.set(t.id,t);return e},[l]),b=(0,T.useMemo)(()=>{let e=new Map;for(let t of d)e.set(t.key,t);return e},[d]),x=(0,T.useMemo)(()=>{let e=new Map;for(let t of s)e.set(t.name,t);return e},[s]),S=(0,T.useMemo)(()=>{let e=new Map;for(let t of l){let n=v.get(t.id);if(!n)continue;let r=n.subtype;e.has(r)||e.set(r,[]),e.get(r).push(t.id)}for(let t of e.values())t.sort((e,t)=>e-t);return e},[l,v]),C=(0,T.useMemo)(()=>{let e=new Map;for(let t of a)for(let n of t.subtypes??[])e.set(n.name,t.name);return e},[a]),O=(0,T.useMemo)(()=>{let e=new Map;for(let t of p)e.set(t.name,t);return e},[p]),k=(0,T.useMemo)(()=>{let e=new Map;for(let t of p)for(let n of t.items??[])e.has(n)||e.set(n,t.name);return e},[p]);return(0,E.jsx)(D.Provider,{value:{classes:t,items:r,types:a,grades:s,crafting:l,slots:d,tiers:p,itemsById:v,craftingById:y,slotsByKey:b,gradesByName:x,craftingItemIdsByType:S,subtypeToCategory:C,tiersByName:O,tierNameByItemId:k,loading:h},children:e})};function k(){let e=(0,T.useContext)(D);if(!e)throw Error(`useItemData must be used inside <ItemDataProvider>`);return e}function A(...e){for(let t of e)if(t&&t.trim().length>0)return t;return``}function j(e){let t=e?.itemId,n=e?.count;return{itemId:typeof t==`number`||t===null?t:null,count:typeof n==`number`&&Number.isFinite(n)?n:0}}function M(e){return!Number.isFinite(e)||e<0?0:e>99?99:Math.floor(e)}function N(e,t){return!t||e==null?!0:e===t}function P({selectedBySlotKey:e,setSelectedBySlotKey:t,race:n}){let[r,i]=(0,T.useState)(!1),[a,s]=(0,T.useState)(null),[b,x]=(0,T.useState)(``),[w,D]=(0,T.useState)(`thumbnail`),{craftingItemIdsByType:O,craftingById:P,slots:F,items:I,gradesByName:L}=k(),{t:R}=S(),z=(0,T.useMemo)(()=>a?F.find(e=>e.key===a)??null:null,[a,F]),B=(0,T.useMemo)(()=>z?.allowed_types??[],[z]);(0,T.useEffect)(()=>{if(!r)return;let e=B[0]??``;(!b||e&&!B.includes(b))&&x(e)},[r,B,b]);let V=(0,T.useMemo)(()=>b?(O.get(b)??[]).filter(e=>N(P.get(e)?.race??null,n)):[],[b,O,P,n]),H=(0,T.useMemo)(()=>{if(!z||!b)return[];let e=new Set(V);return I.filter(t=>t.subtype===b&&e.has(t.id))},[z,b,I,V]);function U(e){s(e),i(!0)}function W(e,n){t(t=>{let r=j(t[e]),i=r.count>0?r.count:1;return{...t,[e]:{...r,itemId:n,count:i}}}),i(!1)}function G(e){t(t=>{let n=j(t[e]);return{...t,[e]:{...n,itemId:null,count:0}}}),i(!1)}function K(){t(e=>{let t={};for(let n of F){let r=j(e[n.key]);t[n.key]={...r,itemId:null,count:0}}return t})}function q(e,n){t(t=>{let r=j(t[e]);if(!r.itemId)return t;let i=M(r.count+n);return{...t,[e]:{...r,count:i}}})}let J=[];J=w===`thumbnail`?F:w===`weapon_armor`?F.slice(0,10):F.slice(10,20);let Y=w===`thumbnail`?`grid grid-cols-2 gap-2`:`grid grid-cols-1 gap-2`;return(0,E.jsxs)(`div`,{className:`flex h-full w-full flex-col`,children:[(0,E.jsx)(`div`,{className:`my-3 h-[38px] text-center text-[22px] font-bold text-default-900`,children:R(`common:crafting.selectClick`,`Click to select equipment`)}),(0,E.jsx)(`div`,{className:`flex-1 overflow-y-auto no-scrollbar`,children:(0,E.jsx)(`div`,{className:`flex w-full justify-center `,children:(0,E.jsx)(`div`,{className:Y,children:J.map(t=>{let n=j(e[t.key]),r=n.itemId,i=n.count,a=r?I.find(e=>e.id===r):void 0,s=C(A(a?.icon,t.icon)),l=R(`items/types:subtypes.${t.name}.name`,t.name),d=a?R(`items/items:${a.id}.name`,String(a.id)):l,f=L.get(a?.grade||``)?.name||``,p=()=>{t.craftable&&U(t.key)},m=(0,E.jsx)(`div`,{className:`pointer-events-none flex items-center justify-center`,children:(0,E.jsxs)(`div`,{className:`pointer-events-auto flex items-center gap-2 rounded-sm bg-black/40 px-1`,children:[(0,E.jsx)(`button`,{type:`button`,onClick:e=>{e.preventDefault(),e.stopPropagation(),q(t.key,-1)},disabled:!r||i<=0,className:[`flex h-[16px] w-[16px] items-center justify-center rounded-sm`,!r||i<=0?`opacity-40`:`hover:bg-black/30`].join(` `),title:R(`common:crafting.minus`,`Minus`),children:(0,E.jsx)(c,{icon:o,className:`text-[10px] text-white`})}),(0,E.jsx)(`div`,{className:`min-w-[18px] text-center text-[12px] font-bold leading-[12px] text-white`,children:r?String(Math.max(0,i)):`0`}),(0,E.jsx)(`button`,{type:`button`,onClick:e=>{e.preventDefault(),e.stopPropagation(),q(t.key,1)},disabled:!r,className:[`flex h-[16px] w-[16px] items-center justify-center rounded-sm`,r?`hover:bg-black/30`:`opacity-40`].join(` `),title:R(`common:crafting.plus`,`Plus`),children:(0,E.jsx)(c,{icon:u,className:`text-[10px] text-white`})})]})});return w===`thumbnail`?(0,E.jsxs)(`button`,{type:`button`,onClick:p,className:`relative h-12 w-[89px] rounded-sm bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${C(`UI/Resource/Texture/ETC/UT_SlotGrade_${f}.webp`)})`,backgroundSize:`100% 100%`},title:l,children:[(0,E.jsx)(`div`,{className:`flex h-full w-full items-center justify-center rounded-sm ${r?``:`bg-[#0D0E15]`}`,children:(0,E.jsx)(`img`,{src:s,alt:t.name,className:`h-full w-full object-contain`})}),(0,E.jsx)(`div`,{className:`pointer-events-none absolute inset-x-1 top-[2px] z-20`,children:(0,E.jsx)(`div`,{className:`truncate text-center text-[12px] font-bold leading-[12px] text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.35)]`,children:l})}),a&&(0,E.jsx)(`div`,{className:`pointer-events-none absolute inset-x-0 bottom-[2px] z-20 flex justify-center`,children:m})]},t.key):(0,E.jsx)(`button`,{type:`button`,onClick:p,className:`relative h-[56px] w-[188px] rounded-sm bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${C(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${f}.webp`)})`,backgroundSize:`100% 100%`},title:d,children:(0,E.jsxs)(`div`,{className:`flex h-full w-full items-center rounded-sm px-2 ${r?``:`bg-[#0D0E15]`}`,children:[(0,E.jsx)(`img`,{src:s,alt:t.name,className:`h-12 w-12 shrink-0 object-contain`}),(0,E.jsxs)(`div`,{className:`ml-2 flex h-[48px] min-w-0 flex-1 flex-col justify-center`,children:[(0,E.jsx)(`div`,{className:`truncate text-left text-[13px] font-bold leading-[13px] text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.35)]`,children:d}),a&&(0,E.jsx)(`div`,{className:`mt-1 flex items-center`,children:m})]})]})},t.key)})})})}),(0,E.jsx)(`div`,{className:`mt-2 w-full`,children:(0,E.jsx)(l,{size:`sm`,variant:`flat`,onPress:K,className:`h-[34px] w-full rounded-sm border-1 border-crafting-border bg-crafting-sum`,children:(0,E.jsxs)(`span`,{className:`flex w-full items-center justify-center gap-2 text-[14px] text-default-800`,children:[(0,E.jsx)(c,{icon:d}),R(`common:crafting.clearAll`,`Clear all slots`)]})})}),(0,E.jsx)(`div`,{className:`mt-2`,children:(0,E.jsxs)(m,{selectedKey:w,onSelectionChange:e=>D(e),variant:`light`,className:`w-full rounded-sm border-1 border-crafting-border bg-crafting-sum`,classNames:{tabList:`w-full flex gap-0`,tab:`h-[30px] flex-1 justify-center data-[selected=true]:bg-primary dark:data-[selected=true]:bg-default-800`,tabContent:`flex items-center justify-center text-default-800 group-data-[selected=true]:text-background`},children:[(0,E.jsx)(v,{title:(0,E.jsx)(c,{icon:_})},`thumbnail`),(0,E.jsx)(v,{title:R(`common:crafting.weaponOrArmor`,`Weapon / Armor`)},`weapon_armor`),(0,E.jsx)(v,{title:R(`common:crafting.accessory`,`Accessory`)},`accessory`)]})}),(0,E.jsx)(h,{isOpen:r,onOpenChange:e=>i(e),size:`5xl`,children:(0,E.jsx)(p,{className:`w-fit max-w-none`,children:e=>(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(y,{className:`flex flex-col gap-2`,children:[(0,E.jsx)(`div`,{children:R(`common:crafting.select`,`Select item`)}),z&&B.length>0?(0,E.jsx)(m,{selectedKey:b,onSelectionChange:e=>x(String(e)),variant:`underlined`,classNames:{tabList:`gap-2`,cursor:`bg-default-800`,tab:`h-8`},children:B.map(e=>(0,E.jsx)(v,{title:R(`items/types:subtypes.${e}.name`,e)},e))}):null]}),(0,E.jsx)(g,{children:z?(0,E.jsx)(`div`,{className:`flex flex-col gap-3`,children:(0,E.jsx)(`div`,{className:`max-h-[560px] overflow-y-auto`,children:(0,E.jsxs)(`div`,{className:`grid grid-cols-3 gap-5`,children:[H.map(e=>{let t=R(`items/items:${e.id}.name`,e.subtype);return(0,E.jsxs)(`button`,{type:`button`,onClick:()=>W(z.key,e.id),className:`flex items-center rounded-sm border-2 border-default bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${C(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${L.get(e.grade)?.name}.webp`)})`,backgroundSize:`100% 100%`},title:`${e.id} (${e.subtype})`,children:[(0,E.jsx)(`img`,{src:C(e.icon),alt:String(e.id),className:`h-16 w-16 object-contain`}),(0,E.jsx)(`div`,{className:`flex h-16 w-[160px] items-center px-2 text-left text-[14px] font-bold text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.3)]`,children:t})]},e.id)}),H.length===0&&(0,E.jsx)(`div`,{className:`col-span-3 text-sm text-default-500`,children:`No craftable items match this slot’s allowed types.`})]})})}):(0,E.jsx)(`div`,{className:`text-sm text-default-500`,children:`No slot selected.`})}),(0,E.jsxs)(f,{children:[z?(0,E.jsx)(l,{variant:`flat`,color:`danger`,onPress:()=>G(z.key),children:R(`common:ui.clear`)}):null,(0,E.jsx)(l,{variant:`flat`,onPress:e,children:R(`common:ui.close`)})]})]})})})]})}function F(e){let t=Number(e);return Number.isFinite(t)?t:0}function I(e){return typeof e!=`number`||!Number.isFinite(e)?0:Math.max(0,Math.floor(e))}var L=`aion2.crafting.prices.v1`,R=`aion2.crafting.materialOwned.v1`,z=[`Equipment`,`CraftResource`,`GatherResource`];function B(e){return e===`CraftResource`?`CraftResource`:e===`GatherResource`?`GatherResource`:`Equipment`}function V({selectedBySlotKey:e}){let{craftingById:t,itemsById:n,gradesByName:i}=k(),{t:l}=S(),[d,f]=(0,T.useState)(()=>{try{let e=localStorage.getItem(L);return e?JSON.parse(e):{}}catch{return{}}});(0,T.useEffect)(()=>{localStorage.setItem(L,JSON.stringify(d))},[d]);let[p,m]=(0,T.useState)(()=>{try{let e=localStorage.getItem(R);return e?JSON.parse(e):{}}catch{return{}}});(0,T.useEffect)(()=>{localStorage.setItem(R,JSON.stringify(p))},[p]);let h=(0,T.useMemo)(()=>{let n=new Map;for(let r of Object.values(e)){if(!r)continue;let e=r.itemId??null;if(!e)continue;let i=I(r.count);if(i<=0)continue;let a=t.get(e);if(a)for(let e of a.materials??[]){let t=I(e.count??0);if(t<=0)continue;let r=n.get(e.id)??0;n.set(e.id,r+t*i)}}let r=Array.from(n.entries()).map(([e,t])=>({id:e,count:t}));return r.sort((e,t)=>e.id-t.id),r},[e,t]),g=(0,T.useMemo)(()=>{let e={Equipment:[],CraftResource:[],GatherResource:[]};for(let t of h)e[B(n.get(t.id)?.subtype)].push(t);for(let t of Object.values(e))t.sort((e,t)=>e.id-t.id);return e},[h,n]);function _(e){let t=p[e];if(t==null||t===``)return 0;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function v(e){let t=_(e.id);return Math.max(0,e.count-t)}let y=(0,T.useMemo)(()=>{let e={Equipment:0,CraftResource:0,GatherResource:0};for(let t of z){let n=0;for(let e of g[t]){let t=v(e),r=F(d[e.id]??``);n+=t*r}e[t]=n}return e},[g,d,p]),b=(0,T.useMemo)(()=>z.reduce((e,t)=>e+y[t],0),[y]);function x(e){m(t=>{let n=_(e.id),r=Math.max(0,n-1);return{...t,[e.id]:String(r)}})}function w(e){m(t=>{let n=_(e.id)+1;return{...t,[e.id]:String(n)}})}return(0,E.jsxs)(`div`,{className:`flex h-full w-full flex-col`,children:[(0,E.jsx)(`div`,{className:`flex-1 overflow-hidden`,children:h.length===0?(0,E.jsx)(`div`,{className:`text-sm text-default-500`}):(0,E.jsx)(`div`,{className:`grid h-full min-h-0 min-w-0 grid-cols-[1fr_auto_1fr_auto_1fr] gap-3`,children:z.map((e,t)=>{let a=g[e];return(0,E.jsxs)(T.Fragment,{children:[(0,E.jsxs)(`div`,{className:`flex h-full min-h-0 flex-col rounded-lg border border-crafting-border bg-transparent`,children:[(0,E.jsx)(`div`,{className:`m-2 flex h-[38px] items-center justify-center border-b border-crafting-border px-3 py-2`,children:(0,E.jsx)(`div`,{className:`text-[16px] font-bold leading-[16px] text-default-900`,children:l(`items/types:subtypes.${e}.name`,e)})}),(0,E.jsx)(`div`,{className:`flex-1 overflow-y-auto no-scrollbar p-3`,children:(0,E.jsx)(`div`,{className:`flex flex-col gap-2`,children:a.length===0?(0,E.jsx)(`div`,{className:`text-xs text-default-500`,children:`No materials`}):a.map(e=>{let t=n.get(e.id),a=l(`items/items:${e.id}.name`,String(e.id)),s=t?.icon?C(t.icon):``,p=d[e.id]??``,h=C(`UI/Resource/Texture/ETC/UT_SlotGrade_${i.get(t?.grade||``)?.name}.webp`),g=_(e.id);return(0,E.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-lg border border-default-200 bg-crafting-item p-2`,children:[(0,E.jsx)(`div`,{className:`truncate text-sm font-semibold text-default-900`,children:a}),(0,E.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,E.jsx)(`div`,{className:`flex h-12 w-12 items-center justify-center rounded-sm bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${h})`},children:s?(0,E.jsx)(`img`,{src:s,alt:a,className:`h-12 w-12 object-contain`}):(0,E.jsx)(`div`,{className:`text-xs text-default-500`,children:e.id})}),(0,E.jsxs)(`div`,{className:`flex min-w-0 flex-1 flex-col gap-2`,children:[(0,E.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,E.jsx)(`div`,{role:`button`,tabIndex:0,className:`flex h-4 w-4 cursor-pointer items-center justify-center rounded-full bg-primary dark:bg-secondary hover:opacity-80`,onClick:()=>x(e),onKeyDown:t=>{(t.key===`Enter`||t.key===` `)&&x(e)},title:`-`,children:(0,E.jsx)(c,{icon:o,className:`text-[10px] text-white`})}),(0,E.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,E.jsx)(`span`,{className:`inline-flex align-middle -translate-y-[1px]`,style:{width:`${Math.max(3,String(g).length)}ch`},children:(0,E.jsx)(r,{size:`sm`,hideStepper:!0,value:g,onValueChange:t=>{let n=I(t??0);m(t=>({...t,[e.id]:n===0?``:String(n)}))},radius:`none`,classNames:{base:`w-full`,inputWrapper:`w-full bg-transparent border-0 shadow-none px-0 h-[20px] min-h-[20px] group-data-[hover=true]:bg-transparent group-data-[focus=true]:bg-transparent focus-within:shadow-none`,input:`w-full h-[20px] text-[14px] leading-[20px] text-center p-0 text-default-900 bg-transparent`}})}),(0,E.jsxs)(`div`,{className:`text-sm font-semibold text-default-900`,children:[`/ `,e.count]})]}),(0,E.jsx)(`div`,{role:`button`,tabIndex:0,className:`flex h-4 w-4 cursor-pointer items-center justify-center rounded-full bg-primary dark:bg-secondary hover:opacity-80`,onClick:()=>w(e),onKeyDown:t=>{(t.key===`Enter`||t.key===` `)&&w(e)},title:`+`,children:(0,E.jsx)(c,{icon:u,className:`text-[10px] text-white`})})]}),(0,E.jsx)(r,{size:`sm`,hideStepper:!0,placeholder:`输入价格`,value:p?Number(p):void 0,onValueChange:t=>f(n=>({...n,[e.id]:t==null?``:String(t)})),radius:`sm`,classNames:{base:`h-[28px]`,inputWrapper:`bg-search-item hover:!bg-search-item transition-none group-data-[hover=true]:!bg-search-item group-data-[focus=true]:!bg-search-item group-data-[focus-visible=true]:!bg-search-item group-data-[invalid=true]:!bg-search-item h-[28px] min-h-[28px] px-2 border border-crafting-border shadow-none focus-within:shadow-none`,input:`h-[28px] text-[14px] leading-[28px]`}})]})]})]},e.id)})})}),(0,E.jsx)(`div`,{className:`relative m-2 h-[38px] rounded-lg border border-primary dark:border-crafting-border bg-crafting-sum`,children:(0,E.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center`,children:(0,E.jsxs)(`div`,{className:`flex items-center gap-2 text-[16px] font-bold text-primary dark:text-default-800`,children:[(0,E.jsx)(c,{icon:s,className:`text-sm`}),l(`common:crafting.sumType`,`Sum: `),y[e].toLocaleString()]})})})]}),t<z.length-1&&(0,E.jsxs)(`div`,{className:`relative flex items-center justify-center`,children:[(0,E.jsx)(`div`,{className:`absolute top-0 bottom-[calc(50%+24px)] w-px bg-crafting-border`}),(0,E.jsx)(`div`,{className:`absolute top-[calc(50%+24px)] bottom-0 w-px bg-crafting-border`}),(0,E.jsx)(`div`,{className:`z-10 flex h-6 w-6 items-center justify-center rounded-full bg-primary dark:bg-secondary`,children:(0,E.jsx)(c,{icon:u,className:`text-[14px] text-white`})})]})]},e)})})}),(0,E.jsxs)(`div`,{className:`flex w-full items-center`,children:[(0,E.jsx)(`div`,{className:`flex-1 h-px bg-crafting-border`}),(0,E.jsx)(`div`,{className:`mx-1 flex h-6 w-6 items-center justify-center rounded-full bg-primary dark:bg-secondary`,children:(0,E.jsx)(c,{icon:a,className:`text-[16px] text-white`})}),(0,E.jsx)(`div`,{className:`flex-1 h-px bg-crafting-border`})]}),(0,E.jsx)(`div`,{className:`relative mt-2 h-[38px] rounded-lg border border-primary dark:border-crafting-border bg-crafting-sum`,children:(0,E.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center`,children:(0,E.jsxs)(`div`,{className:`flex items-center gap-2 text-[16px] font-bold text-primary dark:text-default-800`,children:[(0,E.jsx)(c,{icon:s,className:`text-sm`}),l(`common:crafting.sumTotal`,`Total: `),b.toLocaleString()]})})})]})}var H=`aion2.crafting.selectedTier.v1`,U=`aion2.crafting.selectedEquipments.v1.light`,W=`aion2.crafting.selectedEquipments.v1.dark`,G=[`trueDragon`,`whiteDragon`,`wiseDragon`,`nobleDragon`],K=[`starDragon`,`darkDragon`,`ebonyDragon`,`hornedDragon`];function q(e){return e===`light`?G:K}function J(e){return e===`light`?U:W}function Y(e){let t=typeof e==`number`?e:Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):0}function X(e){if(!e||typeof e!=`object`)return{};let t=e,n={};for(let[e,r]of Object.entries(t)){if(typeof r==`number`||r===null){n[e]={itemId:r,count:r==null?0:1};continue}if(r&&typeof r==`object`){let t=`itemId`in r&&(typeof r.itemId==`number`||r.itemId===null)?r.itemId:null;if(`count`in r){let i=Y(r.count);n[e]={itemId:t,count:t==null?0:i};continue}if(`disabled`in r){let i=typeof r.disabled==`boolean`?r.disabled:!1;n[e]={itemId:t,count:t==null||i?0:1};continue}n[e]={itemId:null,count:0};continue}n[e]={itemId:null,count:0}}return n}function Z(e){try{let t=localStorage.getItem(J(e));return t?X(JSON.parse(t)):{}}catch{return{}}}function Q(e){return e?Object.values(e).some(e=>e?.itemId!=null):!1}function $(e){try{let t=localStorage.getItem(H),n=q(e);return t&&n.includes(t)?t:q(e)[0]}catch{return q(e)[0]}}function ee(){let{loading:e,tiers:t,slots:n,itemsById:r}=k(),{t:a}=S(),{theme:o,setThemeHint:s}=x(),[c,l]=(0,T.useState)(`light`),[u,d]=(0,T.useState)(0),f=(0,T.useMemo)(()=>q(c),[c]),[p,h]=(0,T.useState)(()=>$(`light`)),[g,_]=(0,T.useState)(()=>Z(`light`));(0,T.useEffect)(()=>{localStorage.setItem(J(c),JSON.stringify(g))},[c,g]),(0,T.useEffect)(()=>{s(c===`light`?`light`:`dark`)},[c,o,s]),(0,T.useEffect)(()=>{_(Z(c));let e=f[Math.min(u,f.length-1)];h(e)},[c,f,u]),(0,T.useEffect)(()=>{localStorage.setItem(H,p)},[p]),(0,T.useEffect)(()=>{if(!t||t.length===0)return;if(!f.includes(p)){let e=f[Math.min(u,f.length-1)];h(e);return}if(t.some(e=>e.name===p))return;let e=f.find(e=>t.some(t=>t.name===e));if(e){let t=f.findIndex(t=>t===e);d(Math.max(0,t)),h(e)}},[t,f,p,u]);let y=(0,T.useRef)(Q(Z(`light`)));(0,T.useEffect)(()=>{y.current=Q(Z(c))},[c]),(0,T.useEffect)(()=>{if(e||!n.length)return;let i=t.find(e=>e.name===p);!i||i.items.length===0||y.current||_(e=>{let t={...e};for(let a of n){let n=e[a.key],o=a.allowed_types??[];if(o.length===0){t[a.key]={itemId:null,count:n?.count??0};continue}let s=o[0];if(n?.itemId){let e=r.get(n.itemId);e?.subtype&&(s=e.subtype)}let c=null;for(let e of i.items)if(r.get(e)?.subtype===s){c=e;break}let l=n?.count??0;t[a.key]={itemId:c,count:c==null?0:Math.max(1,l)}}return t})},[p,t,n,r,e]);function C(e){e!==c&&l(e)}function w(e){y.current=!1;let t=f.findIndex(t=>t===e);t>=0&&d(t),_({}),h(e)}return(0,E.jsx)(`div`,{className:`h-full w-full bg-crafting-page`,children:(0,E.jsxs)(`div`,{className:`mx-auto w-full max-w-[1466px] pt-3`,children:[(0,E.jsxs)(`div`,{className:`mb-4 flex gap-4 pr-1`,children:[(0,E.jsx)(`div`,{className:`w-[220px] shrink-0`,children:(0,E.jsxs)(m,{selectedKey:c,onSelectionChange:e=>C(e),variant:`bordered`,className:`w-full bg-transparent`,classNames:{tabList:`flex w-full rounded-[15px] border-1 border-crafting-border `,tab:`h-[34px] flex-1 justify-center data-[selected=true]:bg-primary dark:data-[selected=true]:bg-default-800`,tabContent:`flex items-center justify-center text-default-800 group-data-[selected=true]:text-background `},children:[(0,E.jsx)(v,{title:a(`common:crafting.light`,`Light`)},`light`),(0,E.jsx)(v,{title:a(`common:crafting.dark`,`Dark`)},`dark`)]})}),(0,E.jsx)(`div`,{className:`min-w-0 flex-1`,children:(0,E.jsx)(m,{selectedKey:p,onSelectionChange:e=>w(e),variant:`underlined`,color:c==`light`?`primary`:`default`,className:`w-full border-gray-300 bg-transparent`,classNames:{tabList:`flex w-full`,tab:`h-[34px] flex-1 justify-center`,tabContent:`flex items-center justify-center text-default-700`},children:f.map(e=>(0,E.jsx)(v,{title:a(`items/tiers:${e}.name`)},e))})})]}),(0,E.jsxs)(`div`,{className:`flex gap-4`,children:[(0,E.jsx)(i,{className:`h-[726px] w-[220px] shrink-0 rounded-lg border-x-1 border-primary bg-crafting-equipment-view`,shadow:`none`,children:(0,E.jsx)(b,{className:`h-full overflow-y-auto`,children:e?(0,E.jsx)(`div`,{className:`text-sm text-default-500`,children:`Loading...`}):(0,E.jsx)(P,{selectedBySlotKey:g,setSelectedBySlotKey:_,race:c})})}),(0,E.jsx)(i,{className:`h-[726px] w-full min-w-0 bg-transparent`,shadow:`none`,children:(0,E.jsx)(b,{className:`h-full min-h-0 px-1 py-0`,children:(0,E.jsx)(V,{selectedBySlotKey:g})})})]})]})})}var te=()=>(0,E.jsx)(O,{children:(0,E.jsx)(ee,{})});export{te as component};