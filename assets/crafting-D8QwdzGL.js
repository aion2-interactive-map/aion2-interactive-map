import{o as e}from"./rolldown-runtime-GyhWBpbT.js";import{a as t,n}from"./vendor-react-DPCMXswl.js";import"./vendor-i18n-D28tBn8Q.js";import{E as r,G as i,H as a,I as o,N as s,St as c,X as l,Y as u,bt as d,ct as f,et as p,lt as m,ot as h,st as g,tt as _,ut as v,xt as y}from"./vendor-ui-ni4DAml3.js";import{a as b,l as x,s as S}from"./index-XOocWGNm.js";var C=e(t(),1),w=e(n(),1),T=(0,C.createContext)(null);const E=({children:e})=>{let[t,n]=(0,C.useState)([]),[r,i]=(0,C.useState)([]),[a,o]=(0,C.useState)([]),[s,c]=(0,C.useState)([]),[l,u]=(0,C.useState)([]),[d,f]=(0,C.useState)([]),[p,m]=(0,C.useState)([]),[h,g]=(0,C.useState)(!0),_=b();(0,C.useEffect)(()=>{let e=!1;async function t(){try{let[t,r,a,s,l,d,p]=await Promise.all([_(`data/classes.yaml`),_(`data/items/items.yaml`),_(`data/items/types.yaml`),_(`data/items/grades.yaml`),_(`data/items/crafting.yaml`),_(`data/items/slots.yaml`),_(`data/items/tiers.yaml`)]);if(e)return;n(t.classes??[]),i(r.items??[]),o(a.categories??[]),c(s.grades??[]),u(l??[]),f(d.slots??[]),m(p.tiers??[])}catch(e){console.error(e)}finally{e||g(!1)}}return t(),()=>{e=!0}},[_]);let v=(0,C.useMemo)(()=>{let e=new Map;for(let t of r)e.set(t.id,t);return e},[r]),y=(0,C.useMemo)(()=>{let e=new Map;for(let t of l)e.set(t.id,t);return e},[l]),x=(0,C.useMemo)(()=>{let e=new Map;for(let t of d)e.set(t.key,t);return e},[d]),S=(0,C.useMemo)(()=>{let e=new Map;for(let t of s)e.set(t.name,t);return e},[s]),E=(0,C.useMemo)(()=>{let e=new Map;for(let t of l){let n=v.get(t.id);if(!n)continue;let r=n.subtype;e.has(r)||e.set(r,[]),e.get(r).push(t.id)}for(let t of e.values())t.sort((e,t)=>e-t);return e},[l,v]),D=(0,C.useMemo)(()=>{let e=new Map;for(let t of a)for(let n of t.subtypes??[])e.set(n.name,t.name);return e},[a]),O=(0,C.useMemo)(()=>{let e=new Map;for(let t of p)e.set(t.name,t);return e},[p]),k=(0,C.useMemo)(()=>{let e=new Map;for(let t of p)for(let n of t.items??[])e.has(n)||e.set(n,t.name);return e},[p]);return(0,w.jsx)(T.Provider,{value:{classes:t,items:r,types:a,grades:s,crafting:l,slots:d,tiers:p,itemsById:v,craftingById:y,slotsByKey:x,gradesByName:S,craftingItemIdsByType:E,subtypeToCategory:D,tiersByName:O,tierNameByItemId:k,loading:h},children:e})};function D(){let e=(0,C.useContext)(T);if(!e)throw Error(`useItemData must be used inside <ItemDataProvider>`);return e}function O(...e){for(let t of e)if(t&&t.trim().length>0)return t;return``}function k(e){return e??{itemId:null,disabled:!1}}function A({selectedBySlotKey:e,setSelectedBySlotKey:t}){let[n,a]=(0,C.useState)(!1),[o,s]=(0,C.useState)(null),[l,d]=(0,C.useState)(``),[y,b]=(0,C.useState)(`thumbnail`),{craftingItemIdsByType:T,slots:E,items:A,gradesByName:j}=D(),{t:M}=x(),N=(0,C.useMemo)(()=>o?E.find(e=>e.key===o)??null:null,[o,E]),P=(0,C.useMemo)(()=>N?.allowed_types??[],[N]);(0,C.useEffect)(()=>{if(!n)return;let e=P[0]??``;(!l||e&&!P.includes(l))&&d(e)},[n,P,l]);let F=(0,C.useMemo)(()=>l?T.get(l)??[]:[],[l,T]),I=(0,C.useMemo)(()=>{if(!N||!l)return[];let e=new Set(F);return A.filter(t=>t.subtype===l&&e.has(t.id))},[N,l,A,F]);function L(e){s(e),a(!0)}function R(e,n){t(t=>{let r=k(t[e]);return{...t,[e]:{...r,itemId:n}}}),a(!1)}function z(e){t(t=>{let n=k(t[e]);return{...t,[e]:{...n,itemId:null}}}),a(!1)}function B(e){t(t=>{let n=k(t[e]);return{...t,[e]:{...n,disabled:!n.disabled}}})}function V(){t(e=>{let t={...e};for(let n of E){let r=k(e[n.key]);t[n.key]={...r,disabled:!0}}return t})}let H=[];H=y===`thumbnail`?E:y===`weapon_armor`?E.slice(0,10):E.slice(10,20);let U=y===`thumbnail`?`grid grid-cols-2 gap-2`:`grid grid-cols-1 gap-2`;return(0,w.jsxs)(`div`,{className:`flex h-full w-full flex-col`,children:[(0,w.jsx)(`div`,{className:`my-3 h-[38px] text-center text-[22px] font-bold text-default-900`,children:M(`common:crafting.selectClick`,`Click to select equipment`)}),(0,w.jsx)(`div`,{className:`flex-1`,children:(0,w.jsx)(`div`,{className:`flex w-full justify-center`,children:(0,w.jsx)(`div`,{className:U,children:H.map(t=>{let n=k(e[t.key]),i=n.itemId,a=n.disabled,o=i?A.find(e=>e.id===i):void 0,s=S(O(o?.icon,t.icon)),c=M(`items/types:subtypes.${t.name}.name`,t.name),l=j.get(o?.grade||``)?.name||``,d=o?M(`items/items:${o.id}.name`,String(o.id)):c,f=()=>{if(a){B(t.key);return}t.craftable&&L(t.key)};if(y===`thumbnail`){let e=S(`UI/Resource/Texture/ETC/UT_SlotGrade_${l}.webp`);return(0,w.jsxs)(`button`,{type:`button`,onClick:f,className:[`relative h-12 w-[89px] rounded-sm bg-contain bg-center bg-no-repeat`,a?`cursor-pointer`:``].join(` `),style:{backgroundImage:`url(${e})`,backgroundSize:`100% 100%`},title:d,children:[(0,w.jsx)(`div`,{className:`flex h-full w-full items-center justify-center rounded-sm ${i?``:`bg-[#0D0E15]`}`,children:(0,w.jsx)(`img`,{src:s,alt:t.name,className:`h-full w-full object-contain`})}),a&&(0,w.jsx)(`div`,{className:`absolute inset-0 z-10 flex items-center justify-center rounded-sm`,style:{background:`rgba(0,0,0,0.6)`,boxShadow:`inset 0px 0px 6px 5px rgba(255,255,255,0.7)`},children:(0,w.jsx)(u,{icon:r,className:`text-[22px] text-white`})}),(0,w.jsx)(`div`,{className:`pointer-events-none absolute inset-x-0 bottom-1 z-20`,children:(0,w.jsx)(`div`,{className:`mx-auto w-fit rounded text-[14px] font-bold leading-tight text-white`,children:c})}),!a&&(0,w.jsx)(`button`,{type:`button`,onClick:e=>{e.preventDefault(),e.stopPropagation(),B(t.key)},className:`absolute bottom-1 right-1 z-30 flex h-5 w-5 items-center justify-center rounded-sm bg-black/40 hover:bg-black/60`,title:M(`common:crafting.disableSlot`,`Disable slot`),children:(0,w.jsx)(u,{icon:r,className:`text-[12px] text-white`})})]},t.key)}return(0,w.jsxs)(`button`,{type:`button`,onClick:f,className:`relative h-12 w-[188px] rounded-sm bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${S(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${l}.webp`)})`,backgroundSize:`100% 100%`},title:d,children:[(0,w.jsxs)(`div`,{className:`flex h-full w-full items-center rounded-sm px-2 ${i?``:`bg-[#0D0E15]`}`,children:[(0,w.jsx)(`img`,{src:s,alt:t.name,className:`h-12 w-12 shrink-0 object-contain`}),(0,w.jsx)(`div`,{className:`ml-2 min-w-0 flex-1 truncate text-left text-sm font-bold text-white`,children:d})]}),a&&(0,w.jsx)(`div`,{className:`absolute inset-0 z-10 flex items-center justify-center rounded-sm`,style:{background:`rgba(0,0,0,0.6)`,boxShadow:`inset 0px 0px 6px 5px rgba(255,255,255,0.7)`},children:(0,w.jsx)(u,{icon:r,className:`text-[22px] text-white`})}),!a&&(0,w.jsx)(`button`,{type:`button`,onClick:e=>{e.preventDefault(),e.stopPropagation(),B(t.key)},className:`absolute bottom-1 right-1 z-30 flex h-5 w-5 items-center justify-center rounded-sm bg-black/40 hover:bg-black/60`,title:M(`common:crafting.disableSlot`,`Disable slot`),children:(0,w.jsx)(u,{icon:r,className:`text-[12px] text-white`})})]},t.key)})})})}),(0,w.jsx)(`div`,{className:`mt-2 w-full`,children:(0,w.jsx)(c,{size:`sm`,variant:`flat`,onPress:V,className:`h-[34px] w-full rounded-sm border-1 border-crafting-border bg-crafting-sum`,children:(0,w.jsxs)(`span`,{className:`flex w-full items-center justify-center gap-2 text-[14px] text-default-800`,children:[(0,w.jsx)(u,{icon:r}),M(`common:crafting.disableAll`,`Disable all slots`)]})})}),(0,w.jsx)(`div`,{className:`mt-2`,children:(0,w.jsxs)(_,{selectedKey:y,onSelectionChange:e=>b(e),variant:`light`,color:`primary`,className:`w-full rounded-sm border-1 border-crafting-border bg-crafting-sum`,classNames:{tabList:`w-full flex gap-0`,tab:`h-[30px] flex-1 justify-center`,tabContent:`flex items-center justify-center text-default-800 group-data-[selected=true]:text-background`},children:[(0,w.jsx)(p,{title:(0,w.jsx)(u,{icon:i})},`thumbnail`),(0,w.jsx)(p,{title:M(`common:crafting.weaponOrArmor`,`Weapon / Armor`)},`weapon_armor`),(0,w.jsx)(p,{title:M(`common:crafting.accessory`,`Accessory`)},`accessory`)]})}),(0,w.jsx)(h,{isOpen:n,onOpenChange:e=>a(e),size:`5xl`,children:(0,w.jsx)(m,{className:`w-fit max-w-none`,children:e=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(g,{className:`flex flex-col gap-2`,children:[(0,w.jsx)(`div`,{children:M(`common:crafting.select`,`Select item`)}),N&&P.length>0?(0,w.jsx)(_,{selectedKey:l,onSelectionChange:e=>d(String(e)),variant:`underlined`,classNames:{tabList:`gap-2`,cursor:`bg-default-800`,tab:`h-8`},children:P.map(e=>(0,w.jsx)(p,{title:M(`items/types:subtypes.${e}.name`,e)},e))}):null]}),(0,w.jsx)(v,{children:N?(0,w.jsx)(`div`,{className:`flex flex-col gap-3`,children:(0,w.jsx)(`div`,{className:`max-h-[560px] overflow-y-auto`,children:(0,w.jsxs)(`div`,{className:`grid grid-cols-3 gap-5`,children:[I.map(e=>{let t=M(`items/items:${e.id}.name`,e.subtype);return(0,w.jsxs)(`button`,{type:`button`,onClick:()=>R(N.key,e.id),className:`flex items-center rounded-sm border-2 border-default bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${S(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${j.get(e.grade)?.name}.webp`)})`,backgroundSize:`100% 100%`},title:`${e.id} (${e.subtype})`,children:[(0,w.jsx)(`img`,{src:S(e.icon),alt:String(e.id),className:`h-16 w-16 object-contain`}),(0,w.jsx)(`div`,{className:`flex h-16 w-[160px] items-center px-2 text-left text-[14px] font-bold text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.3)]`,children:t})]},e.id)}),I.length===0&&(0,w.jsx)(`div`,{className:`col-span-3 text-sm text-default-500`,children:`No craftable items match this slot’s allowed types.`})]})})}):(0,w.jsx)(`div`,{className:`text-sm text-default-500`,children:`No slot selected.`})}),(0,w.jsxs)(f,{children:[N?(0,w.jsx)(c,{variant:`flat`,color:`danger`,onPress:()=>z(N.key),children:M(`common:ui.clear`)}):null,(0,w.jsx)(c,{variant:`flat`,onPress:e,children:M(`common:ui.close`)})]})]})})})]})}function j(e){let t=Number(e);return Number.isFinite(t)?t:0}var M=`aion2.crafting.prices.v1`,N=[`Equipment`,`CraftResource`,`GatherResource`];function P(e){return e===`CraftResource`?`CraftResource`:e===`GatherResource`?`GatherResource`:`Equipment`}function F({selectedBySlotKey:e}){let{craftingById:t,itemsById:n,gradesByName:r}=D(),{t:i}=x(),[c,d]=(0,C.useState)(()=>{try{let e=localStorage.getItem(M);return e?JSON.parse(e):{}}catch{return{}}});(0,C.useEffect)(()=>{localStorage.setItem(M,JSON.stringify(c))},[c]);let f=(0,C.useMemo)(()=>{let n=new Map;for(let r of Object.values(e)){if(!r||r.disabled)continue;let e=r.itemId;if(!e)continue;let i=t.get(e);if(i)for(let e of i.materials??[]){let t=n.get(e.id)??0;n.set(e.id,t+(e.count??0))}}let r=Array.from(n.entries()).map(([e,t])=>({id:e,count:t}));return r.sort((e,t)=>e.id-t.id),r},[e,t]),p=(0,C.useMemo)(()=>{let e={Equipment:[],CraftResource:[],GatherResource:[]};for(let t of f)e[P(n.get(t.id)?.subtype)].push(t);for(let t of Object.values(e))t.sort((e,t)=>e.id-t.id);return e},[f,n]),m=(0,C.useMemo)(()=>{let e={Equipment:0,CraftResource:0,GatherResource:0};for(let t of N){let n=0;for(let e of p[t]){let t=j(c[e.id]??``);n+=e.count*t}e[t]=n}return e},[p,c]),h=(0,C.useMemo)(()=>N.reduce((e,t)=>e+m[t],0),[m]);return(0,w.jsxs)(`div`,{className:`flex h-full w-full flex-col`,children:[(0,w.jsx)(`div`,{className:`flex-1 overflow-hidden`,children:f.length===0?(0,w.jsx)(`div`,{className:`text-sm text-default-500`,children:`No materials yet. Select craftable equipments on the left.`}):(0,w.jsx)(`div`,{className:`grid h-full min-h-0 min-w-0 grid-cols-[1fr_auto_1fr_auto_1fr] gap-3`,children:N.map((e,t)=>{let o=p[e];return(0,w.jsxs)(C.Fragment,{children:[(0,w.jsxs)(`div`,{className:`flex h-full min-h-0 flex-col rounded-lg border border-crafting-border bg-transparent`,children:[(0,w.jsx)(`div`,{className:`m-2 flex h-[38px] items-center justify-center border-b border-crafting-border px-3 py-2`,children:(0,w.jsx)(`div`,{className:`text-[16px] font-bold leading-[16px] text-default-900`,children:i(`items/types:subtypes.${e}.name`,e)})}),(0,w.jsx)(`div`,{className:`flex-1 overflow-y-auto no-scrollbar p-3`,children:(0,w.jsx)(`div`,{className:`flex flex-col gap-2`,children:o.length===0?(0,w.jsx)(`div`,{className:`text-xs text-default-500`,children:`No materials`}):o.map(e=>{let t=n.get(e.id),a=i(`items/items:${e.id}.name`,String(e.id)),o=t?.icon?S(t.icon):``,s=c[e.id]??``,u=S(`UI/Resource/Texture/ETC/UT_SlotGrade_${r.get(t?.grade||``)?.name}.webp`);return(0,w.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-lg border border-default-200 bg-crafting-item p-2`,children:[(0,w.jsx)(`div`,{className:`truncate text-sm font-semibold text-default-900`,children:a}),(0,w.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,w.jsx)(`div`,{className:`flex h-12 w-12 items-center justify-center rounded-sm bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${u})`},children:o?(0,w.jsx)(`img`,{src:o,alt:a,className:`h-12 w-12 object-contain`}):(0,w.jsx)(`div`,{className:`text-xs text-default-500`,children:e.id})}),(0,w.jsxs)(`div`,{className:`flex min-w-0 flex-1 flex-col gap-2`,children:[(0,w.jsxs)(`div`,{className:`text-sm font-semibold text-default-900`,children:[`× `,e.count]}),(0,w.jsx)(l,{size:`sm`,hideStepper:!0,placeholder:`输入价格`,value:s?Number(s):void 0,onValueChange:t=>d(n=>({...n,[e.id]:t==null?``:String(t)})),radius:`sm`,classNames:{base:`h-[28px]`,inputWrapper:` bg-search-item hover:!bg-search-item focus:!bg-search-item transition-none
                                                        group-data-[hover=true]:!bg-search-item
                                                        group-data-[focus=true]:!bg-search-item
                                                        group-data-[focus-visible=true]:!bg-search-item
                                                        group-data-[invalid=true]:!bg-search-item
                                                        h-[28px] min-h-[28px] px-2
                                                        border-1 border-crafting-border
                                                        shadow-none focus-within:shadow-none
                                                      `,input:`h-[28px] text-[14px] leading-[28px]`}})]})]})]},e.id)})})}),(0,w.jsx)(`div`,{className:`relative m-2 h-[38px] rounded-lg border border-primary bg-crafting-sum`,children:(0,w.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center`,children:(0,w.jsxs)(`div`,{className:`flex items-center gap-2 text-[16px] font-bold text-primary`,children:[(0,w.jsx)(u,{icon:s,className:`text-sm`}),i(`common:crafting.sumType`,`Sum: `),m[e].toLocaleString()]})})})]}),t<N.length-1&&(0,w.jsxs)(`div`,{className:`relative flex items-center justify-center`,children:[(0,w.jsx)(`div`,{className:`absolute top-0 bottom-[calc(50%+24px)] w-px bg-crafting-border`}),(0,w.jsx)(`div`,{className:`absolute top-[calc(50%+24px)] bottom-0 w-px bg-crafting-border`}),(0,w.jsx)(`div`,{className:`z-10 flex h-6 w-6 items-center justify-center rounded-full bg-primary`,children:(0,w.jsx)(u,{icon:a,className:`text-[14px] text-white`})})]})]},e)})})}),(0,w.jsxs)(`div`,{className:`flex w-full items-center`,children:[(0,w.jsx)(`div`,{className:`flex-1 h-px bg-crafting-border`}),(0,w.jsx)(`div`,{className:`mx-1 flex h-6 w-6 items-center justify-center rounded-full bg-primary`,children:(0,w.jsx)(u,{icon:o,className:`text-[16px] text-white`})}),(0,w.jsx)(`div`,{className:`flex-1 h-px bg-crafting-border`})]}),(0,w.jsx)(`div`,{className:`relative mt-2 h-[38px] rounded-lg border border-primary bg-crafting-sum`,children:(0,w.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center`,children:(0,w.jsxs)(`div`,{className:`flex items-center gap-2 text-[16px] font-bold text-primary`,children:[(0,w.jsx)(u,{icon:s,className:`text-sm`}),i(`common:crafting.sumTotal`,`Total: `),h.toLocaleString()]})})})]})}var I=`aion2.crafting.selectedEquipments.v1`,L=`aion2.crafting.selectedTier.v1`,R=[`trueDragon`,`whiteDragon`,`wiseDragon`,`nobleDragon`];function z(){try{let e=localStorage.getItem(L);return e&&R.includes(e)?e:`trueDragon`}catch{return`trueDragon`}}function B(e){if(!e||typeof e!=`object`)return{};let t=e,n={};for(let[e,r]of Object.entries(t)){if(typeof r==`number`||r===null){n[e]={itemId:r,disabled:!1};continue}if(r&&typeof r==`object`){n[e]={itemId:`itemId`in r&&(typeof r.itemId==`number`||r.itemId===null)?r.itemId:null,disabled:`disabled`in r&&typeof r.disabled==`boolean`?r.disabled:!1};continue}n[e]={itemId:null,disabled:!1}}return n}function V(){try{let e=localStorage.getItem(I);return e?B(JSON.parse(e)):{}}catch{return{}}}function H(e){return e?Object.values(e).some(e=>e?.itemId!=null):!1}function U(e){return e??{itemId:null,disabled:!1}}function W(){let{loading:e,tiers:t,slots:n,itemsById:r}=D(),{t:i}=x(),[a,o]=(0,C.useState)(()=>V());(0,C.useEffect)(()=>{localStorage.setItem(I,JSON.stringify(a))},[a]);let[s,c]=(0,C.useState)(()=>z());(0,C.useEffect)(()=>{localStorage.setItem(L,s)},[s]);let l=(0,C.useRef)(H(V()));return(0,C.useEffect)(()=>{if(!t||t.length===0||t.some(e=>e.name===s))return;let e=R.find(e=>t.some(t=>t.name===e));e&&c(e)},[t,s]),(0,C.useEffect)(()=>{if(e||!n.length)return;let i=t.find(e=>e.name===s);!i||i.items.length===0||o(e=>{let t={...e};for(let a of n){let n=e[a.key],o=a.allowed_types??[];if(o.length===0){t[a.key]={itemId:null,disabled:n?.disabled??!1};continue}let s=null;s=n?.itemId?r.get(n.itemId)?.subtype??o[0]:o[0];let c=null;for(let e of i.items)if(r.get(e)?.subtype===s){c=e;break}t[a.key]={itemId:c,disabled:n?.disabled??!1}}return t})},[s,t,n,r,e]),(0,w.jsx)(`div`,{className:`h-full w-full bg-crafting-page`,children:(0,w.jsxs)(`div`,{className:`mx-auto w-full max-w-[1466px] pt-3`,children:[(0,w.jsx)(`div`,{className:`mb-4 pr-1`,children:(0,w.jsx)(_,{selectedKey:s,onSelectionChange:e=>{let t=e;l.current=!1,o(e=>{let t={...e};for(let e of Object.keys(t))t[e]={...U(t[e]),itemId:null};return t}),c(t)},variant:`underlined`,color:`primary`,className:`w-full border-b-1 border-gray-300 bg-transparent `,classNames:{tabList:`flex w-full `,tab:`h-[34px] flex-1 justify-center`,tabContent:`flex items-center justify-center text-default-700`},children:R.map(e=>(0,w.jsx)(p,{title:i(`items/tiers:${e}.name`)},e))})}),(0,w.jsxs)(`div`,{className:`flex gap-4`,children:[(0,w.jsx)(d,{className:`h-[726px] w-[220px] shrink-0 bg-crafting-equipment-view border-x-1 border-primary rounded-lg`,shadow:`none`,children:(0,w.jsx)(y,{className:`h-full overflow-y-auto`,children:e?(0,w.jsx)(`div`,{className:`text-sm text-default-500`,children:`Loading...`}):(0,w.jsx)(A,{selectedBySlotKey:a,setSelectedBySlotKey:o})})}),(0,w.jsx)(d,{className:`h-[726px] w-full min-w-0 bg-transparent `,shadow:`none`,children:(0,w.jsx)(y,{className:`h-full min-h-0 py-0 px-1`,children:(0,w.jsx)(F,{selectedBySlotKey:a})})})]})]})})}var G=()=>(0,w.jsx)(E,{children:(0,w.jsx)(W,{})});export{G as component};