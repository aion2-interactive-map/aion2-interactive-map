import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-BM8K3Wqw.js";import{A as r,At as i,Bt as a,D as o,Dt as s,Et as c,Ft as l,It as u,Lt as d,Mt as f,Nt as p,Ot as m,Pt as h,Rt as g,U as _,Vt as v,Y as y,_t as b,at as x,bt as S,gt as C,it as w,jt as T,kt as E,ot as D,tt as O,vt as k,xt as A,zt as j}from"./vendor-ui-K_TnsoAz.js";import{_ as M,c as N,l as P,m as F,o as I,s as L,t as R,u as z}from"./index-DMCIkxg7.js";import{t as B}from"./useYamlLoader-CVCGxe59.js";import{n as V,r as H,s as U,t as W}from"./lodash-DmxRirzj.js";import{n as G,t as K}from"./ItemDataContext-TSdEWs6x.js";import{n as q,t as ee}from"./ClassDataContext-DPQCqZyA.js";import{t as te}from"./Footer-B2Eh3UAr.js";var J=e(t(),1),Y=e(n(),1),ne=(0,J.createContext)(null);const re=({children:e})=>{let[t,n]=(0,J.useState)([]),[r,i]=(0,J.useState)(!0),a=B();return(0,J.useEffect)(()=>{let e=!1;async function t(){try{let t=await a(`data/servers.yaml`);if(e)return;n(t.servers??[])}catch(e){console.error(e)}finally{e||i(!1)}}return t(),()=>{e=!0}},[a]),(0,Y.jsx)(ne.Provider,{value:{servers:t,loading:r},children:e})};function ie(){let e=(0,J.useContext)(ne);if(!e)throw Error(`useServerData must be used inside <ServerDataProvider>`);return e}var ae=(0,J.createContext)(null);async function oe(e){let t=P()+`/characters/info?server=${e.serverId}&character=${encodeURIComponent(e.characterId)}&region=${e.region}`,n=await fetch(t,{method:`GET`});if(!n.ok)throw Error(`Search failed: ${n.status}`);let r=await n.json();if(r?.errorCode&&r.errorCode!==`Success`)throw Error(r.errorMessage||`API Error`);return r?.data}const se=({children:e})=>{let t=I({from:R.fullPath}),n=L({from:R.fullPath}),[r,i]=(0,J.useState)(n.serverId??null),[a,o]=(0,J.useState)(n.characterId??null),[s,c]=(0,J.useState)(n.region??null),[l,u]=(0,J.useState)(null),[d,f]=(0,J.useState)(null),[p,m]=(0,J.useState)(null),[h,g]=(0,J.useState)(null),[_,v]=(0,J.useState)(null),[y,b]=(0,J.useState)([]),[x,S]=(0,J.useState)(!1),[C,w]=(0,J.useState)(!1),[T,E]=(0,J.useState)(null),D=J.useRef(null),O=B();(0,J.useEffect)(()=>{let e=!1;async function t(){try{let t=await O(`data/stats.yaml`);if(e)return;v(t)}catch{e||E(`Failed to load stats data`)}}return t(),()=>{e=!0}},[O]),(0,J.useEffect)(()=>{let e=!1;async function t(){try{let t=await O(`data/skills.yaml`);if(e)return;b(t.skills??[])}catch{e||E(`Failed to load skills data`)}}return t(),()=>{e=!0}},[O]);let k=(0,J.useMemo)(()=>{let e=new Map;for(let t of y)e.set(t.id,t);return e},[y]);(0,J.useEffect)(()=>{i(n.serverId??null),o(n.characterId??null),c(n.region??null)},[n.serverId,n.characterId,n.region]);let A=(0,J.useCallback)(e=>{i(e.serverId),o(e.characterId),c(e.region),u(null),f(null),m(null),g(null),E(null);try{let t=localStorage.getItem(V),n=t?JSON.parse(t):[];n=n.filter(t=>{let n=t.serverId??t.item?.serverId??(t.id?t.serverId:void 0),r=t.id??t.characterId??t.item?.id;return!(n===e.serverId&&r===e.characterId)}),e.item?n.unshift(e.item):n.unshift(e),n.length>20&&(n=n.slice(0,20)),localStorage.setItem(V,JSON.stringify(n))}catch(e){console.error(`Failed to update character history`,e)}t({replace:!1,search:t=>({...t,serverId:e.serverId,characterId:e.characterId,region:e.region})})},[t]),j=(0,J.useCallback)(()=>{i(null),o(null),c(null),u(null),f(null),m(null),g(null),E(null),S(!1),t({replace:!1,search:e=>({...e,serverId:void 0,characterId:void 0,region:void 0})})},[t]);(0,J.useEffect)(()=>{let e=!1,t=()=>{D.current&&=(D.current.close(),null),w(!1)};async function n(){if(!r||!a||!s){u(null),f(null),m(null),g(null),S(!1),E(null),t();return}S(!0),E(null);try{let n=await oe({serverId:r,characterId:a,region:s});if(e)return;c(n);let i=n.status;i!==`cached`&&i!==`failed`?d(r,a,s):t(),S(!1)}catch(n){if(e)return;E(n instanceof Error?n.message:String(n)),S(!1),t()}}function i(e,t){return e?.profile?{profile:e.profile,stats:e.stats||[],titles:e.titles||[],rankings:e.rankings||[],boards:e.boards||[],updatedAt:t?new Date(t*1e3).toISOString():new Date().toISOString()}:null}function o(e){return{skills:(e?.skills||[]).map(e=>({id:e.id,skillLevel:e.skillLevel,acquired:e.acquired,equip:e.equip})),equipments:(e?.equipments||[]).map(e=>({id:e.id,enchantLevel:e.enchantLevel,exceedLevel:e.exceedLevel,slotPos:e.slotPos,slotPosName:e.slotPosName})),skins:(e?.skins||[]).map(e=>({id:e.id,name:e.name,slotPos:e.slotPos,slotPosName:e.slotPosName?.includes(`Main`)?`MainHand`:e.slotPosName,icon:e.icon})),pet:e?.pet?{id:e.pet.id,name:e.pet.name,level:e.pet.level,icon:e.pet.icon}:null,wing:e?.wing?{id:e.wing.id,name:e.wing.name,grade:e.wing.grade,icon:e.wing.icon}:null}}function c(e){let t=e.items||{},n=e.meta||{};if(t.info){let e=i(t.info,n.updatedAt);e&&u(e)}t.equipments&&f(o(t.equipments));let r=Object.entries(t).filter(([e])=>e.startsWith(`equipments:`)).reduce((e,[t,n])=>(e[t]=n,e),{});Object.keys(r).length>0&&m(r);let a=Object.entries(t).filter(([e])=>e.startsWith(`boards:`)).reduce((e,[t,n])=>(e[t]=n,e),{});Object.keys(a).length>0&&g(a)}async function l(t,n,r){w(!0);try{let i=await oe({serverId:t,characterId:n,region:r});if(e)return;c(i);let a=i.status;a!==`cached`&&a!==`failed`?d(t,n,r):w(!1)}catch(e){console.error(`Re-fetch failed`,e),w(!1)}}function d(n,r,a){t(),w(!0);let s=z()+`/characters/ws?server=${n}&character=${encodeURIComponent(r)}&region=${a}`,c=new WebSocket(s);D.current=c,c.onmessage=e=>{try{let t=JSON.parse(e.data);if(!t||!t.key)return;let n=t.key,r=t.value;if(n===`info`){let e=i(r,t.updated_at);e&&u(e)}else n===`equipments`?f(o(r)):n.startsWith(`equipments:`)?m(e=>({...e||{},[n]:r})):n.startsWith(`boards:`)&&g(e=>({...e||{},[n]:r}))}catch(e){console.error(`WS parse error`,e)}},c.onclose=()=>{e||(D.current=null,setTimeout(()=>{e||l(n,r,a)},1e3))},c.onerror=e=>{console.error(`WS Error:`,e)}}return n(),()=>{e=!0,t()}},[r,a,s]);let M=(0,J.useMemo)(()=>({serverId:r,characterId:a,region:s,info:l,equipments:d,equipmentDetails:p,boardDetails:h,stats:_,skills:y,skillsById:k,loading:x,isUpdating:C,error:T,selectCharacter:A,clearSelection:j}),[r,a,s,l,d,p,h,_,k,x,C,T,A,j]);return(0,Y.jsx)(ae.Provider,{value:M,children:e})};function X(){let e=(0,J.useContext)(ae);if(!e)throw Error(`useCharacter must be used inside <CharacterProvider>`);return e}var ce=(0,J.createContext)(null);const le=({children:e})=>{let[t,n]=(0,J.useState)([]),[r,i]=(0,J.useState)(!1),[a,o]=(0,J.useState)(null),s=B(),c=(0,J.useCallback)(async e=>{if(e){i(!0),o(null);try{n((await s(`data/boards/${e}.yaml`)).boards??[])}catch(t){console.error(`Failed to load boards for class ${e}:`,t),o(`Failed to load boards for class ${e}`),n([])}finally{i(!1)}}},[s]);return(0,Y.jsx)(ce.Provider,{value:{boards:t,loading:r,error:a,loadBoardsForClass:c},children:e})};function ue(){let e=(0,J.useContext)(ce);if(!e)throw Error(`useBoardData must be used inside <BoardDataProvider>`);return e}function de(e,t){let[n,r]=(0,J.useState)(e);return(0,J.useEffect)(()=>{let n=setTimeout(()=>{r(e)},t);return()=>{clearTimeout(n)}},[e,t]),n}function fe(){let{servers:e,loading:t}=ie(),{selectCharacter:n,characterId:r,region:i}=X(),{t:a}=M(),[o,s]=(0,J.useState)(i||`tw`),[c,l]=(0,J.useState)(`1`),[f,m]=(0,J.useState)(`all`),[h,_]=(0,J.useState)(``),v=de(h,300),[b,S]=(0,J.useState)(!1),[C,T]=(0,J.useState)([]),[k,A]=(0,J.useState)([]),[j,N]=(0,J.useState)([]),F=(0,J.useRef)(0);(0,J.useEffect)(()=>{let e=localStorage.getItem(V);if(e)try{A(JSON.parse(e).filter(e=>e.name).map(e=>({...e,region:e.region||`tw`})).filter((e,t,n)=>t===n.findIndex(t=>t.id===e.id&&t.serverId===e.serverId)))}catch(e){console.error(`Failed to parse character history`,e)}let t=localStorage.getItem(H);if(t)try{N(JSON.parse(t).map(e=>({...e,region:e.region||`tw`})))}catch(e){console.error(`Failed to parse starred characters`,e)}},[r]),(0,J.useEffect)(()=>{i&&s(i)},[i]);let I=(0,J.useMemo)(()=>{let t=Number(c);return e.filter(e=>e.raceId===t)},[e,c]);(0,J.useEffect)(()=>{f!==`all`&&(I.some(e=>String(e.serverId)===f)||m(`all`))},[I,f]),(0,J.useEffect)(()=>{let e=v.trim(),t=Number(c),n=f===`all`?void 0:Number(f);if(T([]),!e||!t)return;let r=++F.current;(async()=>{try{S(!0);let i=await L({keyword:e,raceId:t,serverId:n,region:o});if(F.current!==r)return;T(i)}catch(e){console.error(e),F.current===r&&T([])}finally{F.current===r&&S(!1)}})()},[v,c,f,o]);async function L(e){let t=P()+`/characters/search?race=${e.raceId}&keyword=${encodeURIComponent(e.keyword)}&region=${e.region}`,n=e.serverId?`${t}&server=${e.serverId}`:t,r=await fetch(n,{method:`GET`});if(!r.ok)throw Error(`Search failed: ${r.status}`);return((await r.json()).data?.results??[]).map(t=>({...t,region:e.region}))}let R=(0,J.useCallback)((e,t,n)=>{let r=n%1e3;return`${e} (${t===1?a(`common:server.lightAbbr`,`Light `):a(`common:server.darkAbbr`,`Dark `)}${r})`},[a]),z=(0,J.useMemo)(()=>{let e=[{key:`all`,label:a(`common:server.allServers`,`All servers`)}];for(let t of I)e.push({key:String(t.serverId),label:R(t.serverName,t.raceId,t.serverId)});return e},[I,a,R]),B=`
    !bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none 
    border-crafting-border border-1 sm:border-r-0
    shadow-none rounded-sm sm:rounded-none
    group-data-[hover=true]:!bg-character-card
    group-data-[focus=true]:!bg-character-card
    group-data-[focus-visible=true]:!bg-character-card
    group-data-[invalid=true]:!bg-character-card
  `,U={inputWrapper:B,innerWrapper:`h-10 py-0`,popoverContent:`rounded-none p-0`},W={trigger:B,innerWrapper:`h-10 py-0`,popoverContent:`rounded-none p-0`},G={itemClasses:{base:`rounded-none`}},K=(0,J.useCallback)((e,t)=>{e.stopPropagation(),N(e=>{let n=e.some(e=>e.id===t.id),r;return r=n?e.filter(e=>e.id!==t.id):[t,...e],localStorage.setItem(H,JSON.stringify(r)),r})},[]),q=(e,t)=>(0,Y.jsx)(p,{isPressable:!0,onPress:()=>n({serverId:e.serverId,characterId:e.id,region:e.region,item:e}),className:`bg-character-card border-1 border-crafting-border hover:border-primary transition-colors`,shadow:`sm`,children:(0,Y.jsxs)(u,{className:`p-3 overflow-hidden relative`,children:[(0,Y.jsx)(d,{isIconOnly:!0,variant:`light`,size:`sm`,className:`absolute top-1 right-1 z-10 min-w-0 w-8 h-8`,onClick:t=>K(t,e),children:(0,Y.jsx)(O,{icon:y,className:j.some(t=>t.id===e.id)?`text-warning`:`text-default-300`})}),(0,Y.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,Y.jsx)(`img`,{src:`https://profileimg.plaync.com${e.profileImageUrl}`,alt:e.name,className:`w-[48px] h-[48px] object-cover rounded-md shrink-0`,draggable:!1}),(0,Y.jsxs)(`div`,{className:`min-w-0 flex-1`,children:[(0,Y.jsx)(`div`,{className:`flex justify-between items-baseline gap-1`,children:(0,Y.jsx)(`span`,{className:`truncate text-base font-bold text-foregound`,children:e.name})}),(0,Y.jsxs)(`div`,{className:`truncate text-sm text-default-800 mt-0.5`,children:[e.serverName,` | Lv.`,e.level]})]})]})]})},`${t}-${e.id}`);return r?(0,Y.jsxs)(`div`,{className:`flex flex-col sm:flex-row gap-2 sm:gap-0 items-stretch sm:items-end w-full justify-end`,children:[(0,Y.jsxs)(`div`,{className:`flex flex-row gap-2 sm:gap-0 flex-none sm:flex-none`,children:[(0,Y.jsxs)(x,{placeholder:a(`common:server.region`,`Region`),isRequired:!0,selectedKeys:new Set([o]),onSelectionChange:e=>{let t=e.currentKey;t&&s(String(t))},className:`flex-1 sm:w-[100px] sm:flex-none`,radius:`none`,popoverProps:{radius:`none`},listboxProps:G,classNames:W,children:[(0,Y.jsx)(D,{children:a(`common:server.tw`,`台服`)},`tw`),(0,Y.jsx)(D,{children:a(`common:server.kr`,`韩服`)},`kr`)]}),(0,Y.jsxs)(x,{placeholder:a(`common:server.race`,`Race`),isRequired:!0,selectedKeys:new Set([c]),onSelectionChange:e=>{let t=e.currentKey;(t===`1`||t===`2`)&&l(t)},className:`flex-1 sm:w-[100px] sm:flex-none`,radius:`none`,popoverProps:{radius:`none`},listboxProps:G,classNames:W,children:[(0,Y.jsx)(D,{children:a(`common:server.light`,`Light`)},`1`),(0,Y.jsx)(D,{children:a(`common:server.dark`,`Dark`)},`2`)]}),(0,Y.jsx)(x,{placeholder:a(`common:server.server`,`Server`),isRequired:!1,isDisabled:t||I.length===0,items:z,selectedKeys:new Set([f]),onSelectionChange:e=>{let t=e.currentKey;m(t?String(t):`all`)},className:`flex-[2] sm:w-[160px] sm:flex-none`,renderValue:e=>e[0]?.textValue??``,radius:`none`,popoverProps:{radius:`none`},listboxProps:G,classNames:W,children:e=>(0,Y.jsx)(D,{textValue:e.label,children:e.label},e.key)})]}),(0,Y.jsx)(w,{placeholder:a(`common:server.search`,`Type to search...`),inputValue:h,onInputChange:_,onSelectionChange:e=>{let t=C.find(t=>t.id===e);t&&n({serverId:t.serverId,characterId:t.id,region:t.region,item:t})},isDisabled:t,isLoading:b,items:C,className:`flex-[2] w-full sm:w-[180px] sm:flex-none`,radius:`none`,popoverProps:{radius:`none`},listboxProps:G,inputProps:{classNames:{...U,inputWrapper:U.inputWrapper+`!border-r-1`}},children:e=>(0,Y.jsx)(D,{textValue:e.name,children:(0,Y.jsxs)(`div`,{className:`flex items-center gap-2 w-full`,children:[(0,Y.jsx)(`img`,{src:`https://profileimg.plaync.com${e.profileImageUrl}`,alt:e.name,className:`w-[40px] h-[40px] object-cover rounded-md shrink-0`,draggable:!1}),(0,Y.jsxs)(`div`,{className:`min-w-0 flex-1`,children:[(0,Y.jsxs)(`div`,{className:`flex justify-between text-sm font-medium`,children:[(0,Y.jsx)(`span`,{className:`truncate text-default-800`,children:e.name}),(0,Y.jsxs)(`span`,{className:`shrink-0 text-default-600`,children:[`Lv.`,e.level]})]}),(0,Y.jsx)(`div`,{className:`truncate text-xs text-default-700`,children:e.serverName})]})]})},e.id)})]}):(0,Y.jsxs)(`div`,{className:`flex flex-col w-full space-y-8 pt-10 min-h-[600px]`,children:[(0,Y.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Y.jsx)(`h1`,{className:`text-[22px] font-bold text-foreground`,children:`搜寻AION2角色`}),(0,Y.jsx)(`p`,{className:`text-[14px] text-default-800 mt-2`,children:`查詢角色詳細資訊`})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col items-center w-full space-y-4 max-w-2xl mx-auto`,children:[(0,Y.jsx)(E,{placeholder:a(`common:server.search`,`Type to search...`),value:h,onValueChange:_,classNames:{inputWrapper:B+`!border-r-1`,input:`text-lg`},size:`lg`,radius:`sm`,isClearable:!0}),(0,Y.jsxs)(`div`,{className:`flex flex-row w-full gap-2 sm:gap-4`,children:[(0,Y.jsxs)(x,{placeholder:a(`common:server.region`,`Publisher`),isRequired:!0,selectedKeys:new Set([o]),onSelectionChange:e=>{let t=e.currentKey;t&&s(String(t))},className:`flex-1`,radius:`sm`,classNames:{trigger:B+`!border-r-1`,popoverContent:`rounded-none p-0`},popoverProps:{radius:`none`},listboxProps:G,size:`lg`,children:[(0,Y.jsx)(D,{children:a(`common:server.tw`,`台服`)},`tw`),(0,Y.jsx)(D,{children:a(`common:server.kr`,`韩服`)},`kr`)]}),(0,Y.jsxs)(x,{placeholder:a(`common:server.race`,`Race`),isRequired:!0,selectedKeys:new Set([c]),onSelectionChange:e=>{let t=e.currentKey;(t===`1`||t===`2`)&&l(t)},className:`flex-1`,radius:`sm`,classNames:{trigger:B+`!border-r-1`,popoverContent:`rounded-none p-0`},popoverProps:{radius:`none`},listboxProps:G,size:`lg`,children:[(0,Y.jsx)(D,{children:a(`common:server.light`,`Light`)},`1`),(0,Y.jsx)(D,{children:a(`common:server.dark`,`Dark`)},`2`)]}),(0,Y.jsx)(x,{placeholder:a(`common:server.server`,`Server`),isRequired:!1,isDisabled:t||I.length===0,items:z,selectedKeys:new Set([f]),onSelectionChange:e=>{let t=e.currentKey;m(t?String(t):`all`)},className:`flex-[2]`,renderValue:e=>e[0]?.textValue??``,radius:`sm`,classNames:{trigger:B+`!border-r-1`,popoverContent:`rounded-none p-0`},popoverProps:{radius:`none`},listboxProps:G,size:`lg`,children:e=>(0,Y.jsx)(D,{textValue:e.label,children:e.label},e.key)})]})]}),(0,Y.jsxs)(`div`,{className:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 w-full`,children:[C.map(e=>q(e,`search`)),b&&(0,Y.jsx)(`div`,{className:`col-span-full flex justify-center py-10`,children:(0,Y.jsx)(g,{color:`primary`,label:a(`common:server.searching`,`Searching characters...`)})}),!b&&h.trim()!==``&&C.length===0&&(0,Y.jsx)(`div`,{className:`col-span-full flex justify-center py-10`,children:(0,Y.jsx)(`span`,{className:`text-default-800`,children:a(`common:server.noResults`,{keyword:h})})})]}),j.length>0&&(0,Y.jsxs)(`div`,{className:`flex flex-col space-y-4`,children:[(0,Y.jsx)(`h2`,{className:`text-[18px] font-bold text-foreground`,children:a(`common:server.starred`,`Favorites`)}),(0,Y.jsx)(`div`,{className:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 w-full`,children:j.map(e=>q(e,`starred`))})]}),k.length>0&&(0,Y.jsxs)(`div`,{className:`flex flex-col space-y-4`,children:[(0,Y.jsx)(`h2`,{className:`text-[18px] font-bold text-foreground`,children:a(`common:server.history`,`Search History`)}),(0,Y.jsx)(`div`,{className:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 w-full`,children:k.map(e=>q(e,`history`))})]})]})}function pe(){let{info:e}=X(),{classes:t}=q();return(0,J.useMemo)(()=>{if(!e?.boards||e.boards.length===0)return null;let n=e.boards[0].id,r=Math.floor(n/10);return t.find(e=>e.order===r)?.name||null},[e?.boards,t])}var me=e(W(),1),he=e(W(),1),ge=J.memo(()=>{let{info:e,isUpdating:t}=X();if(!e)return null;let n=(0,he.keyBy)(e.stats,`type`);return(0,Y.jsx)(p,{className:`shadow-none bg-character-input border-1 border-crafting-border rounded-lg`,children:(0,Y.jsxs)(u,{className:`flex flex-col items-center gap-2`,children:[(0,Y.jsx)(`div`,{className:`w-[72px] h-[72px] rounded-full overflow-hidden bg-default-100 flex justify-center items-center`,children:(0,Y.jsx)(`img`,{src:e.profile.profileImage,alt:`avatar`,className:`w-full h-full object-cover`,draggable:!1})}),(0,Y.jsxs)(`div`,{className:`w-full text-center text-default-800`,children:[(0,Y.jsxs)(`div`,{className:`text-[18px]`,children:[e.profile.characterName,e.profile.titleName?(0,Y.jsxs)(`span`,{className:`text-grade-${(0,me.lowerCase)(e.profile.titleGrade)}`,children:[` [`,e.profile.titleName,`]`]}):null]}),(0,Y.jsxs)(`div`,{className:`mt-2 text-[14px] flex flex-wrap justify-center items-center gap-x-2 gap-y-1 text-default-800`,children:[(0,Y.jsx)(`span`,{children:e.profile.raceName}),(0,Y.jsx)(`span`,{children:`|`}),(0,Y.jsx)(`span`,{children:e.profile.serverName}),(0,Y.jsx)(`span`,{children:`|`}),(0,Y.jsx)(`span`,{children:e.profile.className}),(0,Y.jsx)(`span`,{children:`|`}),e.profile.regionName?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(`span`,{children:e.profile.regionName}),(0,Y.jsx)(`span`,{children:`|`})]}):null,(0,Y.jsxs)(`span`,{className:`font-semibold`,children:[`战力值`,n.ItemLevel?.value??`-`]}),(0,Y.jsx)(`span`,{children:`|`}),t?(0,Y.jsxs)(`span`,{className:`flex items-center gap-1`,children:[(0,Y.jsx)(`span`,{children:`更新中`}),(0,Y.jsx)(g,{size:`sm`,className:`scale-75 origin-left`})]}):(0,Y.jsxs)(`span`,{children:[`更新于 `,N(e.updatedAt).fromNow()]})]})]})]})})});function _e(){let[e,t]=(0,J.useState)(!1);return(0,J.useEffect)(()=>{let e=window.matchMedia(`(pointer: coarse)`);t(e.matches);let n=e=>t(e.matches);return e.addEventListener(`change`,n),()=>e.removeEventListener(`change`,n)},[]),e}const Z=({content:e,children:t,popoverProps:n,...r})=>_e()?(0,Y.jsxs)(c,{placement:r.placement,isDisabled:r.isDisabled,...n,children:[(0,Y.jsx)(s,{children:t}),(0,Y.jsx)(m,{className:r.classNames?.content||r.className,children:e})]}):(0,Y.jsx)(f,{content:e,...r,children:t});var ve=e(W(),1),ye=J.memo(()=>{let{info:e,stats:t}=X(),{t:n}=M(),[i,a]=(0,J.useState)(!0);if(!e||!t)return null;let s=(0,ve.keyBy)(e.stats,`type`),c=e=>{let r=t[e];return(0,Y.jsx)(`div`,{className:`grid grid-cols-6 gap-1 sm:gap-3`,children:r?.map((t,r)=>{let i=((s[t.type]?.value??0)*(e===`mainStats`?.1:.2)).toFixed(1),a=n(`stats:${t.type}.name`),o=n(`stats:${t.type}.description`,``);return(0,Y.jsx)(Z,{content:(0,Y.jsxs)(`div`,{className:`px-1 py-1`,children:[(0,Y.jsxs)(`div`,{className:`flex justify-between items-center mb-1 gap-4`,children:[(0,Y.jsxs)(`span`,{className:`font-bold text-default-800`,children:[a,o&&`[${o}]`]}),(0,Y.jsx)(`span`,{className:`font-bold text-foreground`,children:s[t.type]?.value??`-`})]}),t.secondStats?.map((e,t)=>(0,Y.jsxs)(`div`,{className:`flex justify-between gap-4`,children:[(0,Y.jsx)(`span`,{className:`text-default-800`,children:n(`stats:${e.type}.name`)}),(0,Y.jsxs)(`span`,{className:`font-bold`,children:[e.type===`CooldownDecrease`||e.type===`MPCostDecrease`?`-`:`+`,i,`%`]})]},t))]}),placement:`top`,radius:`sm`,delay:0,closeDelay:0,children:(0,Y.jsxs)(`div`,{className:`text-center bg-character-card rounded-md border-1 border-crafting-border p-1 sm:p-2 cursor-help outline-none focus-visible:ring-2 focus-visible:ring-primary`,tabIndex:0,children:[(0,Y.jsx)(`div`,{className:`w-full max-w-[60px] aspect-square mx-auto rounded-lg overflow-hidden`,children:(0,Y.jsx)(`img`,{src:F(t.icon),alt:t.type,className:`w-full h-full object-cover`,draggable:!1})}),(0,Y.jsx)(`div`,{className:`text-[12px] sm:text-[18px] text-default-800 truncate`,children:n(`stats:${t.type}.name`)}),(0,Y.jsx)(`div`,{className:`text-[12px] sm:text-[18px] text-default-800 font-semibold`,children:s[t.type]?.value??`-`})]})},r)})})};return(0,Y.jsxs)(p,{className:`shadow-none bg-character-input border-1 border-crafting-border rounded-lg`,children:[(0,Y.jsxs)(u,{className:`space-y-4`,children:[(0,Y.jsx)(`div`,{className:`mb-0`,children:c(`mainStats`)}),!i&&(0,Y.jsx)(`div`,{className:`mt-3`,children:c(`lordStats`)})]}),(0,Y.jsx)(v,{}),(0,Y.jsx)(l,{className:`p-0`,children:(0,Y.jsxs)(d,{variant:`light`,disableRipple:!0,disableAnimation:!0,onPress:()=>a(!i),className:`
            w-full text-default-700 gap-2 shadow-none bg-transparent
            hover:bg-transparent active:bg-transparent focus:bg-transparent focus-visible:bg-transparent
            data-[hover=true]:bg-transparent data-[pressed=true]:bg-transparent data-[focus-visible=true]:bg-transparent
          `,size:`md`,radius:`none`,children:[i?n(`common:menu.expand`,`Expand`):n(`common:menu.collapse`,`Collapse`),(0,Y.jsx)(O,{icon:i?o:r})]})})]})}),be=J.memo(()=>{let{equipments:e,skillsById:t}=X(),{t:n}=M(),r=r=>{let i=(e?.skills??[]).filter(e=>t.get(e.id)?.category===r)??[];return(0,Y.jsxs)(`div`,{className:`flex gap-0 border-1 border-crafting-border bg-character-card rounded-lg`,children:[(0,Y.jsx)(`div`,{className:`w-[38px] shrink-0 flex items-center justify-center border-r-1 border-crafting-border`,children:(0,Y.jsx)(`div`,{className:`w-[18px] text-center text-[18px] font-semibold text-default-700 break-words`,children:n(`common:skills.category.${r.toLowerCase()}`,r)})}),(0,Y.jsx)(`div`,{className:`flex flex-wrap gap-3 p-3`,children:i.map(e=>{let r=t.get(e.id),i=r?.icon?F(`UI/Resource/Texture/Skill/${r.icon}`):void 0;return(0,Y.jsx)(Z,{content:(0,Y.jsxs)(`div`,{className:`px-1 py-1`,children:[(0,Y.jsx)(`div`,{className:`text-small font-bold`,children:n(`skills:${e.id}.name`,String(e.id))}),(0,Y.jsx)(`div`,{className:`text-tiny`,children:e.skillLevel===0?`未解锁`:`Lv.${e.skillLevel}`})]}),placement:`top`,radius:`sm`,delay:0,closeDelay:0,children:(0,Y.jsxs)(`div`,{className:`relative h-[48px] w-[48px] overflow-hidden rounded-md cursor-help outline-none focus-visible:ring-2 focus-visible:ring-primary`,tabIndex:0,children:[i?(0,Y.jsx)(`img`,{src:i,alt:String(e.id),className:`h-full w-full object-cover ${e.skillLevel===0?`grayscale brightness-50`:``}`,draggable:!1}):(0,Y.jsx)(`div`,{className:`h-full w-full bg-default-200`}),e.skillLevel===0?(0,Y.jsx)(`div`,{className:`absolute inset-0 bg-black/20 flex items-center justify-center text-white/80`,children:(0,Y.jsx)(O,{icon:_})}):(0,Y.jsxs)(`div`,{className:`absolute bottom-0 right-0 bg-black/60 text-white text-[14px] px-1 rounded-tl-md`,children:[`LV`,e.skillLevel]})]})},String(e.id))})})]})};return(0,Y.jsxs)(`div`,{className:`space-y-4`,children:[r(`Active`),r(`Passive`),r(`Dp`)]})}),xe=J.memo(()=>{let{info:e}=X();return!e||!e.rankings||e.rankings.length===0?(0,Y.jsx)(`div`,{className:`flex justify-center items-center py-4 w-full`,children:(0,Y.jsx)(g,{size:`sm`})}):(0,Y.jsx)(`div`,{className:`grid grid-cols-1 sm:grid-cols-2 gap-3 w-full`,children:e.rankings.map((e,t)=>(0,Y.jsx)(p,{className:`shadow-none bg-character-card border-1 border-crafting-border rounded-lg`,children:(0,Y.jsxs)(u,{className:`p-2 flex flex-row items-center gap-3`,children:[(0,Y.jsxs)(`div`,{className:`flex flex-col flex-1 min-w-0 justify-between h-full`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,Y.jsxs)(`span`,{className:`text-[18px] text-primary`,children:[`第 `,e.rank??`-`,` 名`]}),e.rankChange!==null&&e.rankChange!==0&&!isNaN(e.rankChange)&&(0,Y.jsx)(`span`,{className:`text-[14px] ${e.rankChange>0?`text-danger`:`text-success`}`,children:e.rankChange>0?`↓ ${e.rankChange}`:`↑ ${Math.abs(e.rankChange)}`})]}),(0,Y.jsx)(`div`,{className:`text-[14px] text-default-800`,children:e.rankingContentsName})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col items-center shrink-0 justify-between h-full`,children:[e.gradeIcon&&(0,Y.jsx)(`img`,{src:e.gradeIcon,alt:e.gradeName||`grade`,className:`w-10 h-10 object-contain`}),e.point!==null&&(0,Y.jsx)(`div`,{className:`text-[12px] text-default-800 font-medium`,children:e.point})]})]})},t))})});function Se(){let[e,t]=(0,J.useState)(!1);return(0,J.useEffect)(()=>{let e=window.matchMedia(`(max-width: 767px)`);t(e.matches);let n=e=>t(e.matches);return e.addEventListener(`change`,n),()=>e.removeEventListener(`change`,n)},[]),e}var Q=e(W(),1),Ce=[`MainHand`,`SubHand`,`Helmet`,`Shoulder`,`Torso`,`Belt`,`Pants`,`Gloves`,`Boots`,`Cape`],we=[`Earring1`,`Earring2`,`Necklace`,`Amulet`,`Ring1`,`Ring2`,`Bracelet1`,`Bracelet2`,`Rune1`,`Rune2`],Te=J.memo(()=>{let{equipments:e,equipmentDetails:t}=X(),{itemsById:n}=G(),{t:r}=M(),a=Se(),o=(0,Q.keyBy)(e?.equipments??[],`slotPosName`),s=(0,Q.keyBy)(e?.skins??[],`slotPosName`),c=e=>e===0?(0,Y.jsx)(`div`,{className:`h-[16px] w-[16px] shrink-0`}):(0,Y.jsx)(`div`,{className:`mt-2 flex items-center justify-start gap-0`,children:Array.from({length:5}).map((t,n)=>(0,Y.jsx)(`div`,{className:`h-[16px] w-[16px] overflow-hidden rounded-sm flex justify-center items-center`,children:n<e&&(0,Y.jsx)(`img`,{src:F(`UI/Resource/Texture/Icon/UT_NP_QuestMonolith_Acquired.webp`),alt:`exceed-level`,className:`h-full w-full object-contain`,style:{objectFit:`contain`,objectPosition:`0% 50%`,transform:`scale(3)`},draggable:!1})},n))}),l=e=>{let l=o[e],u=s[e],d=l?.slotPos||u?.slotPos,f=d?t?.[`equipments:${d}`]:null,p=(l?n.get(l.id):null)||(f?n.get(f.id):null),m=F(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${p?.grade??`Common`}.webp`),h=F(p?.icon||``),_=r(`items/items:${p?.id||l?.id}.name`,String(p?.id||l?.id||``));return(0,Y.jsx)(Z,{content:f?(0,Y.jsxs)(`div`,{className:`space-y-2 w-full text-[14px]`,children:[(0,Y.jsx)(`div`,{className:`font-bold text-[18px] text-center pb-1`,children:`装备详情`}),(0,Y.jsxs)(`div`,{className:`p-2 rounded flex justify-between items-center bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${m})`,backgroundSize:`100% 100%`},children:[(0,Y.jsxs)(`div`,{className:`flex flex-col justify-between h-full`,children:[(0,Y.jsxs)(`div`,{className:`mb-1 text-[18px] font-bold text-stroke text-grade-${(0,Q.lowerCase)(p?.grade||`Common`)}`,children:[l?.enchantLevel?`+${l.enchantLevel} `:``,_]}),(0,Y.jsxs)(`div`,{className:`text-[14px]`,children:[(0,Y.jsx)(`span`,{className:`font-bold text-stroke text-grade-${(0,Q.lowerCase)(p?.grade||`Common`)}`,children:r(`items/grades:${p?.grade}.name`)}),(0,Y.jsx)(`span`,{className:`font-bold text-background`,children:r(`items/types:subtypes.${p?.subtype}.name`)})]}),(0,Y.jsx)(`div`,{className:`text-[14px] font-bold text-background`,children:`道具等级`}),(0,Y.jsxs)(`div`,{className:`text-[14px] font-bold text-background`,children:[f.level,` (+`,f.levelValue,`)`]})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col items-center`,children:[(0,Y.jsx)(`div`,{className:`relative`,children:(0,Y.jsx)(`img`,{src:h,alt:_,className:`w-16 h-16 object-contain`})}),c(l?.exceedLevel||0)]})]}),f.mainStats&&f.mainStats.length>0&&(0,Y.jsx)(`div`,{className:`bg-character-card p-2 rounded space-y-1`,children:f.mainStats.map((e,t)=>(0,Y.jsxs)(`div`,{className:`flex justify-between`,children:[(0,Y.jsx)(`span`,{className:`${e.exceed?`text-grade-epic`:`text-default-800`} font-[700]`,children:r(`stats:${e.id}.name`,e.id)}),(0,Y.jsxs)(`span`,{className:`text-foreground font-[700]`,children:[!e.exceed&&(e.minValue&&e.minValue!==``?`${e.minValue} - ${e.value}`:e.value),e.extra!==`0`&&e.extra!==`0%`&&(e.exceed?(0,Y.jsx)(`span`,{className:`text-grade-epic ml-1`,children:e.extra}):(0,Y.jsxs)(`span`,{className:`text-grade-rare ml-1`,children:[`(+`,e.extra,`)`]}))]})]},`${e.id}-${t}`))}),(f.subStats&&f.subStats.length>0||f.subSkills&&f.subSkills.length>0)&&(0,Y.jsxs)(`div`,{className:`bg-character-card p-2 rounded space-y-1`,children:[(0,Y.jsx)(i,{"aria-label":`Loading...`,color:`primary`,value:Number(f.soulBindRate),label:`灵魂刻印率`,valueLabel:`${f.soulBindRate}%`,showValueLabel:!0,classNames:{label:`text-[14px] text-default-800 font-[700]`,value:`text-[14px] text-foreground font-[700]`,base:`gap-0.5`},size:`sm`}),f.subStats&&f.subStats.map((e,t)=>(0,Y.jsxs)(`div`,{className:`flex justify-between`,children:[(0,Y.jsx)(`span`,{className:`text-default-800 font-[700]`,children:r(`stats:${e.id}.name`,e.id)}),(0,Y.jsx)(`span`,{className:`text-foreground font-[700]`,children:e.value})]},`${e.id}-${t}`)),f.subSkills&&f.subSkills.map((e,t)=>(0,Y.jsxs)(`div`,{className:`flex justify-between items-center`,children:[(0,Y.jsx)(`span`,{className:`text-default-800 font-[700]`,children:r(`skills:${e.id}.name`,String(e.id))}),(0,Y.jsxs)(`span`,{className:`text-foreground font-[700]`,children:[`Lv.+`,e.level]})]},`${e.id}-${t}`))]}),f.magicStoneStat?.length>0&&(0,Y.jsx)(`div`,{className:`pt-1`,children:(0,Y.jsx)(`div`,{className:`bg-character-card p-2 rounded grid grid-cols-2 gap-x-4 gap-y-1`,children:f.magicStoneStat.map((e,t)=>(0,Y.jsxs)(`div`,{className:`flex justify-between text-grade-${(0,Q.lowerCase)(e.grade)}`,children:[(0,Y.jsx)(`span`,{className:`font-[700] whitespace-nowrap`,children:r(`stats:${e.id}.name`,e.id)}),(0,Y.jsx)(`span`,{className:`font-[700]`,children:e.value})]},t))})}),f.godStoneStat?.length>0&&(0,Y.jsx)(`div`,{className:`pt-1 space-y-1`,children:(0,Y.jsx)(`div`,{className:`bg-character-card p-2 rounded space-y-1`,children:f.godStoneStat.map((e,t)=>(0,Y.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Y.jsx)(`div`,{className:`flex justify-between items-center`,children:(0,Y.jsx)(`span`,{className:`text-grade-${(0,Q.lowerCase)(e.grade)} font-[700]`,children:e.name})}),(0,Y.jsx)(`div`,{className:`text-default-800 text-[12px] mt-1`,children:e.desc})]},t))})})]}):(0,Y.jsx)(`div`,{className:`flex justify-center items-center py-2`,children:(0,Y.jsx)(g,{size:`sm`})}),classNames:{content:`bg-character-equipment shadow-none px-2 py-4 w-[330px] max-w-[calc(100vw-32px)]`},placement:a?`bottom`:`left`,radius:`lg`,isDisabled:!l,delay:0,closeDelay:0,children:(0,Y.jsx)(`div`,{className:`relative h-14 bg-contain bg-center bg-no-repeat rounded-sm shadow-none cursor-help outline-none focus-visible:ring-2 focus-visible:ring-primary`,style:{backgroundImage:`url(${m})`,backgroundSize:`100% 100%`},tabIndex:0,children:(0,Y.jsxs)(`div`,{className:`flex h-full w-full items-center rounded-[4px] px-2`,children:[(0,Y.jsx)(`div`,{className:`relative shrink-0`,children:l||f?(0,Y.jsx)(`img`,{src:h,alt:_,className:`h-12 w-12 object-contain`,draggable:!1}):(0,Y.jsx)(`div`,{className:`h-12 w-12`})}),(0,Y.jsxs)(`div`,{className:`ml-2 flex h-[48px] min-w-0 flex-1 flex-col justify-center`,children:[(0,Y.jsx)(`div`,{className:`truncate text-left text-[13px] font-bold leading-[13px] text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.35)]`,children:l||f?`${_} +${l?.enchantLevel??f?.enchantLevel??0}`:``}),c(l?.exceedLevel||0)]}),u&&(0,Y.jsx)(Z,{content:u.name,placement:`top`,radius:`sm`,children:(0,Y.jsx)(`div`,{className:`ml-2 shrink-0`,children:(0,Y.jsx)(`img`,{src:u.icon,alt:u.name,className:`w-10 h-10 object-contain border-1 bg-transparent border-primary`,draggable:!1})})})]})})},e)};return(0,Y.jsxs)(`div`,{className:`space-y-3`,children:[(0,Y.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,Y.jsx)(`div`,{className:`flex flex-col gap-3`,children:Ce.map(e=>l(e))}),(0,Y.jsx)(`div`,{className:`flex flex-col gap-3`,children:we.map(e=>l(e))})]}),(0,Y.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[e?.pet?.id&&(0,Y.jsxs)(`div`,{className:`relative h-[56px] bg-character-card border-1 border-crafting-border rounded-md flex items-center px-2`,children:[(0,Y.jsx)(`img`,{src:e.pet.icon,alt:e.pet.name,className:`h-12 w-12 shrink-0 object-contain rounded-md`,draggable:!1}),(0,Y.jsxs)(`div`,{className:`ml-2 flex flex-col justify-center min-w-0`,children:[(0,Y.jsx)(`div`,{className:`truncate text-[14px] font-bold text-default-800`,children:e.pet.name}),(0,Y.jsxs)(`div`,{className:`text-[12px] text-default-600`,children:[`Lv.`,e.pet.level]})]})]}),e?.wing?.id&&(0,Y.jsxs)(`div`,{className:`relative h-[56px] bg-character-card border-1 border-crafting-border rounded-md flex items-center px-2`,children:[(0,Y.jsx)(`img`,{src:e.wing.icon,alt:e.wing.name,className:`h-12 w-12 shrink-0 object-contain rounded-md`,draggable:!1}),(0,Y.jsxs)(`div`,{className:`ml-2 flex flex-col justify-center min-w-0`,children:[(0,Y.jsx)(`div`,{className:`truncate text-[14px] font-bold text-grade-${(0,Q.lowerCase)(e.wing.grade)}`,children:e.wing.name}),(0,Y.jsx)(`div`,{className:`text-[12px] text-default-600`,children:r(`items/grades:${e.wing.grade}.name`,e.wing.grade)})]})]})]})]})}),$=e(W(),1),Ee=J.memo(()=>{let{equipments:e,equipmentDetails:t}=X(),{itemsById:n}=G(),{t:r}=M(),i=(0,$.keyBy)(e?.equipments??[],`slotPos`);return(0,Y.jsx)(`div`,{className:`grid grid-cols-5 w-full gap-2 sm:gap-4 justify-items-center`,children:[41,42,43,44,45].map(e=>{let a=i[e],o=t?.[`equipments:${e}`],s=(a?n.get(a.id):null)||(o?n.get(o.id):null),c=F(s?.icon||``),l=r(`items/items:${s?.id||a?.id}.name`,String(s?.id||a?.id||``)),u=F(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${s?.grade??`Common`}.webp`);return(0,Y.jsx)(Z,{content:o?(0,Y.jsxs)(`div`,{className:`space-y-2 w-full text-[14px]`,children:[(0,Y.jsx)(`div`,{className:`font-bold text-[18px] text-center pb-1`,children:`装备详情`}),(0,Y.jsxs)(`div`,{className:`p-2 rounded flex justify-between items-center bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${u})`,backgroundSize:`100% 100%`},children:[(0,Y.jsxs)(`div`,{className:`flex flex-col justify-between h-full`,children:[(0,Y.jsxs)(`div`,{className:`mb-1 text-[18px] font-bold text-stroke text-grade-${(0,$.lowerCase)(s?.grade||`Common`)}`,children:[a?.enchantLevel?`+${a.enchantLevel} `:``,l]}),(0,Y.jsx)(`div`,{className:`text-[14px]`,children:(0,Y.jsx)(`span`,{className:`font-bold text-stroke text-grade-${(0,$.lowerCase)(s?.grade||`Common`)}`,children:r(`items/grades:${s?.grade}.name`)})}),(0,Y.jsx)(`div`,{className:`text-[14px] font-bold text-background`,children:`道具等级`}),(0,Y.jsxs)(`div`,{className:`text-[14px] font-bold text-background`,children:[o.level,` (+`,o.levelValue,`)`]})]}),(0,Y.jsx)(`div`,{className:`flex flex-col items-center`,children:(0,Y.jsx)(`div`,{className:`relative`,children:(0,Y.jsx)(`img`,{src:c,alt:l,className:`w-16 h-16 object-contain`})})})]}),(0,Y.jsxs)(`div`,{className:`bg-character-card p-2 rounded space-y-1`,children:[o.mainStats&&o.mainStats.length>0&&o.mainStats.map((e,t)=>(0,Y.jsxs)(`div`,{className:`flex justify-between`,children:[(0,Y.jsx)(`span`,{className:`${e.exceed?`text-grade-epic`:`text-default-800`} font-[700]`,children:r(`stats:${e.id}.name`,e.id)}),(0,Y.jsxs)(`span`,{className:`text-foreground font-[700]`,children:[!e.exceed&&(e.minValue&&e.minValue!==``?`${e.minValue} - ${e.value}`:e.value),e.extra!==`0`&&e.extra!==`0%`&&(e.exceed?(0,Y.jsx)(`span`,{className:`text-grade-epic ml-1`,children:e.extra}):(0,Y.jsxs)(`span`,{className:`text-grade-rare ml-1`,children:[`(+`,e.extra,`)`]}))]})]},`${e.id}-${t}`)),o.subSkills&&o.subSkills.length>0&&o.subSkills.map((e,t)=>(0,Y.jsxs)(`div`,{className:`flex justify-between items-center`,children:[(0,Y.jsx)(`span`,{className:`text-default-800 font-[700]`,children:r(`skills:${e.id}.name`,String(e.id))}),(0,Y.jsxs)(`span`,{className:`text-foreground font-[700]`,children:[`Lv.+`,e.level]})]},`${e.id}-${t}`))]})]}):(0,Y.jsx)(`div`,{className:`flex justify-center items-center py-2`,children:(0,Y.jsx)(g,{size:`sm`})}),isDisabled:!a,placement:`top`,classNames:{content:`bg-character-equipment rounded-lg shadow-none px-2 py-4 w-[330px] max-w-[calc(100vw-32px)]`},delay:0,closeDelay:0,children:(0,Y.jsx)(`div`,{className:`relative flex justify-center items-start cursor-help outline-none focus-visible:ring-2 focus-visible:ring-primary rounded-lg w-full max-w-24 aspect-square`,tabIndex:0,children:a?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(`img`,{src:c,alt:l,className:`object-contain rounded-lg w-full h-full`,draggable:!1}),(0,Y.jsxs)(`div`,{className:`absolute left-1/2 -translate-x-1/2 bottom-[4px] text-white bg-black/60 px-2 rounded-lg text-[14px] font-bold pointer-events-none`,children:[`+`,a?.enchantLevel??0]})]}):(0,Y.jsx)(`div`,{className:`bg-default-800 rounded-lg w-full h-full relative`,children:(0,Y.jsx)(`div`,{className:`absolute inset-0 bg-black/20 flex items-center justify-center text-white/80 rounded-lg`,children:(0,Y.jsx)(O,{icon:_,size:`xl`})})})})},e)})})}),De=e(W(),1),Oe=J.memo(()=>{let{info:e}=X(),{t}=M();if(!e)return null;let n=[`Attack`,`Defense`,`Etc`],r=[`UT_Stat_GrowthSummary_Title_First.webp`,`UT_Stat_GrowthSummary_Title_Second.webp`,`UT_Stat_GrowthSummary_Title_Third.webp`];return(0,Y.jsx)(`div`,{className:`grid grid-cols-1 sm:grid-cols-3 gap-4`,children:n.map((n,i)=>{let a=e.titles?.find(e=>e.equipCategory===n);return(0,Y.jsxs)(p,{className:`shadow-none bg-character-card border-1 border-crafting-border rounded-lg overflow-hidden`,children:[(0,Y.jsxs)(h,{className:`flex gap-3 p-3 bg-character-input border-b-1 border-crafting-border`,children:[(0,Y.jsx)(`div`,{className:`h-10 w-10 shrink-0 overflow-hidden rounded-full bg-foreground p-1 flex items-center justify-center`,children:(0,Y.jsx)(`img`,{src:F(`UI/Resource/Texture/ETC/${r[i]}`),alt:n,draggable:!1,className:`h-full w-full object-contain scale-125`})}),(0,Y.jsxs)(`div`,{className:`flex flex-col gap-0.5 text-[14px]`,children:[(0,Y.jsx)(`p`,{className:`text-default-800`,children:t(`common:titles.${n}`,n)}),(0,Y.jsxs)(`p`,{className:`text-default-700`,children:[(0,Y.jsx)(`span`,{className:`text-foreground font-bold`,children:a?.ownedCount??0}),` / `,a?.totalCount??0]})]})]}),(0,Y.jsxs)(u,{className:`p-3`,children:[(0,Y.jsx)(`div`,{className:`text-[15px] font-bold mb-1 text-grade-${(0,De.lowerCase)(a?.grade||`Common`)}`,children:a?.name||`尚未装备`}),(0,Y.jsx)(`div`,{className:`space-y-0.5`,children:a?.equipStats&&a?.equipStats.map((e,t)=>(0,Y.jsx)(`div`,{className:`text-[13px] text-default-800`,children:e},t))})]})]},n)})})}),ke=[`images/Board/Nezekan.webp`,`images/Board/Zikel.webp`,`images/Board/Vaizel.webp`,`images/Board/Triniel.webp`,null,null],Ae=J.memo(()=>{let{info:e,boardDetails:t,stats:n}=X(),{boards:r,loadBoardsForClass:i,loading:a}=ue(),o=pe(),{isOpen:s,onOpen:c,onOpenChange:l}=C(),[u,d]=(0,J.useState)(null),{t:f}=M(),p=(0,J.useMemo)(()=>n?.boardStats?Object.fromEntries(n.boardStats.map(e=>[e.type,e.value])):{},[n]);(0,J.useEffect)(()=>{o&&i(o)},[o,i]);let m=e=>{d(e),c()},h=(0,J.useMemo)(()=>r.find(e=>e.id===u),[r,u]),g=(0,J.useMemo)(()=>!u||!t?null:t[`boards:${u}`],[t,u]);if(console.log(t),!e||!e.boards)return null;let _=(e,t)=>e.grade===`None`?`images/Board/board_icon_start_${o?.toLowerCase()}.webp`:`images/Board/board_icon_${e.grade?.toLowerCase()||`common`}${t?`_open`:``}.webp`,v=()=>{if(a)return(0,Y.jsxs)(`div`,{className:`flex flex-col items-center justify-center py-20 gap-4`,children:[(0,Y.jsx)(T,{"aria-label":`Loading...`,size:`lg`}),(0,Y.jsx)(`div`,{className:`text-default-500`,children:`正在加载星盘数据...`})]});if(!h)return(0,Y.jsx)(`div`,{className:`py-20 text-center text-default-500`,children:`未能加载星盘配置`});let e=Array.from({length:15},()=>Array(15).fill(null));return h.nodes.forEach(t=>{let n=t.id%1e3,r=Math.floor((n-1)/15),i=(n-1)%15;r>=0&&r<15&&i>=0&&i<15&&(e[r][i]=t)}),(0,Y.jsx)(`div`,{className:`grid gap-1 mx-auto aspect-square w-full p-2`,style:{gridTemplateColumns:`repeat(15, minmax(0, 1fr))`},children:e.map((e,t)=>e.map((e,n)=>{if(!e)return(0,Y.jsx)(`div`,{className:`aspect-square`},`empty-${t}-${n}`);let r=g?.openNodes.includes(e.id),i=_(e,!!r);return(0,Y.jsx)(`div`,{className:`aspect-square flex items-center justify-center relative`,children:(0,Y.jsx)(Z,{isDisabled:e.grade===`None`,content:(0,Y.jsxs)(`div`,{className:`px-2 py-1`,children:[e.skillId&&(0,Y.jsxs)(`div`,{className:`text-xs text-foreground flex justify-between gap-1`,children:[(0,Y.jsx)(`span`,{children:f(`skills:${e.skillId}.name`,String(e.skillId))}),(0,Y.jsx)(`span`,{className:`font-bold`,children:`+Lv.1`})]}),e.stats?.map((e,t)=>(0,Y.jsxs)(`div`,{className:`text-xs text-foreground flex justify-between gap-1`,children:[(0,Y.jsx)(`span`,{children:f(`stats:${e}.name`,e)}),(0,Y.jsxs)(`span`,{className:`font-bold`,children:[`+`,p[e]||``]})]},t))]}),delay:0,closeDelay:0,classNames:{base:`pointer-events-none`},children:(0,Y.jsx)(`img`,{src:F(i),alt:e.grade,className:`w-full h-full object-contain cursor-help transition-transform hover:scale-110 hover:z-50 active:scale-95 ${!r&&e.grade!==`None`?`opacity-60 grayscale-[0.5]`:``}`,draggable:!1})})},e.id)}))})};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(`div`,{className:`grid grid-cols-3 sm:grid-cols-6 gap-2 sm:gap-3`,children:e.boards.map((e,t)=>(0,Y.jsx)(Z,{content:(0,Y.jsxs)(`div`,{className:`px-1 py-1`,children:[(0,Y.jsx)(`div`,{className:`font-bold text-foreground text-center`,children:e.name}),(0,Y.jsxs)(`div`,{className:`text-xs text-default-800 text-center`,children:[e.openNodeCount,` / `,e.totalNodeCount]})]}),placement:`top`,radius:`sm`,delay:0,closeDelay:0,children:(0,Y.jsxs)(`div`,{className:`text-center cursor-pointer outline-none focus-visible:ring-2 focus-visible:ring-primary`,tabIndex:0,onClick:()=>m(e.id),children:[(0,Y.jsxs)(`div`,{className:`w-full max-w-[80px] aspect-square mx-auto rounded-lg overflow-hidden relative flex items-center justify-center`,children:[(0,Y.jsx)(`img`,{src:F(`images/Board/Background.webp`),alt:``,className:`w-full h-full object-cover ${e.open===0?`grayscale opacity-50`:``}`,draggable:!1}),ke[t]&&(0,Y.jsx)(`img`,{src:F(ke[t]),alt:e.name,className:`absolute inset-0 w-full h-full object-contain p-2 ${e.open===0?`grayscale opacity-50`:``}`,draggable:!1}),(0,Y.jsx)(T,{"aria-label":e.name,size:`sm`,value:e.openNodeCount/e.totalNodeCount*100,color:`primary`,disableAnimation:!0,className:`absolute inset-0 z-10 p-1.5`,classNames:{svg:`w-full h-full`,indicator:`stroke-primary`,track:`stroke-transparent`}})]}),(0,Y.jsxs)(`div`,{className:`text-[14px] text-default-800 truncate mt-1`,children:[Math.round(e.openNodeCount/e.totalNodeCount*100),`%`]})]})},e.id))}),(0,Y.jsx)(b,{isOpen:s,onOpenChange:l,size:`3xl`,classNames:{base:`max-h-[90vh] bg-character-equipment`,body:`p-2 sm:p-6 overflow-x-hidden`},children:(0,Y.jsx)(S,{children:()=>(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(k,{className:`flex flex-col gap-1`,children:e.boards.find(e=>e.id===u)?.name||`守护力`}),(0,Y.jsx)(A,{children:v()})]})})})]})});function je(){let{info:e,loading:t,error:n,characterId:r,stats:i}=X(),{loadBoardsForClass:o}=ue(),s=pe(),c=Se();if((0,J.useEffect)(()=>{s&&o(s)},[s,o]),!r)return null;if(n)return(0,Y.jsx)(`div`,{className:`grid place-items-center py-20 text-default-500`,children:(0,Y.jsxs)(`div`,{className:`rounded-lg border border-default-200 bg-content2 px-6 py-3 text-sm`,children:[`Error loading character: `,n]})});if(t||!e)return(0,Y.jsx)(`div`,{className:`flex justify-center items-center py-20`,children:(0,Y.jsx)(g,{})});if(!i)return null;let l={base:`!bg-transparent !shadow-none !backdrop-filter-none !backdrop-blur-none pb-2 `,trigger:`py-4 min-h-0 px-2`,title:`text-[16px] leading-[16px] font-bold`,content:`py-0`,indicator:`text-default-700`},u=[{key:`equipments`,title:`装备`,component:(0,Y.jsx)(Te,{})},{key:`cards`,title:`阿尔卡那`,component:(0,Y.jsx)(Ee,{})},{key:`stats`,title:`主要能力值`,component:(0,Y.jsx)(ye,{})},{key:`boards`,title:`守护力`,component:(0,Y.jsx)(Ae,{})},{key:`skills`,title:`技能`,component:(0,Y.jsx)(be,{})},{key:`titles`,title:`称号`,component:(0,Y.jsx)(Oe,{})},{key:`rankings`,title:`排名`,component:(0,Y.jsx)(xe,{})}],d=[`stats`,`skills`,`rankings`],f=[`equipments`,`cards`,`boards`,`titles`],p=(e,t)=>(0,Y.jsx)(a,{variant:`light`,selectionMode:`multiple`,defaultExpandedKeys:e.map(e=>e.key),itemClasses:l,showDivider:!1,className:t,children:e.map(e=>(0,Y.jsx)(j,{title:e.title,className:`w-full`,children:e.component},e.key))});return(0,Y.jsxs)(`div`,{className:`w-full space-y-4`,children:[(0,Y.jsx)(ge,{}),c?(0,Y.jsx)(`div`,{children:p(u)}):(0,Y.jsxs)(`div`,{className:`grid grid-cols-2 gap-4`,children:[(0,Y.jsx)(`div`,{className:`flex flex-col`,children:p(u.filter(e=>d.includes(e.key)))}),(0,Y.jsx)(`div`,{className:`flex flex-col`,children:p(u.filter(e=>f.includes(e.key)))})]})]})}function Me(){return(0,Y.jsxs)(`div`,{className:`h-full overflow-y-auto bg-chacracter-page flex flex-col`,children:[(0,Y.jsxs)(`div`,{className:`max-w-6xl mx-auto px-4 py-6 space-y-4 flex-1 w-full`,children:[(0,Y.jsx)(fe,{}),(0,Y.jsx)(je,{})]}),(0,Y.jsx)(te,{})]})}var Ne=()=>(0,Y.jsx)(K,{children:(0,Y.jsx)(ee,{children:(0,Y.jsx)(le,{children:(0,Y.jsx)(se,{children:(0,Y.jsx)(re,{children:(0,Y.jsx)(Me,{})})})})})});export{Ne as component};