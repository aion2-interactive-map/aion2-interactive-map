import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-Cn-hdQty.js";import{t as r}from"./Trans-D6Od9bjo.js";import{Jt as i,Q as a,Qt as o,Xt as s,Zt as c,_t as l,an as u,bt as d,et as f,ft as p,gt as m,on as h,pt as g,qt as _,sn as v,st as y,t as b,tn as x,ut as S,vt as C,xt as w,yt as T}from"./vendor-ui-baGiFta6.js";import{S as E,a as D,b as O,d as k,f as A,o as j,p as M,s as N}from"./index-BzPlsON4.js";import{t as P}from"./AdaptiveTooltip-CUbqp8VP.js";import{t as F}from"./Footer-eCwWR5xq.js";var I=e(t(),1),L=e(n(),1),R=({mapName:e,setMapName:t})=>{let{t:n}=E(),{seasons:r,artifactCounts:a,fetchArtifactCounts:c,loadingArtifactCounts:u,serverMatchings:f,loadingMatchings:h,region:v,setRegion:y}=j(),b={trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},x={itemClasses:{base:`rounded-none`}},S=(0,I.useMemo)(()=>{let e=r.filter(e=>e.serverRegion.toLowerCase()===v.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[r,v]);(0,I.useEffect)(()=>{S&&c(S,e)},[S,e,c]);let D=(0,I.useMemo)(()=>{let e=[...a].sort((e,t)=>t.artifactCount-e.artifactCount||e.serverId-t.serverId),t=[],n=-1,r=0;for(let i=0;i<e.length;i++){let a=e[i];a.artifactCount!==n&&(r=i+1,n=a.artifactCount),t.push({...a,rank:r})}return t},[a]),O=e=>{let t=f.find(t=>t.server1.serverId===e||t.server2.serverId===e);if(t){let r=t.server1.serverId===e?t.server1:t.server2,i=r.raceId===1?n(`common:server.lightAbbr`):n(`common:server.darkAbbr`),a=r.serverId%1e3;return`${r.serverName}（${i}${a}）`}let r=n(e<2e3?`common:server.lightAbbr`:`common:server.darkAbbr`),i=e%1e3;return`${n(`common:server.server`)}（${r}${i}）`};return(0,L.jsxs)(_,{className:`bg-transparent shadow-none`,children:[(0,L.jsx)(i,{className:`flex flex-col items-start gap-3 px-0`,children:(0,L.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,L.jsx)(`p`,{className:`text-[22px] text-default-800`,children:n(`common:leaderboard.artifactRegionRanking`)}),(0,L.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,L.jsxs)(p,{size:`sm`,selectedKeys:[v],onSelectionChange:e=>y(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:b,popoverProps:{radius:`none`},listboxProps:x,children:[(0,L.jsx)(g,{children:n(`common:server.tw`)},`tw`),(0,L.jsx)(g,{children:n(`common:server.kr`)},`kr`)]}),(0,L.jsxs)(p,{size:`sm`,selectedKeys:[e],onSelectionChange:e=>t(Array.from(e)[0]),className:`min-w-[150px] flex-[2] sm:flex-none sm:w-[200px]`,disallowEmptySelection:!0,classNames:b,popoverProps:{radius:`none`},listboxProps:x,children:[(0,L.jsx)(g,{children:n(`common:leaderboard.allMaps`,`全部地图`)},`ALL`),(0,L.jsx)(g,{children:n(`maps:${N.ABYSS_A}.description`)},N.ABYSS_A),(0,L.jsx)(g,{children:n(`maps:${N.ABYSS_B}.description`)},N.ABYSS_B)]})]})]})}),(0,L.jsx)(s,{className:`px-0`,children:u||h||f.length===0?(0,L.jsx)(`div`,{className:`flex justify-center items-center py-10`,children:(0,L.jsx)(o,{})}):(0,L.jsxs)(w,{"aria-label":`Artifact Region Ranking`,removeWrapper:!0,className:`min-w-full`,classNames:{table:`border-separate border-spacing-y-[10px] -mt-[10px]`,thead:`[&>tr]:first:shadow-none`,th:`bg-transparent text-foreground font-bold text-[16px] h-auto py-0`,td:`bg-character-equipment h-[44px] text-[16px] font-normal text-default-800 border-y-1 border-crafting-border first:border-l-1 last:border-r-1 first:rounded-l-md last:rounded-r-md`},children:[(0,L.jsxs)(T,{children:[(0,L.jsx)(d,{children:n(`common:leaderboard.rank`)}),(0,L.jsx)(d,{children:n(`common:server.server`)}),(0,L.jsx)(d,{align:`center`,children:n(`common:leaderboard.artifactCount`)})]}),(0,L.jsx)(l,{emptyContent:n(`common:ui.noData`),items:D,children:e=>(0,L.jsxs)(C,{children:[(0,L.jsx)(m,{children:(0,L.jsx)(`div`,{className:`flex items-center justify-center w-6 h-6`,children:e.rank})}),(0,L.jsx)(m,{children:(0,L.jsx)(`span`,{children:O(e.serverId)})}),(0,L.jsx)(m,{align:`center`,children:(0,L.jsx)(`span`,{children:e.artifactCount})})]},e.serverId)})]})})]})},z=({matching:e,server:t,isServer1:n,artifacts:i,mapName:a,artifactStates:o,artifactStateMap:s,isAutoUpdate:l,selectedDate:u,starredServerIds:d,toggleStar:p,t:m,icons:h})=>{let g=d.includes(t.serverId),_=m(n?`common:server.lightAbbr`:`common:server.darkAbbr`),v=n?`linear-gradient(135deg, #DBEDFF 0%, #F3FBFF 100%)`:`linear-gradient(225deg, #EFE5FF 0%, #F3FBFF 100%)`,x=n?`#1D3557`:`#4B0082`;return(0,L.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,L.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:v},children:[(0,L.jsx)(c,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute ${n?`left-1`:`right-1`} z-10 text-default-400 hover:text-star data-[starred=true]:text-star`,"data-starred":g,onClick:e=>{e.stopPropagation(),p(t.serverId)},children:(0,L.jsx)(y,{icon:g?f:b,className:`text-[16px]`})}),(0,L.jsx)(`span`,{className:`text-lg font-bold`,style:{color:x},children:t.serverName}),(0,L.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（`,_,t.serverId%1e3,`）`]})]}),(0,L.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:m(`maps:${a}.description`)}),(0,L.jsx)(`div`,{className:`flex gap-1`,children:i.map(t=>{let n=m(`markers/${a}:${t.markerId}.name`,t.marker.name),r=s[e.id]?.[t.id],i=r?.state,o=!!(r?.contributors&&r.contributors.length>0),c=!1;if(r?.recordTime&&o){let e=new Date(r.recordTime).getTime(),t=l?Date.now():u.toDate().getTime();e+1728e5-t<=0&&(c=!0)}else c=!0;let d=h.neutral;return c||(i===1?d=h.light:i===2&&(d=h.dark)),(0,L.jsx)(P,{content:n,children:(0,L.jsx)(`img`,{src:d,alt:n,className:`w-7 h-7 sm:w-12 sm:h-12`})},t.id)})})]}),(0,L.jsx)(`div`,{className:`w-full mt-1 min-h-[18px]`,children:(()=>{let e=o[0],t=!!(e?.contributors&&e.contributors.length>0),n=!1;if(e?.recordTime&&t){let t=new Date(e.recordTime).getTime(),r=l?Date.now():u.toDate().getTime();t+1728e5-r<=0&&(n=!0)}else n=!0;return n?(0,L.jsx)(`div`,{className:`flex justify-center w-full`,children:(0,L.jsx)(`span`,{className:`text-primary hover:underline text-sm font-bold cursor-pointer`,children:m(`common:leaderboard.submitData`)})}):t?(0,L.jsx)(`div`,{className:`flex items-center justify-between w-full`,onClick:e=>e.stopPropagation(),children:(0,L.jsx)(`span`,{className:`text-[12px] text-default-800`,children:(0,L.jsx)(r,{t:m,i18nKey:`common:leaderboard.providedBy`,values:{username:e.contributors[0].user.name},components:{emph:(0,L.jsx)(`span`,{className:`text-primary font-medium`})}})})}):null})()})]})]})},B=()=>{let e=M(),t=[N.ABYSS_A,N.ABYSS_B],n=`starred_artifact_servers`,{t:r,i18n:o}=E([...t.map(e=>`markers/${e}`),`common`]),{seasons:l,serverMatchings:d,loadingMatchings:f,artifactsByMap:m,loadingArtifacts:b,artifactStates:C,fetchServerMatchings:w,fetchArtifactStates:T,region:D,setRegion:k}=j(),[A,F]=(0,I.useState)(u(h())),[R,B]=(0,I.useState)(!0),[V,H]=(0,I.useState)(()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]}),U=(0,I.useCallback)(e=>{H(t=>{let r=t.includes(e)?t.filter(t=>t!==e):[...t,e];return localStorage.setItem(n,JSON.stringify(r)),r})},[]),[W,G]=(0,I.useState)(``);(0,I.useEffect)(()=>{let e=()=>{let e=new Date,t=[2,4,6],n=1/0,i=null;for(let r of t){let t=new Date(e);t.setUTCHours(13,0,0,0);let a=(r-e.getUTCDay()+7)%7;a===0&&e.getTime()>=t.getTime()&&(a=7),t.setUTCDate(e.getUTCDate()+a);let o=t.getTime()-e.getTime();o<n&&(n=o,i=t)}if(i){let t=i.getTime()-e.getTime(),n=Math.floor(t/(1e3*60*60)),a=Math.floor(t%(1e3*60*60)/(1e3*60)),o=Math.floor(t%(1e3*60)/1e3);G(r(`common:leaderboard.refreshIn`,{time:`${String(n).padStart(2,`0`)}:${String(a).padStart(2,`0`)}:${String(o).padStart(2,`0`)}`}))}};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[r]);let K=(0,I.useMemo)(()=>[...d].sort((e,t)=>{let n=V.includes(e.server1.serverId)||V.includes(e.server2.serverId),r=V.includes(t.server1.serverId)||V.includes(t.server2.serverId);return n&&!r?-1:!n&&r?1:0}),[d,V]);(0,I.useEffect)(()=>{if(!R)return;let e=setInterval(()=>{F(u(h()))},1e3);return()=>clearInterval(e)},[R]);let q=O(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Neutral.webp`),J=O(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Light.webp`),Y=O(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Dark.webp`),ee=O(`images/Leaderboards/VS.webp`),X=(0,I.useMemo)(()=>{let e=l.filter(e=>e.serverRegion.toLowerCase()===D.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[D,l]),Z=(0,I.useMemo)(()=>{let e,t=!0;return n=>{if(e&&clearTimeout(e),t){T(n),t=!1;return}e=setTimeout(()=>{T(n)},5e3)}},[T]);(0,I.useEffect)(()=>{X&&(w(X),R?Z(X):T(X,A.toDate()))},[X,R,R?null:A,w,Z,T]);let Q=(0,I.useMemo)(()=>{let e={};return C.forEach(t=>{e[t.serverMatchingId]||(e[t.serverMatchingId]={}),t.states.forEach(n=>{e[t.serverMatchingId][n.abyssArtifactId]={state:n.state,recordTime:t.recordTime,contributors:t.contributors||[]}})}),e},[C]),$=(e,t)=>{if(!e||!t)return r(`common:leaderboard.inContention`);let n=new Date(e).getTime(),i=R?Date.now():A.toDate().getTime(),a=n+1728e5-i;if(a<=0){let e=Math.abs(a),t=Math.floor(e/(1e3*60*60)),n=Math.floor(e%(1e3*60*60)/(1e3*60)),i=Math.floor(e%(1e3*60)/1e3);return r(`common:leaderboard.refreshedAgo`,{time:`${String(t).padStart(2,`0`)}:${String(n).padStart(2,`0`)}:${String(i).padStart(2,`0`)}`})}let o=Math.floor(a/(1e3*60*60)),s=Math.floor(a%(1e3*60*60)/(1e3*60)),c=Math.floor(a%(1e3*60)/1e3);return`${String(o).padStart(2,`0`)}:${String(s).padStart(2,`0`)}:${String(c).padStart(2,`0`)}`},{artifactsA:te,artifactsB:ne}=(0,I.useMemo)(()=>({artifactsA:(m[N.ABYSS_A]||[]).sort((e,t)=>e.order-t.order),artifactsB:(m[N.ABYSS_B]||[]).sort((e,t)=>e.order-t.order)}),[m]);return(0,L.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[(0,L.jsx)(_,{className:`bg-transparent shadow-none`,children:(0,L.jsx)(i,{className:`flex flex-col items-start gap-3 px-0`,children:(0,L.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(`p`,{className:`text-[22px] text-default-800`,children:r(`common:leaderboard.realtimeArtifactRatio`)}),W&&(0,L.jsx)(`span`,{className:`text-[16px] font-mono font-bold text-primary`,children:W})]}),(0,L.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,L.jsxs)(p,{size:`sm`,selectedKeys:[D],onSelectionChange:e=>k(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:{trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},popoverProps:{radius:`none`},listboxProps:{itemClasses:{base:`rounded-none`}},children:[(0,L.jsx)(g,{children:r(`common:server.tw`)},`tw`),(0,L.jsx)(g,{children:r(`common:server.kr`)},`kr`)]}),(0,L.jsx)(v,{locale:o.language,children:(0,L.jsxs)(`div`,{className:`relative flex-[2] sm:flex-none sm:w-[280px]`,children:[(0,L.jsx)(S,{className:`w-full`,hideTimeZone:!0,showMonthAndYearPickers:!0,value:A,onChange:e=>{e&&(F(e),B(!1))},classNames:{inputWrapper:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,popoverContent:`rounded-none p-0`,segment:`text-foreground`},granularity:`second`}),!R&&(0,L.jsx)(P,{content:r(`common:leaderboard.resetToNow`,`重置到当前时间`),children:(0,L.jsx)(c,{size:`sm`,variant:`flat`,isIconOnly:!0,className:`absolute right-10 top-1/2 -translate-y-1/2 z-20 h-6 w-6 min-w-0 bg-transparent`,onClick:()=>{B(!0),F(u(h()))},children:(0,L.jsx)(y,{icon:a,className:`text-[12px]`})})})]})})]})]})})}),f||b?(0,L.jsx)(`p`,{className:`text-center py-4`,children:r(`common:ui.loading`)}):K.map(t=>(0,L.jsx)(_,{isPressable:!0,onClick:()=>e({to:`/leaderboard/artifacts/${t.id}`}),className:`bg-character-equipment shadow-none border-1 border-crafting-border p-4 relative group`,children:(0,L.jsx)(s,{className:`p-0`,children:(0,L.jsxs)(`div`,{className:`flex items-stretch justify-between`,children:[(0,L.jsx)(z,{matching:t,server:t.server1,isServer1:!0,artifacts:te,mapName:N.ABYSS_A,artifactStates:C.filter(e=>e.serverMatchingId===t.id&&e.mapName===N.ABYSS_A),artifactStateMap:Q,isAutoUpdate:R,selectedDate:A,starredServerIds:V,toggleStar:U,formatCountdown:$,t:r,icons:{neutral:q,light:J,dark:Y}}),(0,L.jsxs)(`div`,{className:`flex flex-col items-center px-2 h-full`,children:[(0,L.jsx)(`div`,{className:`h-[38px] flex items-center`,children:(0,L.jsx)(`img`,{src:ee,alt:`VS`,className:`w-10 h-10 object-contain`})}),(0,L.jsx)(`div`,{className:`flex-1 flex items-center mt-2`,children:(0,L.jsx)(x,{orientation:`vertical`,className:`h-[60px] sm:h-[80px] bg-default-500`})})]}),(0,L.jsx)(z,{matching:t,server:t.server2,isServer1:!1,artifacts:ne,mapName:N.ABYSS_B,artifactStates:C.filter(e=>e.serverMatchingId===t.id&&e.mapName===N.ABYSS_B),artifactStateMap:Q,isAutoUpdate:R,selectedDate:A,starredServerIds:V,toggleStar:U,formatCountdown:$,t:r,icons:{neutral:q,light:J,dark:Y}})]})})},t.id))]})};function V(){let[e,t]=(0,I.useState)(`ALL`);return(0,L.jsx)(`div`,{className:`h-full overflow-y-auto flex flex-col bg-leaderboard-page`,children:k().pathname.includes(`/artifacts/`)?(0,L.jsx)(A,{}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(`div`,{className:`flex-1 flex flex-col items-center p-4`,children:(0,L.jsx)(`div`,{className:`w-full max-w-[1074px] flex flex-col gap-4`,children:(0,L.jsxs)(`div`,{className:`flex flex-col-reverse lg:flex-row justify-center gap-4 lg:gap-8`,children:[(0,L.jsx)(`div`,{className:`w-full lg:w-[428px] flex flex-col gap-4`,children:(0,L.jsx)(R,{mapName:e,setMapName:t})}),(0,L.jsx)(`div`,{className:`w-full lg:w-[632px] flex flex-col gap-4`,children:(0,L.jsx)(B,{})})]})})}),(0,L.jsx)(F,{})]})})}export{V as component};