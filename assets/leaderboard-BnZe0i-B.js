import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-DuJeymUe.js";import{t as r}from"./Trans-Bx9ClNCQ.js";import{$ as i,$t as a,Jt as o,Qt as s,St as c,Yt as l,Z as u,Zt as d,_t as f,bt as p,cn as m,ct as h,dt as g,mt as _,nn as v,nt as y,on as b,pt as x,rt as S,sn as C,t as w,vt as T,xt as E,yt as D}from"./vendor-ui-y3Fdaxop.js";import{S as O,a as k,b as A,d as j,f as M,o as N,p as P,s as F}from"./index-CS2UYiuE.js";import{t as I}from"./AdaptiveTooltip-DU_o6Pnh.js";import{t as L}from"./Footer-DayQ8meK.js";var R=e(t(),1),z=e(n(),1),B=({mapName:e,setMapName:t})=>{let{t:n}=O(),{seasons:r,artifactCounts:i,fetchArtifactCounts:s,loadingArtifactCounts:u,serverMatchings:m,loadingMatchings:h,region:g,setRegion:v}=N(),y={trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},b={itemClasses:{base:`rounded-none`}},S=(0,R.useMemo)(()=>{let e=r.filter(e=>e.serverRegion.toLowerCase()===g.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[r,g]);(0,R.useEffect)(()=>{S&&s(S,e)},[S,e,s]);let C=(0,R.useMemo)(()=>{let e=[...i].sort((e,t)=>t.artifactCount-e.artifactCount||e.serverId-t.serverId),t=[],n=-1,r=0;for(let i=0;i<e.length;i++){let a=e[i];a.artifactCount!==n&&(r=i+1,n=a.artifactCount),t.push({...a,rank:r})}return t},[i]),w=e=>{let t=m.find(t=>t.server1.serverId===e||t.server2.serverId===e);if(t){let r=t.server1.serverId===e?t.server1:t.server2,i=r.raceId===1?n(`common:server.lightAbbr`):n(`common:server.darkAbbr`),a=r.serverId%1e3;return`${r.serverName}（${i}${a}）`}let r=n(e<2e3?`common:server.lightAbbr`:`common:server.darkAbbr`),i=e%1e3;return`${n(`common:server.server`)}（${r}${i}）`};return(0,z.jsxs)(o,{className:`bg-transparent shadow-none`,children:[(0,z.jsx)(l,{className:`flex flex-col items-start gap-3 px-0`,children:(0,z.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,z.jsx)(`p`,{className:`text-[22px] text-default-800`,children:n(`common:leaderboard.artifactRegionRanking`)}),(0,z.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,z.jsxs)(x,{size:`sm`,selectedKeys:[g],onSelectionChange:e=>v(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:y,popoverProps:{radius:`none`},listboxProps:b,children:[(0,z.jsx)(_,{children:n(`common:server.tw`)},`tw`),(0,z.jsx)(_,{children:n(`common:server.kr`)},`kr`)]}),(0,z.jsxs)(x,{size:`sm`,selectedKeys:[e],onSelectionChange:e=>t(Array.from(e)[0]),className:`min-w-[150px] flex-[2] sm:flex-none sm:w-[200px]`,disallowEmptySelection:!0,classNames:y,popoverProps:{radius:`none`},listboxProps:b,children:[(0,z.jsx)(_,{children:n(`common:leaderboard.allMaps`,`全部地图`)},`ALL`),(0,z.jsx)(_,{children:n(`maps:${F.ABYSS_A}.description`)},F.ABYSS_A),(0,z.jsx)(_,{children:n(`maps:${F.ABYSS_B}.description`)},F.ABYSS_B)]})]})]})}),(0,z.jsx)(d,{className:`px-0`,children:u||h||m.length===0?(0,z.jsx)(`div`,{className:`flex justify-center items-center py-10`,children:(0,z.jsx)(a,{})}):(0,z.jsxs)(c,{"aria-label":`Artifact Region Ranking`,removeWrapper:!0,className:`min-w-full`,classNames:{table:`border-separate border-spacing-y-[10px] -mt-[10px]`,thead:`[&>tr]:first:shadow-none`,th:`bg-transparent text-foreground font-bold text-[16px] h-auto py-0`,td:`bg-character-equipment h-[44px] text-[16px] font-normal text-default-800 border-y-1 border-crafting-border first:border-l-1 last:border-r-1 first:rounded-l-md last:rounded-r-md`},children:[(0,z.jsxs)(p,{children:[(0,z.jsx)(E,{children:n(`common:leaderboard.rank`)}),(0,z.jsx)(E,{children:n(`common:server.server`)}),(0,z.jsx)(E,{align:`center`,children:n(`common:leaderboard.artifactCount`)})]}),(0,z.jsx)(T,{emptyContent:n(`common:ui.noData`),items:C,children:e=>(0,z.jsxs)(D,{children:[(0,z.jsx)(f,{children:(0,z.jsx)(`div`,{className:`flex items-center justify-center w-6 h-6`,children:e.rank})}),(0,z.jsx)(f,{children:(0,z.jsx)(`span`,{children:w(e.serverId)})}),(0,z.jsx)(f,{align:`center`,children:(0,z.jsx)(`span`,{children:e.artifactCount})})]},e.serverId)})]})})]})},V=({matching:e,server:t,isServer1:n,artifacts:a,mapName:o,artifactStates:c,artifactStateMap:l,isAutoUpdate:u,selectedDate:d,starredServerIds:f,toggleStar:p,formatCountdown:m,t:g,icons:_})=>{let v=f.includes(t.serverId),b=g(n?`common:server.lightAbbr`:`common:server.darkAbbr`),x=n?`linear-gradient(135deg, #DBEDFF 0%, #F3FBFF 100%)`:`linear-gradient(225deg, #EFE5FF 0%, #F3FBFF 100%)`,C=n?`#1D3557`:`#4B0082`;return(0,z.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,z.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:x},children:[(0,z.jsx)(s,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute ${n?`left-1`:`right-1`} z-10 text-default-400 hover:text-star data-[starred=true]:text-star`,"data-starred":v,onClick:e=>{e.stopPropagation(),p(t.serverId)},children:(0,z.jsx)(h,{icon:v?i:w,className:`text-[16px]`})}),(0,z.jsx)(`span`,{className:`text-lg font-bold`,style:{color:C},children:t.serverName}),(0,z.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（`,b,t.serverId%1e3,`）`]})]}),(0,z.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,z.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:g(`maps:${o}.description`)}),(0,z.jsx)(`div`,{className:`flex gap-1`,children:a.map(t=>{let n=g(`markers/${o}:${t.markerId}.name`,t.marker.name),r=l[e.id]?.[t.id],i=r?.state,a=!!(r?.contributors&&r.contributors.length>0),s=!1;if(r?.recordTime&&a){let e=new Date(r.recordTime).getTime(),t=u?Date.now():d.toDate().getTime();e+1728e5-t<=0&&(s=!0)}else s=!0;let c=_.neutral;return s||(i===1?c=_.light:i===2&&(c=_.dark)),(0,z.jsx)(I,{content:n,children:(0,z.jsx)(`img`,{src:c,alt:n,className:`w-7 h-7 sm:w-12 sm:h-12`})},t.id)})})]}),(0,z.jsx)(`div`,{className:`text-[20px] text-default-800 font-mono text-center`,children:(()=>{let e=c[0],t=!!(e?.contributors&&e.contributors.length>0);return m(e?.recordTime,t)})()}),(0,z.jsx)(`div`,{className:`w-full mt-1 min-h-[18px]`,children:(()=>{let e=c[0],t=!!(e?.contributors&&e.contributors.length>0),n=!1;if(e?.recordTime&&t){let t=new Date(e.recordTime).getTime(),r=u?Date.now():d.toDate().getTime();t+1728e5-r<=0&&(n=!0)}else n=!0;return n?(0,z.jsx)(`div`,{className:`flex justify-center w-full`,children:(0,z.jsx)(`span`,{className:`text-primary hover:underline text-sm font-bold cursor-pointer`,children:g(`common:leaderboard.submitData`)})}):t?(0,z.jsxs)(`div`,{className:`flex items-center justify-between w-full`,onClick:e=>e.stopPropagation(),children:[(0,z.jsx)(`span`,{className:`text-[12px] text-default-800`,children:(0,z.jsx)(r,{t:g,i18nKey:`common:leaderboard.providedBy`,values:{username:e.contributors[0].user.name},components:{emph:(0,z.jsx)(`span`,{className:`text-primary font-medium`})}})}),(0,z.jsxs)(`div`,{className:`flex gap-2 text-default-400`,children:[(0,z.jsx)(h,{icon:S,className:`cursor-pointer hover:text-primary transition-colors`}),(0,z.jsx)(h,{icon:y,className:`cursor-pointer hover:text-danger transition-colors`})]})]}):null})()})]})]})},H=()=>{let e=P(),t=[F.ABYSS_A,F.ABYSS_B],n=`starred_artifact_servers`,{t:r,i18n:i}=O([...t.map(e=>`markers/${e}`),`common`]),{seasons:a,serverMatchings:c,loadingMatchings:f,artifactsByMap:p,loadingArtifacts:y,artifactStates:S,fetchServerMatchings:w,fetchArtifactStates:T,region:E,setRegion:D}=N(),[k,j]=(0,R.useState)(b(C())),[M,L]=(0,R.useState)(!0),[B,H]=(0,R.useState)(()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]}),U=(0,R.useCallback)(e=>{H(t=>{let r=t.includes(e)?t.filter(t=>t!==e):[...t,e];return localStorage.setItem(n,JSON.stringify(r)),r})},[]),W=(0,R.useMemo)(()=>[...c].sort((e,t)=>{let n=B.includes(e.server1.serverId)||B.includes(e.server2.serverId),r=B.includes(t.server1.serverId)||B.includes(t.server2.serverId);return n&&!r?-1:!n&&r?1:0}),[c,B]);(0,R.useEffect)(()=>{if(!M)return;let e=setInterval(()=>{j(b(C()))},1e3);return()=>clearInterval(e)},[M]);let G=A(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Neutral.webp`),K=A(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Light.webp`),q=A(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Dark.webp`),J=A(`images/Leaderboards/VS.webp`),Y=(0,R.useMemo)(()=>{let e=a.filter(e=>e.serverRegion.toLowerCase()===E.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[E,a]),X=(0,R.useMemo)(()=>{let e,t=!0;return n=>{if(e&&clearTimeout(e),t){T(n),t=!1;return}e=setTimeout(()=>{T(n)},5e3)}},[T]);(0,R.useEffect)(()=>{Y&&(w(Y),M?X(Y):T(Y,k.toDate()))},[Y,M,M?null:k,w,X,T]);let Z=(0,R.useMemo)(()=>{let e={};return S.forEach(t=>{e[t.serverMatchingId]||(e[t.serverMatchingId]={}),t.states.forEach(n=>{e[t.serverMatchingId][n.abyssArtifactId]={state:n.state,recordTime:t.recordTime,contributors:t.contributors||[]}})}),e},[S]),Q=(e,t)=>{if(!e||!t)return r(`common:leaderboard.inContention`);let n=new Date(e).getTime(),i=M?Date.now():k.toDate().getTime(),a=n+1728e5-i;if(a<=0){let e=Math.abs(a),t=Math.floor(e/(1e3*60*60)),n=Math.floor(e%(1e3*60*60)/(1e3*60)),i=Math.floor(e%(1e3*60)/1e3);return r(`common:leaderboard.refreshedAgo`,{time:`${String(t).padStart(2,`0`)}:${String(n).padStart(2,`0`)}:${String(i).padStart(2,`0`)}`})}let o=Math.floor(a/(1e3*60*60)),s=Math.floor(a%(1e3*60*60)/(1e3*60)),c=Math.floor(a%(1e3*60)/1e3);return`${String(o).padStart(2,`0`)}:${String(s).padStart(2,`0`)}:${String(c).padStart(2,`0`)}`},{artifactsA:$,artifactsB:ee}=(0,R.useMemo)(()=>({artifactsA:(p[F.ABYSS_A]||[]).sort((e,t)=>e.order-t.order),artifactsB:(p[F.ABYSS_B]||[]).sort((e,t)=>e.order-t.order)}),[p]);return(0,z.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[(0,z.jsx)(o,{className:`bg-transparent shadow-none`,children:(0,z.jsx)(l,{className:`flex flex-col items-start gap-3 px-0`,children:(0,z.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,z.jsx)(`p`,{className:`text-[22px] text-default-800`,children:r(`common:leaderboard.realtimeArtifactRatio`)}),(0,z.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,z.jsxs)(x,{size:`sm`,selectedKeys:[E],onSelectionChange:e=>D(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:{trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},popoverProps:{radius:`none`},listboxProps:{itemClasses:{base:`rounded-none`}},children:[(0,z.jsx)(_,{children:r(`common:server.tw`)},`tw`),(0,z.jsx)(_,{children:r(`common:server.kr`)},`kr`)]}),(0,z.jsx)(m,{locale:i.language,children:(0,z.jsxs)(`div`,{className:`relative flex-[2] sm:flex-none sm:w-[280px]`,children:[(0,z.jsx)(g,{className:`w-full`,hideTimeZone:!0,showMonthAndYearPickers:!0,value:k,onChange:e=>{e&&(j(e),L(!1))},classNames:{inputWrapper:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,popoverContent:`rounded-none p-0`,segment:`text-foreground`},granularity:`second`}),!M&&(0,z.jsx)(I,{content:r(`common:leaderboard.resetToNow`,`重置到当前时间`),children:(0,z.jsx)(s,{size:`sm`,variant:`flat`,isIconOnly:!0,className:`absolute right-10 top-1/2 -translate-y-1/2 z-20 h-6 w-6 min-w-0 bg-transparent`,onClick:()=>{L(!0),j(b(C()))},children:(0,z.jsx)(h,{icon:u,className:`text-[12px]`})})})]})})]})]})})}),f||y?(0,z.jsx)(`p`,{className:`text-center py-4`,children:r(`common:ui.loading`)}):W.map(t=>(0,z.jsx)(o,{isPressable:!0,onClick:()=>e({to:`/leaderboard/artifacts/${t.id}`}),className:`bg-character-equipment shadow-none border-1 border-crafting-border p-4 relative group`,children:(0,z.jsx)(d,{className:`p-0`,children:(0,z.jsxs)(`div`,{className:`flex items-stretch justify-between`,children:[(0,z.jsx)(V,{matching:t,server:t.server1,isServer1:!0,artifacts:$,mapName:F.ABYSS_A,artifactStates:S.filter(e=>e.serverMatchingId===t.id&&e.mapName===F.ABYSS_A),artifactStateMap:Z,isAutoUpdate:M,selectedDate:k,starredServerIds:B,toggleStar:U,formatCountdown:Q,t:r,icons:{neutral:G,light:K,dark:q}}),(0,z.jsxs)(`div`,{className:`flex flex-col items-center px-2 h-full`,children:[(0,z.jsx)(`div`,{className:`h-[38px] flex items-center`,children:(0,z.jsx)(`img`,{src:J,alt:`VS`,className:`w-10 h-10 object-contain`})}),(0,z.jsx)(`div`,{className:`flex-1 flex items-center mt-2`,children:(0,z.jsx)(v,{orientation:`vertical`,className:`h-[60px] sm:h-[80px] bg-default-500`})})]}),(0,z.jsx)(V,{matching:t,server:t.server2,isServer1:!1,artifacts:ee,mapName:F.ABYSS_B,artifactStates:S.filter(e=>e.serverMatchingId===t.id&&e.mapName===F.ABYSS_B),artifactStateMap:Z,isAutoUpdate:M,selectedDate:k,starredServerIds:B,toggleStar:U,formatCountdown:Q,t:r,icons:{neutral:G,light:K,dark:q}})]})})},t.id))]})};function U(){let[e,t]=(0,R.useState)(`ALL`);return(0,z.jsx)(`div`,{className:`h-full overflow-y-auto flex flex-col bg-leaderboard-page`,children:j().pathname.includes(`/artifacts/`)?(0,z.jsx)(M,{}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(`div`,{className:`flex-1 flex flex-col items-center p-4`,children:(0,z.jsx)(`div`,{className:`w-full max-w-[1074px] flex flex-col gap-4`,children:(0,z.jsxs)(`div`,{className:`flex flex-col-reverse lg:flex-row justify-center gap-4 lg:gap-8`,children:[(0,z.jsx)(`div`,{className:`w-full lg:w-[428px] flex flex-col gap-4`,children:(0,z.jsx)(B,{mapName:e,setMapName:t})}),(0,z.jsx)(`div`,{className:`w-full lg:w-[632px] flex flex-col gap-4`,children:(0,z.jsx)(H,{})})]})})}),(0,z.jsx)(L,{})]})})}export{U as component};