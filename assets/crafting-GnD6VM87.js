import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-DsgQe5QS.js";import{$t as r,Ft as i,I as a,J as o,Mt as s,Nt as c,Pt as l,Qt as u,V as d,X as f,Yt as p,at as m,ct as h,gt as g,ht as _,j as v,jt as y,k as b,lt as x,tt as S}from"./vendor-ui-D25gIF8s.js";import{S as C,b as w,u as T}from"./index-Lg0f6AvS.js";import{n as E,t as D}from"./ItemDataContext-DMJ8GpU1.js";import{t as O}from"./Footer-X70E9Lr7.js";var k=e(t(),1),A=e(n(),1);function j(...e){for(let t of e)if(t&&t.trim().length>0)return t;return``}const M=({slot:e,selectedItem:t,count:n,mode:r,gradeName:i,onSlotClick:a,onBumpCount:s})=>{let{t:c}=C(),l=t?.id,u=w(j(t?.icon,e.icon)),d=c(`items/types:subtypes.${e.name}.name`,e.name),p=t?c(`items/items:${t.id}.name`,String(t.id)):d,m=(0,A.jsx)(`div`,{className:`pointer-events-none flex items-center justify-center`,children:(0,A.jsxs)(`div`,{className:`pointer-events-auto flex items-center gap-2 rounded-sm bg-black/40 px-1`,children:[(0,A.jsx)(`button`,{type:`button`,onClick:e=>{e.preventDefault(),e.stopPropagation(),s(-1)},disabled:!l||n<=0,className:[`flex h-[16px] w-[16px] items-center justify-center rounded-sm`,!l||n<=0?`opacity-40`:`hover:bg-black/30`].join(` `),title:c(`common:crafting.minus`,`Minus`),children:(0,A.jsx)(h,{icon:o,className:`text-[10px] text-white`})}),(0,A.jsx)(`div`,{className:`min-w-[18px] text-center text-[12px] font-bold leading-[12px] text-white`,children:l?String(Math.max(0,n)):`0`}),(0,A.jsx)(`button`,{type:`button`,onClick:e=>{e.preventDefault(),e.stopPropagation(),s(1)},disabled:!l,className:[`flex h-[16px] w-[16px] items-center justify-center rounded-sm`,l?`hover:bg-black/30`:`opacity-40`].join(` `),title:c(`common:crafting.plus`,`Plus`),children:(0,A.jsx)(h,{icon:f,className:`text-[10px] text-white`})})]})});return r===`thumbnail`?(0,A.jsxs)(`button`,{type:`button`,onClick:a,className:`relative h-12 w-[89px] rounded-sm bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${w(`UI/Resource/Texture/ETC/UT_SlotGrade_${i}.webp`)})`,backgroundSize:`100% 100%`},title:d,children:[(0,A.jsx)(`div`,{className:`flex h-full w-full items-center justify-center rounded-sm ${l?``:`bg-[#0D0E15]`}`,children:(0,A.jsx)(`img`,{src:u,alt:e.name,className:`h-full w-full object-contain`})}),(0,A.jsx)(`div`,{className:`pointer-events-none absolute inset-x-1 top-[2px] z-20`,children:(0,A.jsx)(`div`,{className:`truncate text-center text-[12px] font-bold leading-[12px] text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.35)]`,children:d})}),t&&(0,A.jsx)(`div`,{className:`pointer-events-none absolute inset-x-0 bottom-[2px] z-20 flex justify-center`,children:m})]}):(0,A.jsx)(`button`,{type:`button`,onClick:a,className:`relative h-[56px] w-[188px] rounded-sm bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${w(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${i}.webp`)})`,backgroundSize:`100% 100%`},title:p,children:(0,A.jsxs)(`div`,{className:`flex h-full w-full items-center rounded-sm px-2 ${l?``:`bg-[#0D0E15]`}`,children:[(0,A.jsx)(`img`,{src:u,alt:e.name,className:`h-12 w-12 shrink-0 object-contain`}),(0,A.jsxs)(`div`,{className:`ml-2 flex h-[48px] min-w-0 flex-1 flex-col justify-center`,children:[(0,A.jsx)(`div`,{className:`truncate text-left text-[13px] font-bold leading-[13px] text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.35)]`,children:p}),t&&(0,A.jsx)(`div`,{className:`mt-1 flex items-center`,children:m})]})]})})},N=({isOpen:e,onOpenChange:t,activeSlot:n,activeType:a,setActiveType:o,allowedTypes:u,filteredItems:d,gradesByName:f,onSelectItem:p,onClearSlot:m})=>{let{t:h}=C();return(0,A.jsx)(y,{isOpen:e,onOpenChange:t,size:`5xl`,children:(0,A.jsx)(l,{className:`w-fit max-w-none`,children:e=>(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(s,{className:`flex flex-col gap-2`,children:[(0,A.jsx)(`div`,{children:h(`common:crafting.select`,`Select item`)}),n&&u.length>0?(0,A.jsx)(g,{selectedKey:a,onSelectionChange:e=>o(String(e)),variant:`underlined`,classNames:{tabList:`gap-2`,cursor:`bg-default-800`,tab:`h-8`},children:u.map(e=>(0,A.jsx)(_,{title:h(`items/types:subtypes.${e}.name`,e)},e))}):null]}),(0,A.jsx)(i,{children:n?(0,A.jsx)(`div`,{className:`flex flex-col gap-3`,children:(0,A.jsx)(`div`,{className:`max-h-[560px] overflow-y-auto`,children:(0,A.jsxs)(`div`,{className:`grid grid-cols-3 gap-5`,children:[d.map(e=>{let t=h(`items/items:${e.id}.name`,e.subtype);return(0,A.jsxs)(`button`,{type:`button`,onClick:()=>p(n.key,e.id),className:`flex items-center rounded-sm border-2 border-default bg-contain bg-center bg-no-repeat`,style:{backgroundImage:`url(${w(`UI/Resource/Texture/ETC/UT_ItemTooltipGrade_${f.get(e.grade)?.name}.webp`)})`,backgroundSize:`100% 100%`},title:`${e.id} (${e.subtype})`,children:[(0,A.jsx)(`img`,{src:w(e.icon),alt:String(e.id),className:`h-16 w-16 object-contain`}),(0,A.jsx)(`div`,{className:`flex h-16 w-[160px] items-center px-2 text-left text-[14px] font-bold text-white [text-shadow:0px_2px_4px_rgba(0,0,0,0.3)]`,children:t})]},e.id)}),d.length===0&&(0,A.jsx)(`div`,{className:`col-span-3 text-sm text-default-500`,children:`No craftable items match this slotâ€™s allowed types.`})]})})}):(0,A.jsx)(`div`,{className:`text-sm text-default-500`,children:`No slot selected.`})}),(0,A.jsxs)(c,{children:[n?(0,A.jsx)(r,{variant:`flat`,color:`danger`,onPress:()=>m(n.key),children:h(`common:ui.clear`)}):null,(0,A.jsx)(r,{variant:`flat`,onPress:e,children:h(`common:ui.close`)})]})]})})})};function P(e){let t=e?.itemId,n=e?.count;return{itemId:typeof t==`number`||t===null?t:null,count:typeof n==`number`&&Number.isFinite(n)?n:0}}function ee(e){return!Number.isFinite(e)||e<0?0:e>99?99:Math.floor(e)}function te(e,t){return!t||e==null?!0:e===t}function F({selectedBySlotKey:e,setSelectedBySlotKey:t,race:n}){let[i,a]=(0,k.useState)(!1),[o,s]=(0,k.useState)(null),[c,l]=(0,k.useState)(``),[u,d]=(0,k.useState)(`thumbnail`),{craftingItemIdsByType:f,craftingById:p,slots:v,items:y,gradesByName:b}=E(),{t:x}=C(),w=(0,k.useMemo)(()=>o?v.find(e=>e.key===o)??null:null,[o,v]),T=(0,k.useMemo)(()=>w?.allowed_types??[],[w]);(0,k.useEffect)(()=>{if(!i)return;let e=T[0]??``;(!c||e&&!T.includes(c))&&l(e)},[i,T,c]);let D=(0,k.useMemo)(()=>c?(f.get(c)??[]).filter(e=>te(p.get(e)?.race??null,n)):[],[c,f,p,n]),O=(0,k.useMemo)(()=>{if(!w||!c)return[];let e=new Set(D);return y.filter(t=>t.subtype===c&&e.has(t.id))},[w,c,y,D]);function j(e){s(e),a(!0)}function F(e,n){t(t=>{let r=P(t[e]),i=r.count>0?r.count:1;return{...t,[e]:{...r,itemId:n,count:i}}}),a(!1)}function I(e){t(t=>{let n=P(t[e]);return{...t,[e]:{...n,itemId:null,count:0}}}),a(!1)}function L(){t(e=>{let t={};for(let n of v){let r=P(e[n.key]);t[n.key]={...r,itemId:null,count:0}}return t})}function R(e,n){t(t=>{let r=P(t[e]);if(!r.itemId)return t;let i=ee(r.count+n);return{...t,[e]:{...r,count:i}}})}let z=[];z=u===`thumbnail`?v:u===`weapon_armor`?v.slice(0,10):v.slice(10,20);let B=u===`thumbnail`?`grid grid-cols-2 gap-2`:`grid grid-cols-1 gap-2`;return(0,A.jsxs)(`div`,{className:`flex h-full w-full flex-col`,children:[(0,A.jsx)(`div`,{className:`my-3 h-[38px] text-center text-[22px] font-bold text-default-900`,children:x(`common:crafting.selectClick`,`Click to select equipment`)}),(0,A.jsx)(`div`,{className:`flex-1 overflow-y-auto no-scrollbar`,children:(0,A.jsx)(`div`,{className:`flex w-full justify-center `,children:(0,A.jsx)(`div`,{className:B,children:z.map(t=>{let n=P(e[t.key]),r=n.itemId?y.find(e=>e.id===n.itemId):void 0,i=b.get(r?.grade||``);return(0,A.jsx)(M,{slot:t,selectedItem:r,count:n.count,mode:u,gradeName:i?.name||``,onSlotClick:()=>t.craftable&&j(t.key),onBumpCount:e=>R(t.key,e)},t.key)})})})}),(0,A.jsx)(`div`,{className:`mt-2 w-full`,children:(0,A.jsx)(r,{size:`sm`,variant:`flat`,onPress:L,className:`h-[34px] w-full rounded-sm border-1 border-crafting-border bg-crafting-sum`,children:(0,A.jsxs)(`span`,{className:`flex w-full items-center justify-center gap-2 text-[14px] text-default-800`,children:[(0,A.jsx)(h,{icon:m}),x(`common:crafting.clearAll`,`Clear all slots`)]})})}),(0,A.jsx)(`div`,{className:`mt-2`,children:(0,A.jsxs)(g,{selectedKey:u,onSelectionChange:e=>d(e),variant:`light`,className:`w-full rounded-sm border-1 border-crafting-border bg-crafting-sum`,classNames:{tabList:`w-full flex gap-0`,tab:`h-[30px] flex-1 justify-center data-[selected=true]:bg-primary dark:data-[selected=true]:bg-default-800`,tabContent:`flex items-center justify-center text-default-800 group-data-[selected=true]:text-background`},children:[(0,A.jsx)(_,{title:(0,A.jsx)(h,{icon:S})},`thumbnail`),(0,A.jsx)(_,{title:x(`common:crafting.weaponOrArmor`,`Weapon / Armor`)},`weapon_armor`),(0,A.jsx)(_,{title:x(`common:crafting.accessory`,`Accessory`)},`accessory`)]})}),(0,A.jsx)(N,{isOpen:i,onOpenChange:e=>a(e),activeSlot:w,activeType:c,setActiveType:l,allowedTypes:T,filteredItems:O,gradesByName:b,onSelectItem:F,onClearSlot:I})]})}function I(e){return typeof e!=`number`||!Number.isFinite(e)?0:Math.max(0,Math.floor(e))}const L=({row:e,name:t,icon:n,unitPriceStr:r,gradeName:i,ownedCount:a,onPriceChange:s,onOwnedChange:c,onIncOwned:l,onDecOwned:u,priceByMaterialId:d,ownedByMaterialId:p,depth:m=0})=>{let{t:g}=C(),{itemsById:_,gradesByName:y}=E(),[S,T]=k.useState(!1),D=w(`UI/Resource/Texture/ETC/UT_SlotGrade_${i}.webp`);function O(e){let t=p[e];if(t==null||t===``)return 0;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}let j=!!e.children&&e.children.length>0;return(0,A.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[(0,A.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-lg border border-default-200 bg-crafting-item p-2 ${m>0?`ml-4`:``}`,children:[(0,A.jsxs)(`div`,{className:`flex items-center gap-1 min-w-0`,children:[j&&(0,A.jsx)(`button`,{type:`button`,onClick:()=>T(!S),className:`flex h-4 w-4 items-center justify-center text-default-500 hover:text-default-800`,children:(0,A.jsx)(h,{icon:S?b:v,className:`text-[10px]`})}),(0,A.jsx)(`div`,{className:`truncate text-sm font-semibold text-default-900`,children:t})]}),(0,A.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,A.jsx)(`div`,{className:`flex h-12 w-12 items-center justify-center rounded-sm bg-contain bg-center bg-no-repeat shrink-0`,style:{backgroundImage:`url(${D})`},children:n?(0,A.jsx)(`img`,{src:n,alt:t,className:`h-12 w-12 object-contain`}):(0,A.jsx)(`div`,{className:`text-xs text-default-500`,children:e.id})}),(0,A.jsxs)(`div`,{className:`flex min-w-0 flex-1 flex-col gap-2`,children:[(0,A.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,A.jsx)(`div`,{role:`button`,tabIndex:0,className:`flex h-4 w-4 cursor-pointer items-center justify-center rounded-full bg-primary dark:bg-secondary hover:opacity-80`,onClick:()=>u(e),onKeyDown:t=>{(t.key===`Enter`||t.key===` `)&&u(e)},title:`-`,children:(0,A.jsx)(h,{icon:o,className:`text-[10px] text-white`})}),(0,A.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,A.jsx)(`span`,{className:`inline-flex align-middle -translate-y-[1px]`,style:{width:`${Math.max(3,String(a).length)}ch`},children:(0,A.jsx)(x,{size:`sm`,hideStepper:!0,value:a,onValueChange:t=>c(e.id,I(t??0)),radius:`none`,classNames:{base:`w-full`,inputWrapper:`w-full bg-transparent border-0 shadow-none px-0 h-[20px] min-h-[20px] group-data-[hover=true]:bg-transparent group-data-[focus=true]:bg-transparent focus-within:shadow-none`,input:`w-full h-[20px] text-[14px] leading-[20px] text-center p-0 text-default-900 bg-transparent`}})}),(0,A.jsxs)(`div`,{className:`text-sm font-semibold text-default-900`,children:[`/ `,e.count]})]}),(0,A.jsx)(`div`,{role:`button`,tabIndex:0,className:`flex h-4 w-4 cursor-pointer items-center justify-center rounded-full bg-primary dark:bg-secondary hover:opacity-80`,onClick:()=>l(e),onKeyDown:t=>{(t.key===`Enter`||t.key===` `)&&l(e)},title:`+`,children:(0,A.jsx)(h,{icon:f,className:`text-[10px] text-white`})})]}),(0,A.jsx)(x,{size:`sm`,placeholder:g(`common:crafting.unitPrice`,`Unit price`),value:r===``?void 0:Number(r),onValueChange:t=>s(e.id,t==null?``:String(t)),radius:`sm`,hideStepper:!0,classNames:{base:`w-full`,inputWrapper:`group-data-[hover=true]:!bg-search-item group-data-[focus=true]:!bg-search-item group-data-[focus-visible=true]:!bg-search-item group-data-[invalid=true]:!bg-search-item h-[28px] min-h-[28px] px-2 border border-crafting-border shadow-none focus-within:shadow-none`,input:`h-[28px] text-[14px] leading-[28px]`}})]})]})]}),j&&S&&(0,A.jsx)(`div`,{className:`flex flex-col gap-2 mt-1`,children:e.children.map(e=>{let t=_.get(e.id),n=g(`items/items:${e.id}.name`,String(e.id)),r=t?.icon?w(t.icon):``,i=d[e.id]??``,a=y.get(t?.grade||``),o=O(e.id);return(0,A.jsx)(L,{row:e,item:t,name:n,icon:r,unitPriceStr:i,gradeName:a?.name||``,ownedCount:o,onPriceChange:s,onOwnedChange:c,onIncOwned:l,onDecOwned:u,priceByMaterialId:d,ownedByMaterialId:p,depth:m+1},e.id)})})]})},R=({label:e,value:t,className:n=``})=>(0,A.jsx)(`div`,{className:`relative h-[38px] rounded-lg border border-primary dark:border-crafting-border bg-crafting-sum ${n}`,children:(0,A.jsx)(`div`,{className:`absolute inset-0 flex items-center justify-center`,children:(0,A.jsxs)(`div`,{className:`flex items-center gap-2 text-[16px] font-bold text-primary dark:text-default-800`,children:[(0,A.jsx)(h,{icon:a,className:`text-sm`}),e,t.toLocaleString()]})})}),z=({typeName:e,rows:t,itemsById:n,gradesByName:r,priceByMaterialId:i,ownedByMaterialId:a,onPriceChange:o,onOwnedChange:s,onIncOwned:c,onDecOwned:l,sum:u,sumLabel:d})=>{let{t:f}=C();function p(e){let t=a[e];if(t==null||t===``)return 0;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}return(0,A.jsxs)(`div`,{className:`flex h-full min-h-0 flex-col rounded-lg border border-crafting-border bg-transparent`,children:[(0,A.jsx)(`div`,{className:`m-2 flex h-[38px] items-center justify-center border-b border-crafting-border px-3 py-2`,children:(0,A.jsx)(`div`,{className:`text-[16px] font-bold leading-[16px] text-default-900`,children:e})}),(0,A.jsx)(`div`,{className:`flex-1 overflow-y-auto no-scrollbar p-3`,children:(0,A.jsx)(`div`,{className:`flex flex-col gap-2`,children:t.length===0?(0,A.jsx)(`div`,{className:`text-xs text-default-500`,children:`No materials`}):t.map(e=>{let t=n.get(e.id),u=f(`items/items:${e.id}.name`,String(e.id)),d=t?.icon?w(t.icon):``,m=i[e.id]??``,h=r.get(t?.grade||``),g=p(e.id);return(0,A.jsx)(L,{row:e,item:t,name:u,icon:d,unitPriceStr:m,gradeName:h?.name||``,ownedCount:g,onPriceChange:o,onOwnedChange:s,onIncOwned:c,onDecOwned:l,priceByMaterialId:i,ownedByMaterialId:a},e.id)})})}),(0,A.jsx)(`div`,{className:`m-2`,children:(0,A.jsx)(R,{label:d,value:u})})]})};function B(e){let t=Number(e);return Number.isFinite(t)?t:0}function V(e){return typeof e!=`number`||!Number.isFinite(e)?0:Math.max(0,Math.floor(e))}var H=`aion2.crafting.prices.v1`,U=`aion2.crafting.materialOwned.v1`,W=[`Equipment`,`CraftResource`,`GatherResource`];function G(e){return e===`CraftResource`?`CraftResource`:e===`GatherResource`?`GatherResource`:`Equipment`}function K({selectedBySlotKey:e}){let{craftingById:t,itemsById:n,gradesByName:r}=E(),{t:i}=C(),[a,o]=(0,k.useState)(()=>{try{let e=localStorage.getItem(H);return e?JSON.parse(e):{}}catch{return{}}});(0,k.useEffect)(()=>{localStorage.setItem(H,JSON.stringify(a))},[a]);let[s,c]=(0,k.useState)(()=>{try{let e=localStorage.getItem(U);return e?JSON.parse(e):{}}catch{return{}}});(0,k.useEffect)(()=>{localStorage.setItem(U,JSON.stringify(s))},[s]);let l=(0,k.useMemo)(()=>{let n=new Map;function r(e,i,a=0){let o=t.get(e);if(!o||!o.materials)return;let s=[];for(let e of o.materials){let t=V(e.count??0);if(t<=0)continue;let o=t*i;if(a===0){let t=n.get(e.id)??0;n.set(e.id,t+o)}let c={id:e.id,count:o,children:r(e.id,o,a+1)};s.push(c)}return s.length>0?s:void 0}let i=[];for(let a of Object.values(e)){if(!a)continue;let e=a.itemId??null;if(!e)continue;let o=V(a.count);if(o<=0)continue;let s=t.get(e);if(s)for(let e of s.materials??[]){let t=V(e.count??0);if(t<=0)continue;let a=t*o,s=n.get(e.id)??0;n.set(e.id,s+a),i.push({id:e.id,count:a,children:r(e.id,a,1)})}}let a=new Map;for(let n of Object.values(e)){if(!n)continue;let e=n.itemId??null;if(!e)continue;let i=V(n.count);if(i<=0)continue;let o=t.get(e);if(o)for(let e of o.materials??[]){let t=V(e.count??0);if(t<=0)continue;let n=t*i,o=a.get(e.id);o?(o.count+=n,o.children,o.children=r(e.id,o.count,1)):a.set(e.id,{id:e.id,count:n,children:r(e.id,n,1)})}}let o=Array.from(a.values());return o.sort((e,t)=>e.id-t.id),o},[e,t]),u=(0,k.useMemo)(()=>{let e={Equipment:[],CraftResource:[],GatherResource:[]};for(let t of l)e[G(n.get(t.id)?.subtype)].push(t);for(let t of Object.values(e))t.sort((e,t)=>e.id-t.id);return e},[l,n]);function p(e){let t=s[e];if(t==null||t===``)return 0;let n=Number(t);return Number.isFinite(n)?Math.max(0,Math.floor(n)):0}function m(e){let t=p(e.id);return Math.max(0,e.count-t)}let g=(0,k.useMemo)(()=>{let e={Equipment:0,CraftResource:0,GatherResource:0};for(let t of W){let n=0;for(let e of u[t]){let t=m(e),r=B(a[e.id]??``);n+=t*r}e[t]=n}return e},[u,a,s]),_=(0,k.useMemo)(()=>W.reduce((e,t)=>e+g[t],0),[g]);function v(e,n){o(r=>{let i={...r,[e]:n},a=!0;for(;a;){a=!1;for(let[e,n]of t.entries()){if(!n.materials||n.materials.length===0)continue;let t=!0,r=0;for(let e of n.materials){let n=i[e.id];if(n===void 0||n===``){t=!1;break}r+=B(n)*e.count}if(t){let t=String(r);i[e]!==t&&(i[e]=t,a=!0)}}}return i})}function y(e,t){c(n=>({...n,[e]:t===0?``:String(t)}))}function b(e){c(t=>{let n=p(e.id),r=Math.max(0,n-1);return{...t,[e.id]:r===0?``:String(r)}})}function x(e){c(t=>{let n=p(e.id)+1;return{...t,[e.id]:String(n)}})}return(0,A.jsxs)(`div`,{className:`flex h-full w-full flex-col`,children:[(0,A.jsx)(`div`,{className:`flex-1 overflow-hidden`,children:l.length===0?(0,A.jsx)(`div`,{className:`text-sm text-default-500`}):(0,A.jsx)(`div`,{className:`grid h-full min-h-0 min-w-0 grid-cols-[1fr_auto_1fr_auto_1fr] gap-3`,children:W.map((e,t)=>{let o=u[e];return(0,A.jsxs)(k.Fragment,{children:[(0,A.jsx)(z,{typeName:i(`items/types:subtypes.${e}.name`,e),rows:o,itemsById:n,gradesByName:r,priceByMaterialId:a,ownedByMaterialId:s,onPriceChange:v,onOwnedChange:y,onIncOwned:x,onDecOwned:b,sum:g[e],sumLabel:i(`common:crafting.sumType`,`Sum: `)}),t<W.length-1&&(0,A.jsxs)(`div`,{className:`relative flex items-center justify-center`,children:[(0,A.jsx)(`div`,{className:`absolute top-0 bottom-[calc(50%+24px)] w-px bg-crafting-border`}),(0,A.jsx)(`div`,{className:`absolute top-[calc(50%+24px)] bottom-0 w-px bg-crafting-border`}),(0,A.jsx)(`div`,{className:`z-10 flex h-6 w-6 items-center justify-center rounded-full bg-primary dark:bg-secondary`,children:(0,A.jsx)(h,{icon:f,className:`text-[14px] text-white`})})]})]},e)})})}),(0,A.jsxs)(`div`,{className:`flex w-full items-center`,children:[(0,A.jsx)(`div`,{className:`flex-1 h-px bg-crafting-border`}),(0,A.jsx)(`div`,{className:`mx-1 flex h-6 w-6 items-center justify-center rounded-full bg-primary dark:bg-secondary`,children:(0,A.jsx)(h,{icon:d,className:`text-[16px] text-white`})}),(0,A.jsx)(`div`,{className:`flex-1 h-px bg-crafting-border`})]}),(0,A.jsx)(`div`,{className:`mt-2`,children:(0,A.jsx)(R,{label:i(`common:crafting.sumTotal`,`Total: `),value:_})})]})}var q=`aion2.crafting.selectedTier.v1`,J=`aion2.crafting.selectedEquipments.v1.light`,Y=`aion2.crafting.selectedEquipments.v1.dark`,ne=[`trueDragon`,`whiteDragon`,`wiseDragon`,`celestialDragon`,`nobleDragon`,`nobleDragonEmperor`],re=[`starDragon`,`darkDragon`,`ebonyDragon`,`demonicDragon`,`hornedDragon`,`hornedDragonEmperor`];function X(e){return e===`light`?ne:re}function Z(e){return e===`light`?J:Y}function ie(e){let t=typeof e==`number`?e:Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):0}function ae(e){if(!e||typeof e!=`object`)return{};let t=e,n={};for(let[e,r]of Object.entries(t)){if(typeof r==`number`||r===null){n[e]={itemId:r,count:r==null?0:1};continue}if(r&&typeof r==`object`){let t=`itemId`in r&&(typeof r.itemId==`number`||r.itemId===null)?r.itemId:null;if(`count`in r){let i=ie(r.count);n[e]={itemId:t,count:t==null?0:i};continue}if(`disabled`in r){let i=typeof r.disabled==`boolean`?r.disabled:!1;n[e]={itemId:t,count:t==null||i?0:1};continue}n[e]={itemId:null,count:0};continue}n[e]={itemId:null,count:0}}return n}function Q(e){try{let t=localStorage.getItem(Z(e));return t?ae(JSON.parse(t)):{}}catch{return{}}}function $(e){return e?Object.values(e).some(e=>e?.itemId!=null):!1}function oe(e){try{let t=localStorage.getItem(q),n=X(e);return t&&n.includes(t)?t:X(e)[0]}catch{return X(e)[0]}}function se(){let{loading:e,tiers:t,slots:n,itemsById:r}=E(),{t:i}=C(),{theme:a,setThemeHint:o}=T(),[s,c]=(0,k.useState)(`light`),[l,d]=(0,k.useState)(0),f=(0,k.useMemo)(()=>X(s),[s]),[m,h]=(0,k.useState)(()=>oe(`light`)),[v,y]=(0,k.useState)(()=>Q(`light`));(0,k.useEffect)(()=>{localStorage.setItem(Z(s),JSON.stringify(v))},[s,v]),(0,k.useEffect)(()=>{o(s===`light`?`light`:`dark`)},[s,a,o]),(0,k.useEffect)(()=>{y(Q(s));let e=f[Math.min(l,f.length-1)];h(e)},[s,f,l]),(0,k.useEffect)(()=>{localStorage.setItem(q,m)},[m]),(0,k.useEffect)(()=>{if(!t||t.length===0)return;if(!f.includes(m)){let e=f[Math.min(l,f.length-1)];h(e);return}if(t.some(e=>e.name===m))return;let e=f.find(e=>t.some(t=>t.name===e));if(e){let t=f.findIndex(t=>t===e);d(Math.max(0,t)),h(e)}},[t,f,m,l]);let b=(0,k.useRef)($(Q(`light`)));(0,k.useEffect)(()=>{b.current=$(Q(s))},[s]),(0,k.useEffect)(()=>{if(e||!n.length)return;let i=t.find(e=>e.name===m);!i||i.items.length===0||b.current||y(e=>{let t={...e};for(let a of n){let n=e[a.key],o=a.allowed_types??[];if(o.length===0){t[a.key]={itemId:null,count:n?.count??0};continue}let s=o[0];if(n?.itemId){let e=r.get(n.itemId);e?.subtype&&(s=e.subtype)}let c=null;for(let e of i.items)if(r.get(e)?.subtype===s){c=e;break}let l=n?.count??0;t[a.key]={itemId:c,count:c==null?0:Math.max(1,l)}}return t})},[m,t,n,r,e]);function x(e){e!==s&&c(e)}function S(e){b.current=!1;let t=f.findIndex(t=>t===e);t>=0&&d(t),y({}),h(e)}return(0,A.jsxs)(`div`,{className:`flex h-full w-full flex-col bg-crafting-page overflow-y-auto`,children:[(0,A.jsx)(`div`,{className:`w-full flex-1`,children:(0,A.jsxs)(`div`,{className:`mx-auto w-full max-w-[1200px] pt-3 px-4 sm:px-0`,children:[(0,A.jsxs)(`div`,{className:`flex flex-col md:flex-row gap-4 mb-4`,children:[(0,A.jsx)(`div`,{className:`w-full md:w-[220px] shrink-0`,children:(0,A.jsxs)(g,{selectedKey:s,onSelectionChange:e=>x(e),variant:`bordered`,className:`w-full bg-transparent`,classNames:{tabList:`flex w-full rounded-[15px] border-1 border-crafting-border `,tab:`h-[34px] flex-1 justify-center data-[selected=true]:bg-primary dark:data-[selected=true]:bg-default-800`,tabContent:`flex items-center justify-center text-default-800 group-data-[selected=true]:text-background `},children:[(0,A.jsx)(_,{title:i(`common:server.light`,`Light`)},`light`),(0,A.jsx)(_,{title:i(`common:server.dark`,`Dark`)},`dark`)]})}),(0,A.jsx)(`div`,{className:`min-w-0 flex-1`,children:(0,A.jsx)(g,{selectedKey:m,onSelectionChange:e=>S(e),variant:`underlined`,color:s==`light`?`primary`:`default`,className:`w-full border-gray-300 bg-transparent`,classNames:{tabList:`flex w-full overflow-x-auto no-scrollbar`,tab:`h-[34px] flex-1 min-w-[100px] justify-center`,tabContent:`flex items-center justify-center text-default-700`},children:f.map(e=>(0,A.jsx)(_,{title:i(`items/tiers:${e}.name`)},e))})})]}),(0,A.jsxs)(`div`,{className:`flex flex-col md:flex-row gap-4 mb-8`,children:[(0,A.jsx)(p,{className:`h-auto md:h-[726px] w-full md:w-[220px] shrink-0 rounded-lg border-x-1 border-primary bg-crafting-equipment-view`,shadow:`none`,children:(0,A.jsx)(u,{className:`h-full overflow-y-auto py-4 md:py-2`,children:e?(0,A.jsx)(`div`,{className:`text-sm text-default-500`,children:`Loading...`}):(0,A.jsx)(F,{selectedBySlotKey:v,setSelectedBySlotKey:y,race:s})})}),(0,A.jsx)(p,{className:`h-auto md:h-[726px] w-full flex-1 min-w-0 bg-transparent`,shadow:`none`,children:(0,A.jsx)(u,{className:`h-full min-h-0 px-1 py-0`,children:(0,A.jsx)(K,{selectedBySlotKey:v})})})]})]})}),(0,A.jsx)(O,{})]})}var ce=()=>(0,A.jsx)(D,{children:(0,A.jsx)(se,{})});export{ce as component};