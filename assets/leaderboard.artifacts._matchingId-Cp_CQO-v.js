import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import{$t as r,D as i,Gt as a,Jt as o,Kt as s,Lt as c,Rt as l,Wt as u,X as d,Yt as f,_t as p,at as m,gt as h,ht as g,mt as _,nt as v,vt as y,yt as b,z as x,zt as S}from"./vendor-ui-6zHdCyVc.js";import{l as C,o as w,p as T,s as E,t as D,x as O,y as k}from"./index-qKAaY4mI.js";import"./AdaptiveTooltip-DvuVJDhp.js";import{t as A}from"./Footer-CjRT9fbH.js";import{t as j}from"./ArtifactStateModal-B2ofzMT4.js";var M=e(t(),1),N=e(n(),1),P=({children:e,title:t,onConfirm:n,confirmText:r,cancelText:i,color:a=`danger`})=>{let{t:o}=O(`common`),[s,u]=M.useState(!1);return(0,N.jsxs)(c,{isOpen:s,onOpenChange:e=>u(e),placement:`top`,children:[(0,N.jsx)(l,{children:e}),(0,N.jsx)(S,{className:`p-4`,children:(0,N.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[(0,N.jsx)(`div`,{className:`text-sm font-medium`,children:t}),(0,N.jsxs)(`div`,{className:`flex justify-center gap-2`,children:[(0,N.jsx)(f,{size:`sm`,variant:`flat`,onClick:()=>u(!1),children:i||o(`ui.cancel`)}),(0,N.jsx)(f,{size:`sm`,color:a,onClick:()=>{n(),u(!1)},children:r||o(`ui.confirm`)})]})]})})]})};function F(){let{matchingId:e}=D.useParams(),t=T(),n=[E.ABYSS_A,E.ABYSS_B],{t:c}=O([...n.map(e=>`markers/${e}`),`common`]),{isSuperUser:l}=C(),{seasons:S,serverMatchings:F,artifactsByMap:I,fetchServerMatching:L,fetchArtifactStates:R,region:z,deleteArtifactState:B}=w(),[V,H]=(0,M.useState)(!1),[U,W]=(0,M.useState)(null),[G,K]=(0,M.useState)(null),[q,J]=(0,M.useState)([]),Y=(0,M.useMemo)(()=>F.find(t=>t.id===e),[F,e]),X=(0,M.useMemo)(()=>{if(Y)return Y.seasonId;let e=S.filter(e=>e.serverRegion.toLowerCase()===z.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[z,S,Y]);(0,M.useEffect)(()=>{X&&(Y||L(X,e),R(X,void 0,e).then(e=>{J(e)}))},[X,e,Y,L,R]);let Z=(0,M.useMemo)(()=>{let t={};return q.filter(t=>t.serverMatchingId===e).forEach(e=>{t[e.mapName]||(t[e.mapName]=[]),t[e.mapName].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((e,t)=>new Date(t.recordTime).getTime()-new Date(e.recordTime).getTime())}),t},[q,e]),Q=(0,M.useMemo)(()=>{let e={};return Object.keys(I).forEach(t=>{e[t]=[...I[t]].sort((e,t)=>e.order-t.order)}),e},[I]),$=(e,t)=>{Y&&(W(t),K(e),H(!0))},ee=(e,t)=>{Y&&(W(e),K(t?{...t,id:``}:null),H(!0))},te=async t=>{X&&await B(X,t.mapName,t.id,e)&&J(await R(X,void 0,e))},ne=(e,t)=>{let n=new Date(e).getTime(),r=new Date(t).getTime(),i=Math.abs(n-r)-2880*60*1e3,a=i<0,o=Math.abs(i),s=Math.floor(o/(1e3*60*60)),c=Math.floor(o%(1e3*60*60)/(1e3*60)),l=Math.floor(o%(1e3*60)/1e3);return`${a?`-`:``}${String(s).padStart(2,`0`)}:${String(c).padStart(2,`0`)}:${String(l).padStart(2,`0`)}`},re=k(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Neutral.webp`),ie=k(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Light.webp`),ae=k(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Dark.webp`);return!Y&&!X?(0,N.jsx)(`div`,{className:`p-8 text-center`,children:c(`common:ui.loading`)}):(0,N.jsxs)(`div`,{className:`min-h-full flex flex-col`,children:[(0,N.jsxs)(`div`,{className:`flex-1 flex flex-col items-center p-4`,children:[(0,N.jsxs)(`div`,{className:`w-full max-w-[1400px] flex flex-col gap-6`,children:[(0,N.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,N.jsx)(f,{isIconOnly:!0,variant:`flat`,className:`bg-character-card border-1 border-crafting-border`,onClick:()=>t({to:`/leaderboard`}),children:(0,N.jsx)(m,{icon:i})}),(0,N.jsx)(`h1`,{className:`text-2xl font-bold`,children:Y?`${Y.server1.serverName} VS ${Y.server2.serverName}`:c(`common:leaderboard.artifactDetails`)})]}),n.map(e=>{let t=Z[e]||[],n=Q[e]||[];return(0,N.jsxs)(a,{className:`bg-character-equipment shadow-none border-1 border-crafting-border`,children:[(0,N.jsxs)(s,{className:`flex justify-between items-center px-6 py-4`,children:[(0,N.jsx)(`h2`,{className:`text-xl font-bold`,children:c(`maps:${e}.description`)}),l&&(0,N.jsx)(f,{size:`sm`,color:`default`,variant:`flat`,startContent:(0,N.jsx)(m,{icon:d}),onClick:()=>ee(e),children:c(`common:leaderboard.artifactState.create`)})]}),(0,N.jsx)(r,{}),(0,N.jsx)(o,{className:`p-0 overflow-x-auto`,children:(0,N.jsxs)(b,{"aria-label":`Artifact states for ${e}`,className:`min-w-full`,removeWrapper:!0,classNames:{th:`bg-character-card text-foreground border-b border-crafting-border first:rounded-none last:rounded-none`,td:`py-3 px-4 border-b border-crafting-border/50`},children:[(0,N.jsx)(p,{columns:[{id:`recordTime`,label:c(`common:leaderboard.artifactState.recordTime`),width:200},...n.map(t=>({id:t.id,label:c(`markers/${e}:${t.markerId}.name`,{defaultValue:t.marker.name}),isArtifact:!0})),{id:`options`,label:c(`common:leaderboard.options`),width:100}],children:e=>(0,N.jsx)(y,{width:e.width,align:`center`,children:e.isArtifact?(0,N.jsx)(`div`,{className:`flex flex-col items-center gap-1 min-w-[120px]`,children:(0,N.jsx)(`span`,{className:`text-[12px] whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px]`,children:e.label})}):e.label},e.id)}),(0,N.jsx)(g,{emptyContent:c(`common:ui.noData`),items:t.flatMap((r,i)=>{let a=[];if(a.push({type:`data`,id:r.id,state:r,mapName:e,arts:n}),i<t.length-1){let e=t[i+1];a.push({type:`diff`,id:`diff-${r.id}-${e.id}`,state:r,nextState:e,arts:n})}return a}),children:e=>{if(e.type===`diff`){let t=ne(e.state.recordTime,e.nextState.recordTime);return(0,N.jsx)(h,{className:`bg-default-50/30`,children:(0,N.jsx)(_,{colSpan:n.length+2,children:(0,N.jsx)(`div`,{className:`flex justify-center items-center px-4 py-1`,children:(0,N.jsxs)(`span`,{className:`text-sm text-default-800 italic text-center`,children:[c(`common:leaderboard.timeDiffToNext`,`Time diff to next record`),`: `,t]})})})},e.id)}return(0,N.jsxs)(h,{children:[(0,N.jsx)(_,{children:(0,N.jsx)(`div`,{className:`flex flex-col`,children:(0,N.jsx)(`span`,{className:`font-medium`,children:new Date(e.state.recordTime).toLocaleString()})})},`recordTime`),e.arts.map(t=>{let n=e.state.states.find(e=>e.abyssArtifactId===t.id);return(0,N.jsx)(_,{children:(0,N.jsx)(`div`,{className:`flex justify-center`,children:(0,N.jsx)(`img`,{src:n?.state===1?ie:n?.state===2?ae:re,alt:`state`,className:`w-10 h-10`})})},t.id)}),(0,N.jsx)(_,{children:(0,N.jsx)(`div`,{className:`flex justify-center gap-2`,children:l&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(u,{content:c(`common:ui.edit`),children:(0,N.jsx)(f,{isIconOnly:!0,size:`sm`,variant:`light`,onClick:()=>$(e.state,e.mapName),children:(0,N.jsx)(m,{icon:x,className:`text-primary`})})}),(0,N.jsx)(P,{title:c(`common:leaderboard.deleteConfirm`,`Are you sure you want to delete this record?`),onConfirm:()=>te(e.state),children:(0,N.jsx)(f,{isIconOnly:!0,size:`sm`,variant:`light`,children:(0,N.jsx)(m,{icon:v,className:`text-danger`})})})]})})},`options`)]},e.id)}})]})})]},e)})]}),Y&&U&&(0,N.jsx)(j,{isOpen:V,onOpenChange:t=>{H(t),t||R(X,void 0,e).then(e=>{J(e)})},matching:Y,mapName:U,artifacts:Q[U]||[],initialState:G,seasonId:X})]}),(0,N.jsx)(A,{})]})}export{F as component};