import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import"./vendor-i18n-Cs5RKeB8.js";import{Bt as r,Gt as i,Jt as a,Ut as o,Vt as s,Wt as c,X as l,dt as u,ft as d,ht as f,mt as p,nt as m,ot as h,pt as g,st as _,t as v,ut as y}from"./vendor-ui-BpEfsUbP.js";import{a as b,g as x,i as S,n as C,o as w,v as T}from"./index--zJDrKWv.js";import{t as E}from"./AdaptiveTooltip-5uLdhDFP.js";import{t as D}from"./Footer-DpG3f5ro.js";var O=e(t(),1),k=e(n(),1),A=({mapName:e,setMapName:t,className:n})=>{let{t:r}=T(),{region:i,setRegion:a}=b(),o={trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card`,innerWrapper:`h-10 py-0`,popoverContent:`rounded-none p-0`},s={itemClasses:{base:`rounded-none`}};return(0,k.jsxs)(`div`,{className:`flex gap-2 w-full ${n}`,children:[(0,k.jsxs)(h,{size:`sm`,selectedKeys:[i],onSelectionChange:e=>a(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:o,popoverProps:{radius:`none`},listboxProps:s,children:[(0,k.jsx)(_,{children:r(`common:server.tw`)},`tw`),(0,k.jsx)(_,{children:r(`common:server.kr`)},`kr`)]}),(0,k.jsxs)(h,{size:`sm`,selectedKeys:[e],onSelectionChange:e=>t(Array.from(e)[0]),className:`min-w-[150px] flex-[2] sm:flex-none sm:w-[200px]`,disallowEmptySelection:!0,classNames:o,popoverProps:{radius:`none`},listboxProps:s,children:[(0,k.jsx)(_,{children:r(`common:leaderboard.allMaps`,`全部地图`)},`ALL`),(0,k.jsx)(_,{children:r(`maps:${w.ABYSS_A}.description`)},w.ABYSS_A),(0,k.jsx)(_,{children:r(`maps:${w.ABYSS_B}.description`)},w.ABYSS_B)]})]})},j=({mapName:e,setMapName:t})=>{let{t:n}=T(),{seasons:a,artifactCounts:c,fetchArtifactCounts:l,loadingArtifactCounts:m,serverMatchings:h,region:_}=b(),v=(0,O.useMemo)(()=>{if(a.length===0)return null;let e=Math.max(...a.map(e=>e.number));return a.find(t=>t.serverRegion.toLowerCase()===_.toLowerCase()&&t.number===e)?.id||null},[a,_]);(0,O.useEffect)(()=>{v&&l(v,e)},[v,e,l]);let x=(0,O.useMemo)(()=>{let e=[...c].sort((e,t)=>t.artifactCount-e.artifactCount||e.serverId-t.serverId),t=[],n=-1,r=0;for(let i=0;i<e.length;i++){let a=e[i];a.artifactCount!==n&&(r=i+1,n=a.artifactCount),t.push({...a,rank:r})}return t},[c]),S=e=>{let t=h.find(t=>t.server1.serverId===e||t.server2.serverId===e);if(t){let r=t.server1.serverId===e?t.server1:t.server2,i=r.raceId===1?n(`common:server.lightAbbr`):n(`common:server.darkAbbr`),a=r.serverId%1e3;return`${r.serverName}（${i}${a}）`}let r=n(e<2e3?`common:server.lightAbbr`:`common:server.darkAbbr`),i=e%1e3;return`${n(`common:server.server`)}（${r}${i}）`};return(0,k.jsxs)(r,{className:`bg-transparent shadow-none`,children:[(0,k.jsx)(s,{className:`flex flex-col items-start gap-3 px-0`,children:(0,k.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,k.jsx)(`p`,{className:`text-[22px] text-default-800`,children:n(`common:leaderboard.artifactRegionRanking`)}),(0,k.jsx)(A,{mapName:e,setMapName:t})]})}),(0,k.jsx)(o,{className:`px-0`,children:(0,k.jsxs)(f,{"aria-label":`Artifact Region Ranking`,removeWrapper:!0,className:`min-w-full`,classNames:{table:`border-separate border-spacing-y-[10px] -mt-[10px]`,thead:`[&>tr]:first:shadow-none`,th:`bg-transparent text-foreground font-bold text-[16px] h-auto py-0`,td:`bg-character-equipment h-[44px] text-[16px] font-normal text-default-800 border-y-1 border-crafting-border first:border-l-1 last:border-r-1 first:rounded-l-md last:rounded-r-md`},children:[(0,k.jsxs)(g,{children:[(0,k.jsx)(p,{children:n(`common:leaderboard.rank`)}),(0,k.jsx)(p,{children:n(`common:server.server`)}),(0,k.jsx)(p,{align:`center`,children:n(`common:leaderboard.artifactCount`)})]}),(0,k.jsx)(u,{emptyContent:m?(0,k.jsx)(i,{}):n(`common:leaderboard.inContention`),items:x,children:e=>(0,k.jsxs)(d,{children:[(0,k.jsx)(y,{children:(0,k.jsx)(`div`,{className:`flex items-center justify-center w-6 h-6`,children:e.rank})}),(0,k.jsx)(y,{children:(0,k.jsx)(`span`,{children:S(e.serverId)})}),(0,k.jsx)(y,{align:`center`,children:(0,k.jsx)(`span`,{children:e.artifactCount})})]},e.serverId)})]})})]})},M=()=>{let e=[w.ABYSS_A,w.ABYSS_B],t=`starred_artifact_servers`,{t:n}=T([...e.map(e=>`markers/${e}`),`common`]),{seasons:i,serverMatchings:u,loadingMatchings:d,artifacts:f,loadingArtifacts:p,artifactStates:h,fetchServerMatchings:g,fetchArtifactStates:_,region:y}=b(),{maps:S}=C(),[D,A]=(0,O.useState)(new Date),[j,M]=(0,O.useState)(()=>{let e=localStorage.getItem(t);return e?JSON.parse(e):[]}),N=(0,O.useCallback)(e=>{M(n=>{let r=n.includes(e)?n.filter(t=>t!==e):[...n,e];return localStorage.setItem(t,JSON.stringify(r)),r})},[]),P=(0,O.useMemo)(()=>[...u].sort((e,t)=>{let n=j.includes(e.server1.serverId)||j.includes(e.server2.serverId),r=j.includes(t.server1.serverId)||j.includes(t.server2.serverId);return n&&!r?-1:!n&&r?1:0}),[u,j]);(0,O.useEffect)(()=>{let e=setInterval(()=>{A(new Date)},1e3);return()=>clearInterval(e)},[]);let F=x(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Neutral.webp`),I=x(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Light.webp`),L=x(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Dark.webp`),R=x(`images/Leaderboards/VS.webp`),z=(0,O.useMemo)(()=>i.length===0?null:Math.max(...i.map(e=>e.number)),[i]),B=(0,O.useMemo)(()=>z&&i.find(e=>e.serverRegion===y&&e.number===z)?.id||null,[y,z,i]);(0,O.useEffect)(()=>{B&&(g(B),_(B))},[B,g,_]);let V=(0,O.useMemo)(()=>{let e={};return h.forEach(t=>{e[t.serverMatchingId]||(e[t.serverMatchingId]={}),e[t.serverMatchingId][t.abyssArtifactId]={state:t.state,recordTime:t.recordTime}}),e},[h]),H=e=>{if(!e)return`--:--:--`;let t=new Date(e).getTime()+2880*60*1e3-D.getTime();if(t<=0)return n(`common:leaderboard.inContention`,`数据待上传`);let r=Math.floor(t/(1e3*60*60)),i=Math.floor(t%(1e3*60*60)/(1e3*60)),a=Math.floor(t%(1e3*60)/1e3);return`${String(r).padStart(2,`0`)}:${String(i).padStart(2,`0`)}:${String(a).padStart(2,`0`)}`},{artifactsA:U,artifactsB:W}=(0,O.useMemo)(()=>{let e=S.find(e=>e.name===w.ABYSS_A),t=S.find(e=>e.name===w.ABYSS_B);return{artifactsA:f.filter(t=>t.marker.mapId===e?.id).sort((e,t)=>e.order-t.order),artifactsB:f.filter(e=>e.marker.mapId===t?.id).sort((e,t)=>e.order-t.order)}},[f,S]);return(0,k.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[(0,k.jsx)(r,{className:`bg-transparent shadow-none`,children:(0,k.jsx)(s,{className:`flex flex-col items-start gap-3 px-0`,children:(0,k.jsx)(`p`,{className:`text-[22px] text-default-800`,children:n(`common:leaderboard.realtimeArtifactRatio`)})})}),d||p?(0,k.jsx)(`p`,{className:`text-center py-4`,children:n(`common:ui.loading`)}):P.map(e=>(0,k.jsx)(r,{className:`bg-character-equipment shadow-none border-1 border-crafting-border p-4 relative group`,children:(0,k.jsx)(o,{className:`p-0`,children:(0,k.jsxs)(`div`,{className:`flex items-stretch justify-between`,children:[(0,k.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,k.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:`linear-gradient(135deg, #DBEDFF 0%, #F3FBFF 100%)`},children:[(0,k.jsx)(c,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute left-1 z-10 text-default-400 hover:text-warning data-[starred=true]:text-warning`,"data-starred":j.includes(e.server1.serverId),onClick:()=>N(e.server1.serverId),children:(0,k.jsx)(m,{icon:j.includes(e.server1.serverId)?l:v,className:`text-[16px]`})}),(0,k.jsx)(`span`,{className:`text-lg font-bold text-[#1D3557]`,children:e.server1.serverName}),(0,k.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（天`,e.server1.serverId%1e3,`）`]})]}),(0,k.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,k.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,k.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:n(`maps:${w.ABYSS_A}.description`)}),(0,k.jsx)(`div`,{className:`flex gap-1`,children:U.map(t=>{let r=n(`markers/${w.ABYSS_A}:${t.markerId}.name`,t.marker.name),i=V[e.id]?.[t.id],a=i?.state,o=!1;i?.recordTime&&new Date(i.recordTime).getTime()+2880*60*1e3-D.getTime()<=0&&(o=!0);let s=F;return o||(a===1?s=I:a===2&&(s=L)),(0,k.jsx)(E,{content:r,children:(0,k.jsx)(`img`,{src:s,alt:r,className:`w-7 h-7 sm:w-12 sm:h-12`})},t.id)})})]}),(0,k.jsx)(`div`,{className:`text-[20px] text-default-800 font-mono`,children:H(U.length>0?V[e.id]?.[U[0].id]?.recordTime:void 0)})]})]}),(0,k.jsxs)(`div`,{className:`flex flex-col items-center px-2 h-full`,children:[(0,k.jsx)(`div`,{className:`h-[38px] flex items-center`,children:(0,k.jsx)(`img`,{src:R,alt:`VS`,className:`w-10 h-10 object-contain`})}),(0,k.jsx)(`div`,{className:`flex-1 flex items-center mt-2`,children:(0,k.jsx)(a,{orientation:`vertical`,className:`h-[60px] sm:h-[80px] bg-default-500`})})]}),(0,k.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,k.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:`linear-gradient(225deg, #EFE5FF 0%, #F3FBFF 100%)`},children:[(0,k.jsx)(`span`,{className:`text-lg font-bold text-[#4B0082]`,children:e.server2.serverName}),(0,k.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（魔`,e.server2.serverId%1e3,`）`]}),(0,k.jsx)(c,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute right-1 z-10 text-default-400 hover:text-warning data-[starred=true]:text-warning`,"data-starred":j.includes(e.server2.serverId),onClick:()=>N(e.server2.serverId),children:(0,k.jsx)(m,{icon:j.includes(e.server2.serverId)?l:v,className:`text-[16px]`})})]}),(0,k.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,k.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,k.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:n(`maps:${w.ABYSS_B}.description`)}),(0,k.jsx)(`div`,{className:`flex gap-1`,children:W.map(t=>{let r=n(`markers/${w.ABYSS_B}:${t.markerId}.name`,t.marker.name),i=V[e.id]?.[t.id],a=i?.state,o=!1;i?.recordTime&&new Date(i.recordTime).getTime()+2880*60*1e3-D.getTime()<=0&&(o=!0);let s=F;return o||(a===1?s=I:a===2&&(s=L)),(0,k.jsx)(E,{content:r,children:(0,k.jsx)(`img`,{src:s,alt:r,className:`w-7 h-7 sm:w-12 sm:h-12`})},t.id)})})]}),(0,k.jsx)(`div`,{className:`text-[20px] text-default-800 font-mono`,children:H(W.length>0?V[e.id]?.[W[0].id]?.recordTime:void 0)})]})]})]})})},e.id))]})};function N(){let[e,t]=(0,O.useState)(`ALL`);return(0,k.jsxs)(`div`,{className:`h-full overflow-y-auto flex flex-col bg-leaderboard-page`,children:[(0,k.jsx)(`div`,{className:`flex-1 flex flex-col items-center p-4`,children:(0,k.jsx)(`div`,{className:`w-full max-w-[1074px] flex flex-col gap-4`,children:(0,k.jsxs)(`div`,{className:`flex flex-col-reverse lg:flex-row justify-center gap-4 lg:gap-8`,children:[(0,k.jsx)(`div`,{className:`w-full lg:w-[428px] flex flex-col gap-4`,children:(0,k.jsx)(j,{mapName:e,setMapName:t})}),(0,k.jsx)(`div`,{className:`w-full lg:w-[632px] flex flex-col gap-4`,children:(0,k.jsx)(M,{})})]})})}),(0,k.jsx)(D,{})]})}export{N as component};