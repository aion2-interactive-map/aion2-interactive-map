import{s as e}from"./rolldown-runtime-Cb2Vi1zU.js";import{a as t,n}from"./vendor-react-Pim_c09P.js";import{$ as r,$t as i,Gt as a,Jt as o,Kt as s,Xt as c,Yt as l,Z as u,_t as d,at as f,ct as p,dt as m,gt as h,ht as g,in as _,mt as v,nn as y,rn as b,t as x,ut as S,vt as C,yt as w}from"./vendor-ui-6zHdCyVc.js";import{a as T,d as E,f as D,l as ee,o as te,p as ne,s as O,x as k,y as A}from"./index-qKAaY4mI.js";import{t as j}from"./AdaptiveTooltip-DvuVJDhp.js";import{t as M}from"./Footer-CjRT9fbH.js";import{t as re}from"./ArtifactStateModal-B2ofzMT4.js";var N=e(t(),1),P=e(n(),1),ie=({mapName:e,setMapName:t})=>{let{t:n}=k(),{seasons:r,artifactCounts:i,fetchArtifactCounts:l,loadingArtifactCounts:u,serverMatchings:f,loadingMatchings:p,region:_,setRegion:y}=te(),b={trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},x={itemClasses:{base:`rounded-none`}},T=(0,N.useMemo)(()=>{let e=r.filter(e=>e.serverRegion.toLowerCase()===_.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[r,_]);(0,N.useEffect)(()=>{T&&l(T,e)},[T,e,l]);let E=(0,N.useMemo)(()=>{let e=[...i].sort((e,t)=>t.artifactCount-e.artifactCount||e.serverId-t.serverId),t=[],n=-1,r=0;for(let i=0;i<e.length;i++){let a=e[i];a.artifactCount!==n&&(r=i+1,n=a.artifactCount),t.push({...a,rank:r})}return t},[i]),D=e=>{let t=f.find(t=>t.server1.serverId===e||t.server2.serverId===e);if(t){let r=t.server1.serverId===e?t.server1:t.server2,i=r.raceId===1?n(`common:server.lightAbbr`):n(`common:server.darkAbbr`),a=r.serverId%1e3;return`${r.serverName}（${i}${a}）`}let r=n(e<2e3?`common:server.lightAbbr`:`common:server.darkAbbr`),i=e%1e3;return`${n(`common:server.server`)}（${r}${i}）`};return(0,P.jsxs)(a,{className:`bg-transparent shadow-none`,children:[(0,P.jsx)(s,{className:`flex flex-col items-start gap-3 px-0`,children:(0,P.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,P.jsx)(`p`,{className:`text-[22px] text-default-800`,children:n(`common:leaderboard.artifactRegionRanking`)}),(0,P.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,P.jsxs)(S,{size:`sm`,selectedKeys:[_],onSelectionChange:e=>y(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:b,popoverProps:{radius:`none`},listboxProps:x,children:[(0,P.jsx)(m,{children:n(`common:server.tw`)},`tw`),(0,P.jsx)(m,{children:n(`common:server.kr`)},`kr`)]}),(0,P.jsxs)(S,{size:`sm`,selectedKeys:[e],onSelectionChange:e=>t(Array.from(e)[0]),className:`min-w-[150px] flex-[2] sm:flex-none sm:w-[200px]`,disallowEmptySelection:!0,classNames:b,popoverProps:{radius:`none`},listboxProps:x,children:[(0,P.jsx)(m,{children:n(`common:leaderboard.allMaps`,`全部地图`)},`ALL`),(0,P.jsx)(m,{children:n(`maps:${O.ABYSS_A}.description`)},O.ABYSS_A),(0,P.jsx)(m,{children:n(`maps:${O.ABYSS_B}.description`)},O.ABYSS_B)]})]})]})}),(0,P.jsx)(o,{className:`px-0`,children:u||p||f.length===0?(0,P.jsx)(`div`,{className:`flex justify-center items-center py-10`,children:(0,P.jsx)(c,{})}):(0,P.jsxs)(w,{"aria-label":`Artifact Region Ranking`,removeWrapper:!0,className:`min-w-full`,classNames:{table:`border-separate border-spacing-y-[10px] -mt-[10px]`,thead:`[&>tr]:first:shadow-none`,th:`bg-transparent text-foreground font-bold text-[16px] h-auto py-0`,td:`bg-character-equipment h-[44px] text-[16px] font-normal text-default-800 border-y-1 border-crafting-border first:border-l-1 last:border-r-1 first:rounded-l-md last:rounded-r-md`},children:[(0,P.jsxs)(d,{children:[(0,P.jsx)(C,{children:n(`common:leaderboard.rank`)}),(0,P.jsx)(C,{children:n(`common:server.server`)}),(0,P.jsx)(C,{align:`center`,children:n(`common:leaderboard.artifactCount`)})]}),(0,P.jsx)(g,{emptyContent:n(`common:leaderboard.inContention`),items:E,children:e=>(0,P.jsxs)(h,{children:[(0,P.jsx)(v,{children:(0,P.jsx)(`div`,{className:`flex items-center justify-center w-6 h-6`,children:e.rank})}),(0,P.jsx)(v,{children:(0,P.jsx)(`span`,{children:D(e.serverId)})}),(0,P.jsx)(v,{align:`center`,children:(0,P.jsx)(`span`,{children:e.artifactCount})})]},e.serverId)})]})})]})},F=()=>{let e=ne(),t=[O.ABYSS_A,O.ABYSS_B],n=`starred_artifact_servers`,{t:c,i18n:d}=k([...t.map(e=>`markers/${e}`),`common`]),{seasons:h,serverMatchings:g,loadingMatchings:v,artifactsByMap:C,loadingArtifacts:w,artifactStates:T,fetchServerMatchings:E,fetchArtifactStates:D,region:M,setRegion:ie}=te(),{isSuperUser:F}=ee(),[I,L]=(0,N.useState)(y(b())),[R,z]=(0,N.useState)(!0),[ae,B]=(0,N.useState)(!1),[V,oe]=(0,N.useState)(null),[H,se]=(0,N.useState)(null),[ce,le]=(0,N.useState)(null),[U,ue]=(0,N.useState)(()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]}),W=(0,N.useCallback)(e=>{ue(t=>{let r=t.includes(e)?t.filter(t=>t!==e):[...t,e];return localStorage.setItem(n,JSON.stringify(r)),r})},[]),de=(0,N.useMemo)(()=>[...g].sort((e,t)=>{let n=U.includes(e.server1.serverId)||U.includes(e.server2.serverId),r=U.includes(t.server1.serverId)||U.includes(t.server2.serverId);return n&&!r?-1:!n&&r?1:0}),[g,U]);(0,N.useEffect)(()=>{if(!R)return;let e=setInterval(()=>{L(y(b()))},1e3);return()=>clearInterval(e)},[R]);let G=A(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Neutral.webp`),K=A(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Light.webp`),q=A(`UI/Resource/Texture/Icon/UT_Marker_AbyssArtifact_Dark.webp`),fe=A(`images/Leaderboards/VS.webp`),J=(0,N.useMemo)(()=>{let e=h.filter(e=>e.serverRegion.toLowerCase()===M.toLowerCase());if(e.length===0)return null;let t=Math.max(...e.map(e=>e.number));return e.find(e=>e.number===t)?.id||null},[M,h]),Y=(0,N.useMemo)(()=>{let e,t=!0;return n=>{if(e&&clearTimeout(e),t){D(n),t=!1;return}e=setTimeout(()=>{D(n)},5e3)}},[D]);(0,N.useEffect)(()=>{J&&(E(J),R?Y(J):D(J,I.toDate()))},[J,R,R?null:I,E,Y,D]);let X=(0,N.useMemo)(()=>{let e={};return T.forEach(t=>{e[t.serverMatchingId]||(e[t.serverMatchingId]={}),t.states.forEach(n=>{e[t.serverMatchingId][n.abyssArtifactId]={state:n.state,recordTime:t.recordTime}})}),e},[T]),Z=e=>{if(!e)return`--:--:--`;let t=new Date(e).getTime(),n=R?Date.now():I.toDate().getTime(),r=t+1728e5-n;if(r<=0)return c(`common:leaderboard.inContention`,`数据待上传`);let i=Math.floor(r/(1e3*60*60)),a=Math.floor(r%(1e3*60*60)/(1e3*60)),o=Math.floor(r%(1e3*60)/1e3);return`${String(i).padStart(2,`0`)}:${String(a).padStart(2,`0`)}:${String(o).padStart(2,`0`)}`},{artifactsA:Q,artifactsB:$}=(0,N.useMemo)(()=>({artifactsA:(C[O.ABYSS_A]||[]).sort((e,t)=>e.order-t.order),artifactsB:(C[O.ABYSS_B]||[]).sort((e,t)=>e.order-t.order)}),[C]),pe=(e,t)=>{if(!F)return;console.log(`handleTimeClick`,{matchingId:e.id,mapName:t}),console.log(`artifactStates total count:`,T.length),oe(e),se(t);let n=T.find(n=>n.serverMatchingId===e.id&&n.mapName===t);console.log(`Found state:`,n),le(n||null),B(!0)};return(0,P.jsxs)(`div`,{className:`flex flex-col gap-4`,children:[(0,P.jsx)(a,{className:`bg-transparent shadow-none`,children:(0,P.jsx)(s,{className:`flex flex-col items-start gap-3 px-0`,children:(0,P.jsxs)(`div`,{className:`flex flex-col w-full gap-3 pb-4`,children:[(0,P.jsx)(`p`,{className:`text-[22px] text-default-800`,children:c(`common:leaderboard.realtimeArtifactRatio`)}),(0,P.jsxs)(`div`,{className:`flex gap-2 w-full`,children:[(0,P.jsxs)(S,{size:`sm`,selectedKeys:[M],onSelectionChange:e=>ie(Array.from(e)[0]),className:`min-w-[100px] flex-1 sm:flex-none sm:w-[120px]`,disallowEmptySelection:!0,classNames:{trigger:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,innerWrapper:`h-[36px] py-0`,popoverContent:`rounded-none p-0`},popoverProps:{radius:`none`},listboxProps:{itemClasses:{base:`rounded-none`}},children:[(0,P.jsx)(m,{children:c(`common:server.tw`)},`tw`),(0,P.jsx)(m,{children:c(`common:server.kr`)},`kr`)]}),(0,P.jsx)(_,{locale:d.language,children:(0,P.jsxs)(`div`,{className:`relative flex-[2] sm:flex-none sm:w-[280px]`,children:[(0,P.jsx)(p,{className:`w-full`,hideTimeZone:!0,showMonthAndYearPickers:!0,value:I,onChange:e=>{e&&(L(e),z(!1))},classNames:{inputWrapper:`!bg-character-card hover:!bg-character-card focus:!bg-character-card !transition-none border-crafting-border border-1 shadow-none rounded-sm group-data-[hover=true]:!bg-character-card group-data-[focus=true]:!bg-character-card group-data-[focus-visible=true]:!bg-character-card h-[36px] min-h-[36px]`,popoverContent:`rounded-none p-0`,segment:`text-foreground`},granularity:`second`}),!R&&(0,P.jsx)(j,{content:c(`common:leaderboard.resetToNow`,`重置到当前时间`),children:(0,P.jsx)(l,{size:`sm`,variant:`flat`,isIconOnly:!0,className:`absolute right-10 top-1/2 -translate-y-1/2 z-20 h-6 w-6 min-w-0 bg-transparent`,onClick:()=>{z(!0),L(y(b()))},children:(0,P.jsx)(f,{icon:u,className:`text-[12px]`})})})]})})]})]})})}),v||w?(0,P.jsx)(`p`,{className:`text-center py-4`,children:c(`common:ui.loading`)}):de.map(t=>(0,P.jsx)(a,{isPressable:!0,onClick:()=>e({to:`/leaderboard/artifacts/${t.id}`}),className:`bg-character-equipment shadow-none border-1 border-crafting-border p-4 relative group`,children:(0,P.jsx)(o,{className:`p-0`,children:(0,P.jsxs)(`div`,{className:`flex items-stretch justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,P.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:`linear-gradient(135deg, #DBEDFF 0%, #F3FBFF 100%)`},children:[(0,P.jsx)(l,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute left-1 z-10 text-default-400 hover:text-star data-[starred=true]:text-star`,"data-starred":U.includes(t.server1.serverId),onClick:e=>{e.stopPropagation(),W(t.server1.serverId)},children:(0,P.jsx)(f,{icon:U.includes(t.server1.serverId)?r:x,className:`text-[16px]`})}),(0,P.jsx)(`span`,{className:`text-lg font-bold text-[#1D3557]`,children:t.server1.serverName}),(0,P.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（`,c(`common:server.lightAbbr`),t.server1.serverId%1e3,`）`]})]}),(0,P.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:c(`maps:${O.ABYSS_A}.description`)}),(0,P.jsx)(`div`,{className:`flex gap-1`,children:Q.map(e=>{let n=c(`markers/${O.ABYSS_A}:${e.markerId}.name`,e.marker.name),r=X[t.id]?.[e.id],i=r?.state,a=!1;if(r?.recordTime){let e=new Date(r.recordTime).getTime(),t=R?Date.now():I.toDate().getTime();e+1728e5-t<=0&&(a=!0)}let o=G;return a||(i===1?o=K:i===2&&(o=q)),(0,P.jsx)(j,{content:n,children:(0,P.jsx)(`img`,{src:o,alt:n,className:`w-7 h-7 sm:w-12 sm:h-12`})},e.id)})})]}),(0,P.jsx)(`div`,{className:`text-[20px] text-default-800 font-mono ${F?`cursor-pointer hover:text-primary`:``}`,onClick:()=>pe(t,O.ABYSS_A),children:Z(Q.length>0?X[t.id]?.[Q[0].id]?.recordTime:void 0)})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-col items-center px-2 h-full`,children:[(0,P.jsx)(`div`,{className:`h-[38px] flex items-center`,children:(0,P.jsx)(`img`,{src:fe,alt:`VS`,className:`w-10 h-10 object-contain`})}),(0,P.jsx)(`div`,{className:`flex-1 flex items-center mt-2`,children:(0,P.jsx)(i,{orientation:`vertical`,className:`h-[60px] sm:h-[80px] bg-default-500`})})]}),(0,P.jsxs)(`div`,{className:`flex-1 flex flex-col items-center`,children:[(0,P.jsxs)(`div`,{className:`w-full h-[38px] flex items-center justify-center rounded-md relative`,style:{background:`linear-gradient(225deg, #EFE5FF 0%, #F3FBFF 100%)`},children:[(0,P.jsx)(`span`,{className:`text-lg font-bold text-[#4B0082]`,children:t.server2.serverName}),(0,P.jsxs)(`span`,{className:`text-[14px] font-normal text-default-700`,children:[`（`,c(`common:server.darkAbbr`),t.server2.serverId%1e3,`）`]}),(0,P.jsx)(l,{isIconOnly:!0,size:`sm`,variant:`light`,className:`absolute right-1 z-10 text-default-400 hover:text-star data-[starred=true]:text-star`,"data-starred":U.includes(t.server2.serverId),onClick:()=>W(t.server2.serverId),children:(0,P.jsx)(f,{icon:U.includes(t.server2.serverId)?r:x,className:`text-[16px]`})})]}),(0,P.jsxs)(`div`,{className:`flex flex-col items-center gap-2 mt-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`text-[14px] text-foreground max-w-[40px] sm:max-w-none whitespace-normal`,children:c(`maps:${O.ABYSS_B}.description`)}),(0,P.jsx)(`div`,{className:`flex gap-1`,children:$.map(e=>{let n=c(`markers/${O.ABYSS_B}:${e.markerId}.name`,e.marker.name),r=X[t.id]?.[e.id],i=r?.state,a=!1;if(r?.recordTime){let e=new Date(r.recordTime).getTime(),t=R?Date.now():I.toDate().getTime();e+1728e5-t<=0&&(a=!0)}let o=G;return a||(i===1?o=K:i===2&&(o=q)),(0,P.jsx)(j,{content:n,children:(0,P.jsx)(`img`,{src:o,alt:n,className:`w-7 h-7 sm:w-12 sm:h-12`})},e.id)})})]}),(0,P.jsx)(`div`,{className:`text-[20px] text-default-800 font-mono ${F?`cursor-pointer hover:text-primary`:``}`,onClick:()=>pe(t,O.ABYSS_B),children:Z($.length>0?X[t.id]?.[$[0].id]?.recordTime:void 0)})]})]})]})})},t.id)),F&&V&&J&&H&&(0,P.jsx)(re,{isOpen:ae,onOpenChange:B,matching:V,mapName:H,artifacts:H===O.ABYSS_A?Q:$,initialState:ce,seasonId:J})]})};function I(){let[e,t]=(0,N.useState)(`ALL`);return(0,P.jsx)(`div`,{className:`h-full overflow-y-auto flex flex-col bg-leaderboard-page`,children:E().pathname.includes(`/artifacts/`)?(0,P.jsx)(D,{}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(`div`,{className:`flex-1 flex flex-col items-center p-4`,children:(0,P.jsx)(`div`,{className:`w-full max-w-[1074px] flex flex-col gap-4`,children:(0,P.jsxs)(`div`,{className:`flex flex-col-reverse lg:flex-row justify-center gap-4 lg:gap-8`,children:[(0,P.jsx)(`div`,{className:`w-full lg:w-[428px] flex flex-col gap-4`,children:(0,P.jsx)(ie,{mapName:e,setMapName:t})}),(0,P.jsx)(`div`,{className:`w-full lg:w-[632px] flex flex-col gap-4`,children:(0,P.jsx)(F,{})})]})})}),(0,P.jsx)(M,{})]})})}export{I as component};